import{j as e,A as s,N as t,H as a,ay as n,ax as r}from"./vendor-ui-DcvuiMJW.js";import{e as i,r as o}from"./vendor-react-CPc5zwff.js";import{m as l,B as c,G as d,a8 as m,a9 as g}from"./index-Dd0d9_cy.js";import{o as x}from"./whatsapp-B6PH0vCN.js";import{H as h}from"./HostHeader-BiFjD5el.js";import{L as u}from"./Loading-CC70LVJ3.js";import{a as p}from"./accountService-vaNt7cO5.js";import{u as f}from"./useTranslation-BTMhbqKL.js";import"./vendor-charts-CNjKuHaK.js";import"./vendor-utils-tyqSID0v.js";import"./avatar-gH7DVWRa.js";import"./sheet-DJPxDHJG.js";import"./LanguageSwitcher-DhNIQqEN.js";import"./index-B9HPLTtY.js";const j=()=>{i();const{toast:j}=l(),{t:b}=f(),[y,v]=o.useState("today"),[N,w]=o.useState([]),[k,_]=o.useState([]),[S,C]=o.useState(!0),[D,L]=o.useState(!1),[U,T]=o.useState(!1),[A,P]=o.useState(null),[H,M]=o.useState(""),[z,B]=o.useState(!1),G=localStorage.getItem("username")||"",F=async(e,s,t)=>{var a;try{let n=t;if(!n){n=null==(a=(await p(e)).profile)?void 0:a.phone}x(n||null,b("host.reservations.whatsappGreeting",{name:s}))||j({title:b("common.error"),description:"Guest's phone number is missing.",variant:"destructive"})}catch(n){}};(e=>{const s=null==e?void 0:e.trim();if(!s)return"AD";const t=s.split(/\s+/);1===t.length?s.slice(0,2).toUpperCase():(t[0][0]+t[1][0]).toUpperCase()})(G||"User"),o.useEffect(()=>{(async()=>{C(!0);try{const[e,s]=await Promise.all([d.get("/bookings/host/today"),d.get("/bookings/host/upcoming")]);w(e.data),_(s.data)}catch(e){}finally{C(!1)}})()},[]);if(N.some(e=>"pending"===e.booking.status),S)return e.jsx(u,{fullScreen:!0,message:b("common.loading","Loading...")});return e.jsxs("div",{className:"min-h-screen bg-gray-50 pb-20 md:pb-0",children:[e.jsx(h,{}),e.jsxs("main",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[e.jsx("div",{className:"mb-8",children:e.jsx("h1",{className:"text-3xl font-semibold text-gray-900",children:b("host.reservations.title","Reservations")})}),e.jsxs("div",{className:"mb-6 flex items-center gap-2",children:[e.jsx("button",{onClick:()=>v("today"),className:("today"===y?"bg-gray-900 text-white shadow":"bg-white text-gray-700 border")+" px-4 py-1.5 rounded-full text-sm font-medium",children:b("common.today","Today")}),e.jsx("button",{onClick:()=>v("upcoming"),className:("upcoming"===y?"bg-gray-900 text-white shadow":"bg-white text-gray-700 border")+" px-4 py-1.5 rounded-full text-sm font-medium",children:b("common.upcoming","Upcoming")})]}),"today"===y?e.jsx("section",{className:"mb-12",children:0===N.length?e.jsxs("div",{className:"bg-white rounded-2xl border border-gray-200 p-12 text-center max-w-2xl mx-auto my-16",children:[e.jsx("div",{className:"w-20 h-20 bg-gray-50 rounded-full flex items-center justify-center mx-auto mb-5",children:e.jsx(s,{className:"h-10 w-10 text-gray-400"})}),e.jsx("h3",{className:"text-xl font-semibold text-gray-900",children:b("host.reservations.emptyTodayTitle","No reservations today")}),e.jsx("p",{className:"text-gray-500 mt-2",children:b("host.reservations.emptyTodayDesc","You don't have any guests checking in or out today.")}),e.jsx(c,{className:"mt-6 rounded-full px-5",children:b("host.common.manageListings","Manage Listings")})]}):e.jsx("div",{className:"grid gap-4",children:N.map(s=>{return e.jsx("div",{className:"bg-white rounded-xl border border-gray-200 p-4 md:p-6 shadow-sm",children:e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center justify-between gap-4",children:[e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:"w-12 h-12 rounded-full bg-gray-100 flex items-center justify-center flex-shrink-0",children:e.jsx("span",{className:"font-semibold text-gray-600",children:s.guest_name.charAt(0).toUpperCase()})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-gray-900",children:s.guest_name}),e.jsx("p",{className:"text-sm text-gray-500",children:s.listing_title}),e.jsxs("div",{className:"flex items-center gap-2 mt-1 text-sm text-gray-500",children:[e.jsxs("span",{children:[s.booking.guests," ",b("common.guests","guests")]}),e.jsx("span",{children:"•"}),e.jsxs("span",{children:[new Date(s.booking.check_in).toLocaleDateString()," - ",new Date(s.booking.check_out).toLocaleDateString()]})]}),e.jsx("div",{className:"mt-2",children:e.jsx("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium\n                                                            "+("confirmed"===s.booking.status?"bg-green-100 text-green-800":"pending"===s.booking.status?"bg-yellow-100 text-yellow-800":"declined"===s.booking.status?"bg-red-100 text-red-800":"bg-gray-100 text-gray-800"),children:(a=s.booking.status,b(`status.${a}`,{confirmed:"Confirmed",pending:"Pending",declined:"Declined"}[a]||a))})})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs(c,{variant:"outline",className:"rounded-full px-4 flex items-center gap-2",onClick:()=>F(s.booking.guest_id,s.guest_name,s.guest_phone),children:[e.jsx(t,{className:"h-4 w-4"}),b("common.message","Message")]}),"pending"===s.booking.status&&e.jsxs(e.Fragment,{children:[e.jsx(c,{onClick:()=>(async e=>{try{await m(e);const[s,t]=await Promise.all([d.get("/bookings/host/today"),d.get("/bookings/host/upcoming")]);w(s.data),_(t.data)}catch(s){}})(s.booking.id),className:"bg-green-600 hover:bg-green-700 text-white rounded-full px-4",children:b("common.approve","Approve")}),e.jsx(c,{onClick:()=>{return e=s.booking.id,P(e),M(""),void T(!0);var e},variant:"outline",className:"text-red-600 hover:bg-red-50 border-red-200 hover:border-red-300 rounded-full px-4",children:b("common.decline","Decline")})]})]})]})},s.booking.id);var a})})}):e.jsxs("section",{children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900 mb-4",children:b("common.upcoming","Upcoming")}),0===k.length?e.jsxs("div",{className:"bg-white rounded-2xl border border-gray-200 p-12 text-center max-w-2xl mx-auto my-16",children:[e.jsx("div",{className:"w-20 h-20 bg-gray-50 rounded-full flex items-center justify-center mx-auto mb-5",children:e.jsx(s,{className:"h-10 w-10 text-gray-400"})}),e.jsx("h3",{className:"text-xl font-semibold text-gray-900",children:b("host.reservations.emptyUpcomingTitle","No upcoming reservations")}),e.jsx("p",{className:"text-gray-500 mt-2",children:b("host.reservations.emptyUpcomingDesc","Finish and publish your listing to receive bookings.")}),e.jsx(c,{className:"mt-6 rounded-full px-5",children:b("host.common.manageListings","Manage Listings")})]}):e.jsx("div",{className:"grid gap-4",children:k.map(s=>e.jsx("div",{className:"bg-white rounded-xl border border-gray-200 p-4 md:p-6 shadow-sm",children:e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center justify-between gap-4",children:[e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:"w-12 h-12 rounded-full bg-gray-100 flex items-center justify-center flex-shrink-0",children:e.jsx("span",{className:"font-semibold text-gray-600",children:s.guest_name.charAt(0).toUpperCase()})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-gray-900",children:s.guest_name}),e.jsx("p",{className:"text-sm text-gray-500",children:s.listing_title}),e.jsxs("div",{className:"flex items-center gap-2 mt-1 text-sm text-gray-500",children:[e.jsxs("span",{children:[s.booking.guests," ",b("common.guests","guests")]}),e.jsx("span",{children:"•"}),e.jsxs("span",{children:[new Date(s.booking.check_in).toLocaleDateString()," - ",new Date(s.booking.check_out).toLocaleDateString()]})]})]})]}),e.jsx(c,{variant:"outline",className:"rounded-full px-4 w-full md:w-auto",onClick:()=>F(s.booking.guest_id,s.guest_name,s.guest_phone),children:b("common.message","Message")})]})},s.booking.id))})]})]}),U&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50 p-4",children:e.jsxs("div",{className:"bg-white rounded-xl max-w-md w-full p-6 shadow-xl",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:b("host.reservations.declineTitle","Decline Booking")}),e.jsx("p",{className:"text-sm text-gray-500 mb-4",children:b("host.reservations.declineHelp","Please provide a reason for declining this booking. This message will be sent to the guest.")}),e.jsx("textarea",{value:H,onChange:e=>M(e.target.value),placeholder:b("host.reservations.declinePlaceholder","e.g., The dates are no longer available..."),className:"w-full h-32 p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-black focus:border-transparent resize-none mb-4"}),e.jsxs("div",{className:"flex justify-end gap-3",children:[e.jsx(c,{variant:"outline",onClick:()=>T(!1),disabled:z,children:b("common.cancel","Cancel")}),e.jsx(c,{onClick:async()=>{if(A&&H.trim()){B(!0);try{await g(A,H);const e=[...N,...k].find(e=>e.booking.id===A);e&&x(e.guest_phone||null,b("host.reservations.declineWhatsapp",{name:e.guest_name,reason:H})),T(!1);const[s,t]=await Promise.all([d.get("/bookings/host/today"),d.get("/bookings/host/upcoming")]);w(s.data),_(t.data)}catch(e){}finally{B(!1)}}},disabled:!H.trim()||z,className:"bg-red-600 hover:bg-red-700 text-white",children:z?b("host.reservations.declining","Declining..."):b("host.reservations.declineCta","Decline Booking")})]})]})}),e.jsx("nav",{className:"md:hidden fixed bottom-0 inset-x-0 z-50 bg-white/90 backdrop-blur-lg border-t border-gray-200 pb-safe transition-all duration-300",children:e.jsx("div",{className:"max-w-md mx-auto px-6",children:e.jsxs("ul",{className:"grid grid-cols-3 h-16",children:[e.jsx("li",{className:"flex items-center justify-center",children:e.jsxs("a",{href:"/host/reservations",className:"flex flex-col items-center gap-1 group w-full h-full justify-center",children:[e.jsx("div",{className:"p-1.5 rounded-full group-active:scale-95 transition-transform",children:e.jsx(a,{className:"h-6 w-6 text-primary fill-current"})}),e.jsx("span",{className:"text-[10px] font-medium text-primary",children:b("nav.reservations","Reservations")})]})}),e.jsx("li",{className:"flex items-center justify-center",children:e.jsxs("a",{href:"/host/dashboard",className:"flex flex-col items-center gap-1 group w-full h-full justify-center",children:[e.jsx("div",{className:"p-1.5 rounded-full group-active:scale-95 transition-transform group-hover:bg-gray-100",children:e.jsx(n,{className:"h-6 w-6 text-gray-500 group-hover:text-gray-900 transition-colors"})}),e.jsx("span",{className:"text-[10px] font-medium text-gray-500 group-hover:text-gray-900 transition-colors",children:b("nav.listings","Listings")})]})}),e.jsx("li",{className:"flex items-center justify-center",children:e.jsxs("a",{href:"/messages?view=host",className:"flex flex-col items-center gap-1 group w-full h-full justify-center",children:[e.jsx("div",{className:"p-1.5 rounded-full group-active:scale-95 transition-transform group-hover:bg-gray-100",children:e.jsx(r,{className:"h-6 w-6 text-gray-500 group-hover:text-gray-900 transition-colors"})}),e.jsx("span",{className:"text-[10px] font-medium text-gray-500 group-hover:text-gray-900 transition-colors",children:b("nav.messages","Messages")})]})})]})})})]})};export{j as default};
