const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/SearchMap-BppKh1Ay.js","assets/vendor-ui-CAOOb9ur.js","assets/vendor-react-C_40T_Qy.js","assets/vendor-maps-B_ay1OW3.js","assets/marker-shadow-D5DIcCoR.js","assets/marker-shadow-Dgihpmma.css","assets/OptimizedImage-ChM7nsgN.js","assets/index-CHW3rl59.js","assets/vendor-charts-knjLkUkQ.js","assets/vendor-utils-tyqSID0v.js","assets/index-i5g5NqsL.css","assets/useTranslation-DgYtz7Wb.js"])))=>i.map(i=>d[i]);
import{i as e,h as s,e as t,u as a,f as i,B as n,g as o,_ as l,j as r}from"./index-CHW3rl59.js";import{j as c,H as d,G as u}from"./vendor-ui-CAOOb9ur.js";import{f as m,h,r as g}from"./vendor-react-C_40T_Qy.js";import{Q as p,a as f,u as y}from"./useQuery-DUJaOdb7.js";import"./LanguageSwitcher-CRTEz5Uf.js";import{u as b}from"./useWishlist-XpO0FfUG.js";import{S as x,H as j}from"./Header--VKnAQ8w.js";import{P as v}from"./PropertyCard-CIiEF1Xy.js";import{u as w}from"./useTranslation-DgYtz7Wb.js";import"./vendor-charts-knjLkUkQ.js";import"./vendor-utils-tyqSID0v.js";import"./index-BzbEf57Q.js";import"./OptimizedImage-ChM7nsgN.js";import"./TranslatedText-BL0fQdvT.js";import"./propertyTypes-lVvLaZHM.js";var k=class extends p{constructor(e,s){super(e,s)}bindMethods(){super.bindMethods(),this.fetchNextPage=this.fetchNextPage.bind(this),this.fetchPreviousPage=this.fetchPreviousPage.bind(this)}setOptions(s){super.setOptions({...s,behavior:e()})}getOptimisticResult(s){return s.behavior=e(),super.getOptimisticResult(s)}fetchNextPage(e){return this.fetch({...e,meta:{fetchMore:{direction:"forward"}}})}fetchPreviousPage(e){return this.fetch({...e,meta:{fetchMore:{direction:"backward"}}})}createResult(e,a){var i,n;const{state:o}=e,l=super.createResult(e,a),{isFetching:r,isRefetching:c,isError:d,isRefetchError:u}=l,m=null==(n=null==(i=o.fetchMeta)?void 0:i.fetchMore)?void 0:n.direction,h=d&&"forward"===m,g=r&&"forward"===m,p=d&&"backward"===m,f=r&&"backward"===m;return{...l,fetchNextPage:this.fetchNextPage,fetchPreviousPage:this.fetchPreviousPage,hasNextPage:t(a,o.data),hasPreviousPage:s(a,o.data),isFetchNextPageError:h,isFetchingNextPage:g,isFetchPreviousPageError:p,isFetchingPreviousPage:f,isRefetchError:u&&!h&&!p,isRefetching:c&&!g&&!f}}};const N=e=>(e||"").trim().toLowerCase().normalize("NFD").replace(new RegExp("\\p{Diacritic}","gu"),""),P=["yaounde","douala","kribi"],M={yaounde:{display:"Yaounde",lat:3.848,lon:11.5021,synonyms:["bastos","biyem","nkolbisson","melen","odza","nkolmesseng","nkoabang","ekounou","essos","madagascar"]},douala:{display:"Douala",lat:4.0511,lon:9.7679,synonyms:["akwa","bonapriso","bonanjo","deido","makepe","ndogbong","logbaba","bepanda","bonamoussadi"]},kribi:{display:"Kribi",lat:2.94,lon:9.91,synonyms:["mpalla","londji","ebambe","lolabe"]},buea:{display:"Buea",lat:4.1527,lon:9.241,synonyms:["molyko","muea","mile 17","bongo square","great soppo","small soppo","bokwango","limbe","tiko","kumba"]},bamenda:{display:"Bamenda",lat:5.9631,lon:10.1591,synonyms:["mankon","bambili","nkambÃ©","kumbo"]},bafoussam:{display:"Bafoussam",lat:5.4769,lon:10.417,synonyms:["dschang","bandjoun","foumban"]},ngaoundere:{display:"Ngaoundere",lat:7.3263,lon:13.5847,synonyms:["adamawa","tibati","meiganga"]},garoua:{display:"Garoua",lat:9.3,lon:13.4,synonyms:[]},maroua:{display:"Maroua",lat:10.5956,lon:14.3247,synonyms:["far north"]},bertoua:{display:"Bertoua",lat:4.5833,lon:13.6833,synonyms:[]},ebolowa:{display:"Ebolowa",lat:2.9,lon:11.15,synonyms:["south"]}},_={centre:["yaounde"],littoral:["douala","nkongsamba","edea"],south:["kribi","ebolowa"],southwest:["buea","limbe","tiko","kumba"],northwest:["bamenda","kumbo","ndop"],west:["bafoussam","dschang","bandjoun"],adamawa:["ngaoundere","tibati","meiganga"],north:["garoua"],"far north":["maroua","kousseri"],east:["bertoua","batouri"]},O=e=>{const s=[e.listing.city,e.listing.address,e.listing.title].filter(Boolean).join(" "),t=N(s);if(t){for(const e of P){if(t.includes(e))return M[e].display;if(M[e].synonyms.some(e=>t.includes(e)))return M[e].display}for(const e of Object.keys(M)){if(P.includes(e))continue;if(t.includes(e))return M[e].display;if(M[e].synonyms.some(e=>t.includes(e)))return M[e].display}}if(e.listing.latitude&&e.listing.longitude){const{latitude:s,longitude:t}=e.listing;let a=null;if(Object.keys(M).forEach(e=>{const i=M[e],n=((e,s,t,a)=>{const i=e=>e*Math.PI/180,n=i(t-e),o=i(a-s),l=Math.sin(n/2)**2+Math.cos(i(e))*Math.cos(i(t))*Math.sin(o/2)**2;return 2*Math.atan2(Math.sqrt(l),Math.sqrt(1-l))*6371})(s,t,i.lat,i.lon);(!a||n<a.dist)&&(a={key:e,dist:n})}),a&&a.dist<=80)return M[a.key].display}return""},E=g.lazy(()=>l(()=>import("./SearchMap-BppKh1Ay.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11]))),F=()=>{var e;const{t:s}=w(),t=m(),[l]=h(),{user:p,logout:F}=a(),{addToWishlist:R,removeFromWishlistByProduct:$,isInWishlist:C}=b(),I=l.get("search")||"";l.get("checkin"),l.get("checkout");const T=parseInt(l.get("guests")||"0"),{isSlowConnection:B,recommendedPageSize:L}=i(),S=Math.max(5,Math.min(20,L)),{data:q,isLoading:z,fetchNextPage:D,hasNextPage:W,isFetchingNextPage:H}=f({queryKey:["products",I,T],initialPageParam:0,staleTime:12e4,gcTime:6e5,placeholderData:e=>e,retry:B?0:2,queryFn:({pageParam:e})=>{const s=Object.keys(M).includes(N(I))||Object.keys(_).includes(N(I))||"other"===N(I)||"buea"===N(I);return o({search:I&&!s?I:void 0,guests:T>0?T:void 0,limit:S,offset:e||0})},getNextPageParam:(e,s)=>{const t=S;return e.length===t?s.length*t:void 0}},k);g.useEffect(()=>{W&&!H&&D()},[W,H,D,null==(e=null==q?void 0:q.pages)?void 0:e.length]);const{data:K}=y({queryKey:["towns"],queryFn:r}),G=g.useMemo(()=>{var e;const s=(null==(e=null==q?void 0:q.pages)?void 0:e.flat())||[],t=N(I);return s.filter(e=>{if(t){if(!(null==e?void 0:e.listing))return!1;if("other"===t){const s=N(O(e)),t=N(e.listing.city||""),a=s||t;if(a&&(P.includes(a)||"buea"===a))return!1}else if(Object.keys(_).includes(t)){const s=_[t].map(e=>N(e)),a=N(e.listing.city||""),i=N(O(e)),n=a||i;if(!n||!s.includes(n))return!1}else if("buea"===t){const s=N(O(e)),t=N(e.listing.city||"");if("buea"!==s&&"buea"!==t)return!1}else{const s=N(e.listing.city||""),a=N(e.listing.address||""),i=N(e.listing.title||""),n=N(O(e));if(!(s.includes(t)||a.includes(t)||i.includes(t)||n===t))return!1}}return!(T>0&&(e.listing.max_guests||0)<T)})},[null==q?void 0:q.pages,I,T,O,P,_]),U=g.useMemo(()=>{var e;const s=new Map;for(const t of G){if(!(null==t?void 0:t.listing))continue;let a=(t.listing.city||"").trim();a||(a=O(t));const i=N(I),n=N(a);let o=n,l=a;if(!n&&i&&"other"!==i&&(o=i,l=(null==(e=M[i])?void 0:e.display)||I),!o)continue;const r=s.get(o)||{name:l,items:[]};!r.name&&l&&(r.name=l),r.items.push(t),s.set(o,r)}return Array.from(s.values()).sort((e,s)=>{const t=P.indexOf(N(e.name)),a=P.indexOf(N(s.name));return-1!==t&&-1!==a?t-a:-1!==t?-1:-1!==a?1:s.items.length-e.items.length}).map(e=>[e.name,e.items])},[G,P,O]),A=g.useMemo(()=>{const e=[];for(const a of G){if(!(null==a?void 0:a.listing))continue;if("number"==typeof a.listing.latitude&&"number"==typeof a.listing.longitude){e.push({id:a.listing.id,lat:a.listing.latitude,lon:a.listing.longitude,product:a});continue}const s=O(a)||a.listing.city||"",t=N(s),i=Object.keys(M).find(e=>e===t),n=i?M[i]:void 0;n&&"number"==typeof n.lat&&"number"==typeof n.lon&&e.push({id:a.listing.id,lat:n.lat,lon:n.lon,product:a})}const s=new Map;e.forEach((e,t)=>{const a=`${e.lat.toFixed(5)},${e.lon.toFixed(5)}`,i=s.get(a);i?i.idxs.push(t):s.set(a,{idxs:[t],lat:e.lat,lon:e.lon})});const t=[...e];return s.forEach(({idxs:e,lat:s,lon:a})=>{if(e.length<=1)return;const i=7e-4;e.forEach((n,o)=>{const l=2*Math.PI*o/e.length,r=i*Math.cos(l),c=i*Math.sin(l)/Math.cos(s*Math.PI/180);t[n]={...t[n],lat:s+r,lon:a+c}})}),t},[G,O,M]),Q=g.useMemo(()=>{const e=N(I);if(e&&M[e]){const s=M[e];return[s.lat,s.lon]}return null},[I,M]),J=g.useMemo(()=>1===A.length?[A[0].lat,A[0].lon]:Q,[A,Q]);return c.jsxs("div",{className:"min-h-screen bg-white flex flex-col",children:[c.jsx(x,{title:I?`${s("Search")}: ${I}`:s("search.search"),description:s("search.browse_available",{count:G.length,location:I?`${s("search.in")} ${I}`:s("search.across_cameroon")})}),c.jsx(j,{}),c.jsxs("div",{className:"flex-1 flex flex-col md:flex-row overflow-hidden",children:[c.jsxs("div",{className:"w-full md:w-[60%] lg:w-[55%] xl:w-[50%] overflow-y-auto p-6",children:[c.jsxs("div",{className:"mb-4",children:[c.jsxs("p",{className:"text-sm text-gray-500",children:[1===G.length?s("search.stay_count",{count:1}):s("search.stays_count",{count:G.length}),I?` ${s("search.in")} ${I}`:""]}),c.jsx("h1",{className:"text-2xl font-bold mt-1",children:s("search.stays_in",{location:I||s("search.cameroon")})})]}),K&&K.length>0&&c.jsx("div",{className:"flex gap-2 overflow-x-auto pb-3 mb-4 -mx-2 px-2",style:{scrollbarWidth:"none",msOverflowStyle:"none"},children:K.map(e=>c.jsxs("button",{onClick:()=>t(`/marketplace?search=${encodeURIComponent(e.city)}${T>0?`&guests=${T}`:""}`),className:"px-3 py-1.5 rounded-full border text-sm whitespace-nowrap "+(e.city.toLowerCase()===I.toLowerCase()?"bg-black text-white border-black":"bg-white text-gray-800 border-gray-200 hover:border-black"),children:[e.city," ",c.jsxs("span",{className:"text-gray-500",children:["(",e.count,")"]})]},e.city))}),z?c.jsxs("div",{className:"flex flex-col items-center justify-center py-20 gap-4",children:[c.jsxs("div",{className:"relative",children:[c.jsx("div",{className:"h-12 w-12 rounded-full border-4 border-primary/30 border-t-primary animate-spin"}),c.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:c.jsx(d,{className:"h-4 w-4 text-primary/50"})})]}),c.jsx("p",{className:"text-muted-foreground animate-pulse",children:s("search.loading")})]}):0===G.length?c.jsxs("div",{className:"text-center py-20",children:[c.jsx("p",{className:"text-gray-600",children:s("search.no_results")}),c.jsx(n,{variant:"outline",className:"mt-4",onClick:()=>t("/"),children:s("search.clear_filters")})]}):U.map(([e,s])=>c.jsxs("div",{className:"mb-10",children:[c.jsx("h2",{className:"text-xl font-bold mb-6 flex items-center gap-2",children:e}),c.jsx("div",{className:"grid grid-cols-2 gap-3 md:grid-cols-2 md:gap-6",children:s.map(e=>c.jsx("div",{className:"w-full",children:c.jsx(v,{id:e.listing.id,name:e.listing.title??"Untitled",location:e.listing.city||O(e)||"Unknown",price:e.listing.price_per_night??0,images:e.photos.map(e=>({image_url:e.url})),propertyType:e.listing.property_type})},e.listing.id))})]},e)),c.jsx("div",{className:"flex justify-center mt-6"})]}),!B&&c.jsx("div",{className:"hidden md:block w-[40%] lg:w-[45%] xl:w-[50%] h-[calc(100vh-80px)] sticky top-20",children:c.jsx(g.Suspense,{fallback:c.jsx("div",{className:"h-full w-full bg-slate-100 flex items-center justify-center",children:c.jsxs("div",{className:"flex flex-col items-center gap-2",children:[c.jsx(u,{className:"h-8 w-8 text-slate-300 animate-pulse"}),c.jsx("span",{className:"text-sm text-slate-400",children:s("Loading map...")})]})}),children:c.jsx(E,{mapPoints:A,singlePoint:J,fallbackCenter:Q})})})]})]})};export{F as default};
