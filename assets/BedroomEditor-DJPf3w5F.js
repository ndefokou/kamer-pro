import{p as R,J as _,r as p,ab as h,j as o,E as A,X as U}from"./index-BumHlSai.js";import{O as j}from"./OptimizedImage-xP7m_j1R.js";import{u as E}from"./useTranslation-DUME4FCN.js";import{C as S}from"./chevron-left-BgQrOA8v.js";import{T as D}from"./trash-2-CcGP-z7s.js";const W=()=>{const w=R(),{t:s}=E(),{id:n}=_(),[b,f]=p.useState([]),[a,m]=p.useState([]),[g,y]=p.useState(!1),u=p.useRef(null);p.useEffect(()=>{v()},[n]);const v=async()=>{var e;try{const l=((e=(await h.get(`/listings/${n}`)).data.photos)==null?void 0:e.filter(d=>{var t;return((t=d.caption)==null?void 0:t.toLowerCase().includes("bedroom"))||d.room_type==="bedroom"}))||[];f(l)}catch(r){console.error("Failed to fetch photos:",r)}},N=async e=>{if(confirm(s("host.editor.confirmDeletePhoto","Are you sure you want to delete this photo?")))try{const d=((await h.get(`/listings/${n}`)).data.photos||[]).filter(t=>String(t.id)!==String(e)).map((t,c)=>({url:t.url,caption:t.caption,room_type:t.room_type,is_cover:t.is_cover===1,display_order:c}));await h.post(`/listings/${n}/photos`,{photos:d}),f(t=>t.filter(c=>String(c.id)!==String(e)))}catch(r){console.error("Failed to delete photo:",r)}},P=e=>{const r=e.target.files;if(!r||r.length===0)return;const i=Array.from(r).map(l=>({file:l,preview:URL.createObjectURL(l)}));m(l=>[...l,...i]),u.current&&(u.current.value="")},k=e=>{m(r=>{const i=[...r];return URL.revokeObjectURL(i[e].preview),i.splice(e,1),i})},C=async()=>{if(a.length!==0){y(!0);try{const r=(await h.get(`/listings/${n}`)).data.photos||[],i=[];for(const t of a){const c=new FormData;c.append("file",t.file);const L=await h.post("/upload/images",c,{headers:{"Content-Type":"multipart/form-data"}});i.push(L.data.urls[0])}const l=r.map(t=>({url:t.url,caption:t.caption,room_type:t.room_type,is_cover:t.is_cover===1,display_order:t.display_order})),d=i.map(t=>({url:t,caption:"Bedroom photo",room_type:"bedroom",is_cover:!1,display_order:0}));await h.post(`/listings/${n}/photos`,{photos:[...l,...d]}),a.forEach(t=>URL.revokeObjectURL(t.preview)),m([]),await v()}catch(e){console.error("Upload failed:",e)}finally{y(!1)}}},x=b.length+a.length;return o.jsxs("div",{className:"min-h-screen bg-white",children:[o.jsx("header",{className:"sticky top-0 bg-white border-b border-gray-200 z-10",children:o.jsxs("div",{className:"max-w-7xl mx-auto px-6 h-16 flex items-center justify-between",children:[o.jsx("button",{onClick:()=>w(`/host/editor/${n}`),className:"p-2 hover:bg-gray-100 rounded-full transition-colors",children:o.jsx(S,{className:"h-5 w-5"})}),o.jsx("h2",{className:"text-lg font-semibold",children:s("host.editor.bedroom","Bedroom")}),o.jsx("div",{className:"w-10"})]})}),o.jsxs("div",{className:"max-w-4xl mx-auto px-6 py-8",children:[o.jsx("h1",{className:"text-3xl font-semibold mb-2",children:s("host.editor.bedroomPhotos","Bedroom photos")}),o.jsx("p",{className:"text-gray-500 mb-8",children:s("host.editor.addBedroomPhotosHelp","Add photos of your bedroom. You can select multiple photos at once.")}),x>0&&o.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-4 mb-6",children:[b.map(e=>o.jsxs("div",{className:"relative aspect-square rounded-lg overflow-hidden border border-gray-200 group",children:[o.jsx(j,{src:A(e.url),alt:e.caption,className:"w-full h-full object-cover"}),o.jsx("div",{className:"absolute inset-0 bg-black/40 opacity-0 group-hover:opacity-100 transition-opacity flex items-start justify-end p-2",children:o.jsx("button",{onClick:()=>N(e.id),className:"p-1.5 bg-white rounded-full text-red-600 hover:bg-gray-100 shadow-sm",title:s("common.delete","Delete"),children:o.jsx(D,{className:"h-4 w-4"})})})]},e.id)),a.map((e,r)=>o.jsxs("div",{className:"relative aspect-square rounded-lg overflow-hidden border-2 border-green-500",children:[o.jsx(j,{src:e.preview,alt:s("common.pendingUpload","Pending upload"),className:"w-full h-full object-cover"}),o.jsx("button",{onClick:()=>k(r),className:"absolute top-2 right-2 p-1.5 bg-white rounded-full shadow-lg hover:bg-gray-100 transition-colors",children:o.jsx(U,{className:"h-4 w-4"})}),o.jsx("div",{className:"absolute bottom-2 left-2 px-2 py-1 bg-green-500 text-white text-xs font-medium rounded",children:s("common.new","New")})]},`pending-${r}`))]}),o.jsxs("div",{className:"border-2 border-dashed border-gray-300 rounded-xl p-12 text-center bg-white mb-6",children:[x===0&&o.jsx("div",{className:"mb-6",children:o.jsxs("svg",{className:"h-32 w-32 mx-auto mb-6",viewBox:"0 0 120 100",fill:"none",children:[o.jsx("path",{d:"M20 60 L100 60 L100 75 L20 75 Z",fill:"#E5E7EB",stroke:"#9CA3AF",strokeWidth:"1.5"}),o.jsx("path",{d:"M25 50 L95 50 L95 60 L25 60 Z",fill:"#F97316",stroke:"#EA580C",strokeWidth:"1.5"}),o.jsx("rect",{x:"70",y:"40",width:"20",height:"12",rx:"2",fill:"#D1D5DB",stroke:"#9CA3AF",strokeWidth:"1.5"}),o.jsx("line",{x1:"25",y1:"75",x2:"25",y2:"85",stroke:"#9CA3AF",strokeWidth:"2"}),o.jsx("line",{x1:"95",y1:"75",x2:"95",y2:"85",stroke:"#9CA3AF",strokeWidth:"2"})]})}),o.jsx("input",{ref:u,type:"file",multiple:!0,accept:"image/*",onChange:P,className:"hidden"}),o.jsx("button",{onClick:()=>{var e;return(e=u.current)==null?void 0:e.click()},disabled:g,className:"px-6 py-2 border border-gray-900 rounded-lg font-medium hover:bg-gray-100 transition-colors disabled:opacity-50",children:x===0?s("host.editor.addPhotos","Add photos"):s("host.photos.addMorePhotos","Add more photos")}),a.length>0&&o.jsxs("p",{className:"text-sm text-gray-500 mt-3",children:[a.length," ",a.length!==1?s("host.photos.photosPlural","photos"):s("host.photos.photoSingular","photo")," ",s("host.photos.readyToUpload","ready to upload")]})]}),a.length>0&&o.jsxs("div",{className:"flex justify-end gap-3",children:[o.jsx("button",{onClick:()=>{a.forEach(e=>URL.revokeObjectURL(e.preview)),m([])},disabled:g,className:"px-6 py-3 border border-gray-300 rounded-lg font-medium hover:bg-gray-50 transition-colors disabled:opacity-50",children:s("common.cancel","Cancel")}),o.jsx("button",{onClick:C,disabled:g,className:"px-6 py-3 bg-black text-white rounded-lg font-medium hover:bg-gray-800 transition-colors disabled:opacity-50",children:g?s("common.saving","Saving..."):s("common.savePhotosCount","Save {{count}} {{unit}}",{count:a.length,unit:a.length!==1?s("host.photos.photosPlural","photos"):s("host.photos.photoSingular","photo")})})]})]})]})};export{W as default};
