import{p as rt,aD as dt,M as ut,r as c,j as e,X as gt,B as O,ab as Q}from"./index-BumHlSai.js";import{a as mt,T as ht,l as p,M as pt,i as ft,b as xt}from"./marker-shadow-CxIpLtgo.js";import{I as yt}from"./input-Ct3vV0ca.js";import{u as bt}from"./useTranslation-DUME4FCN.js";import{M as W}from"./map-pin-8cfpTMs4.js";import{u as vt,a as wt}from"./hooks-Dy30anLC.js";const jt="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADIAAABSCAMAAAAhFXfZAAAC91BMVEVMaXEzeak2f7I4g7g3g7cua5gzeKg8hJo3grY4g7c3grU0gLI2frE0daAubJc2gbQwd6QzeKk2gLMtd5sxdKIua5g1frA2f7IydaM0e6w2fq41fK01eqo3grgubJgta5cxdKI1f7AydaQydaMxc6EubJgvbJkwcZ4ubZkwcJwubZgubJcydqUydKIxapgubJctbJcubZcubJcvbJYubJcvbZkubJctbJctbZcubJg2f7AubJcrbZcubJcubJcua5g3grY0fq8ubJcubJdEkdEwhsw6i88vhswuhcsuhMtBjMgthMsrg8srgss6is8qgcs8i9A9iMYtg8spgcoogMo7hcMngMonf8olfso4gr8kfck5iM8jfMk4iM8he8k1fro7itAgesk2hs8eecgzfLcofssdeMg0hc4cd8g2hcsxeLQbdsgZdcgxeLImfcszhM0vda4xgckzhM4xg84wf8Yxgs4udKsvfcQucqhUndROmdM1fK0wcZ8vb5w0eqpQm9MzeKhXoNVcpdYydKNWn9VZotVKltJFjsIwcJ1Rms9OlslLmtH///8+kc9epdYzd6dbo9VHkMM2f7FHmNBClM8ydqVcpNY9hro3gLM9hLczealQmcw3fa46f7A8gLMxc6I3eagyc6FIldJMl9JSnNRSntNNl9JPnNJFi75UnM9ZodVKksg8kM45jc09e6ZHltFBk883gbRBh7pDk9EwcaBzn784g7dKkcY2i81Om9M7j85Llc81is09g7Q4grY/j9A0eqxKmdFFltBEjcXf6fFImdBCiLxJl9FGlNFBi78yiMxVndEvbpo6js74+vx+psPP3+o/ks5HkcpGmNCjwdZCkNDM3ehYoNJEls+lxNkxh8xHks0+jdC1zd5Lg6r+/v/H2ufz9/o3jM3t8/edvdM/k89Th61OiLBSjbZklbaTt9BfptdjmL1AicBHj8hGk9FAgK1dkLNTjLRekrdClc/k7fM0icy0y9tgp9c4jc2NtM9Dlc8zicxeXZn3AAAAQ3RSTlMAHDdTb4yPA+LtnEQmC4L2EmHqB7XA0d0sr478x4/Yd5i1zOfyPkf1sLVq4Nh3FvjxopQ2/STNuFzUwFIwxKaejILpIBEV9wAABhVJREFUeF6s1NdyFEcY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",kt=p.Icon.Default.prototype;delete kt._getIconUrl;p.Icon.Default.mergeOptions({iconUrl:xt,iconRetinaUrl:jt,shadowUrl:ft});const G=[7.3697,12.3547],Nt=6,V={PERMISSION_DENIED:1,POSITION_UNAVAILABLE:2,TIMEOUT:3};function Lt({center:r,zoom:i}){const g=vt();return c.useEffect(()=>{g.setView(r,i||g.getZoom())},[r,i,g]),null}function At({position:r,setPosition:i}){const g=c.useRef(null),T={dragend(){const b=g.current;b!=null&&i(b.getLatLng())}};return wt({click(b){i(b.latlng)}}),e.jsx(pt,{draggable:!0,eventHandlers:T,position:r,ref:g})}function _(r){const i=r.display_name.split(",");return i.slice(0,Math.min(3,i.length)).join(",")}const Ft=()=>{const r=rt(),{draft:i,updateDraft:g,nextStep:T,previousStep:b}=dt(),{toast:v}=ut(),{t:s}=bt(),m=new URLSearchParams(window.location.search).get("listing"),d=!!m,[n,$]=c.useState(null),[D,K]=c.useState(!1),J=d&&(n!=null&&n.latitude)&&(n!=null&&n.longitude)?new p.LatLng(n.latitude,n.longitude):i.latitude&&i.longitude?new p.LatLng(i.latitude,i.longitude):new p.LatLng(G[0],G[1]),[h,k]=c.useState(J),[tt,A]=c.useState(J),[P,M]=c.useState(d&&(n!=null&&n.latitude)&&(n!=null&&n.longitude)||i.latitude&&i.longitude?13:Nt),[f,w]=c.useState(d?(n==null?void 0:n.address)||"":i.address||""),[S,y]=c.useState([]),[H,Z]=c.useState(!1),[q,N]=c.useState(d?(n==null?void 0:n.address)||"":i.address||""),[F,x]=c.useState(!1),[Y,B]=c.useState(!1),[R,E]=c.useState(i.city||""),[U,I]=c.useState(i.country||"");c.useEffect(()=>{d&&m&&(async()=>{try{const a=(await Q.get(`/listings/${m}`)).data.listing;if($(a),a.city&&E(a.city),a.country&&I(a.country),a.latitude&&a.longitude){const l=new p.LatLng(a.latitude,a.longitude);k(l),A(l),M(13)}a.address&&(w(a.address),N(a.address))}catch(t){console.error("Failed to load listing:",t)}})()},[d,m]),c.useEffect(()=>{if(f.length<3){y([]),x(!1);return}const o=setTimeout(async()=>{Z(!0),x(!0);try{const a=await(await fetch(`https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(f)}&limit=5&addressdetails=1`)).json();y(a)}catch(t){console.error("Geocoding error:",t),y([])}finally{Z(!1)}},500);return()=>clearTimeout(o)},[f]);const et=o=>{var L,z,u,C;const t=new p.LatLng(parseFloat(o.lat),parseFloat(o.lon));k(t),A(t),M(13);const a=_(o);w(a),N(o.display_name);const l=((L=o.address)==null?void 0:L.city)||((z=o.address)==null?void 0:z.town)||((u=o.address)==null?void 0:u.village)||"",j=((C=o.address)==null?void 0:C.country)||"";E(l),I(j),x(!1),y([])},ot=()=>{w(""),N(""),x(!1),y([])},X=async(o,t)=>{var a,l,j,L;try{const u=await(await fetch(`https://nominatim.openstreetmap.org/reverse?format=json&lat=${o}&lon=${t}&zoom=14&addressdetails=1`)).json();if(u&&u.display_name){const C=_({lat:String(o),lon:String(t),display_name:u.display_name});w(C),N(u.display_name);const ct=((a=u.address)==null?void 0:a.city)||((l=u.address)==null?void 0:l.town)||((j=u.address)==null?void 0:j.village)||"",lt=((L=u.address)==null?void 0:L.country)||"";E(ct),I(lt),x(!1),y([])}}catch{}},st=async()=>{try{const t=await(await fetch("https://ipapi.co/json/")).json();if(typeof t.latitude=="number"&&typeof t.longitude=="number"){const a=new p.LatLng(t.latitude,t.longitude);k(a),A(a),M(12);const l=[t.city,t.region,t.country_name].filter(Boolean).join(", ");l?(w(l),N(l),t.city&&E(t.city),t.country_name&&I(t.country_name),x(!1),y([])):await X(t.latitude,t.longitude),v({title:s("host.location.approxTitle","Using approximate location"),description:s("host.location.approxDesc","We estimated your location using your IP address.")})}else v({title:s("host.location.fallbackFailedTitle","Approximate location failed"),description:s("host.location.fallbackFailedDesc","We could not determine your location."),variant:"destructive"})}catch{v({title:s("host.location.fallbackFailedTitle","Approximate location failed"),description:s("host.location.fallbackFailedDesc","We could not determine your location."),variant:"destructive"})}},at=()=>{if(!navigator.geolocation){v({title:s("host.location.geolocationUnsupportedTitle","Location unavailable"),description:s("host.location.geolocationUnsupportedDesc","Geolocation is not supported by your browser."),variant:"destructive"});return}B(!0),navigator.geolocation.getCurrentPosition(async o=>{const{latitude:t,longitude:a}=o.coords,l=new p.LatLng(t,a);k(l),A(l),M(15),await X(t,a),B(!1)},o=>{let t=s("host.location.geolocationError","Unable to retrieve your location.");o.code===V.PERMISSION_DENIED?t=s("host.location.permissionDenied","Permission to access location was denied."):o.code===V.POSITION_UNAVAILABLE?t=s("host.location.positionUnavailable","Location information is unavailable."):o.code===V.TIMEOUT&&(t=s("host.location.timeout","The request to get your location timed out.")),v({title:s("host.location.locationFailedTitle","Location failed"),description:t+" "+s("host.location.tryApprox","Trying approximate location..."),variant:"destructive"}),B(!1),st()},{enableHighAccuracy:!0,timeout:1e4,maximumAge:0})},nt=async()=>{const o={latitude:h.lat,longitude:h.lng,address:q||f||`${h.lat.toFixed(6)}, ${h.lng.toFixed(6)}`};if(R&&(o.city=R),U&&(o.country=U),d&&m){K(!0);try{await Q.put(`/listings/${m}`,o),r(`/host/editor/${m}`)}catch(t){console.error("Failed to save location:",t),v({title:s("host.location.saveFailedTitle","Save failed"),description:s("host.location.saveFailedDesc","Failed to save location. Please try again."),variant:"destructive"})}finally{K(!1)}}else g(o),T(),r("/host/photos")},it=()=>{d&&m?r(`/host/editor/${m}`):(g({latitude:h.lat,longitude:h.lng,address:q||f||`${h.lat.toFixed(6)}, ${h.lng.toFixed(6)}`,city:R,country:U}),b(),r("/host/amenities"))};return e.jsxs("div",{className:"min-h-screen bg-background flex flex-col",children:[e.jsx("div",{className:"p-4 md:p-8 pb-4",children:e.jsxs("div",{className:"max-w-4xl mx-auto",children:[e.jsx("h1",{className:"text-3xl md:text-4xl font-bold mb-2",children:s("host.location.title","Where's your place located?")}),e.jsx("p",{className:"text-muted-foreground",children:s("host.location.subtitle","Your address is only shared with guests after they've made a reservation.")})]})}),e.jsx("div",{className:"px-4 md:px-8 pb-4",children:e.jsxs("div",{className:"max-w-4xl mx-auto relative",children:[e.jsxs("div",{className:"relative",children:[e.jsx(W,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-5 w-5 text-muted-foreground"}),e.jsx(yt,{type:"text",placeholder:s("host.location.searchPlaceholder","Enter a location..."),value:f,onChange:o=>{w(o.target.value),x(!0)},onFocus:()=>{S.length>0&&x(!0)},className:"pl-10 pr-10 py-6 text-lg"}),f&&e.jsx("button",{onClick:ot,className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-muted-foreground hover:text-foreground",children:e.jsx(gt,{className:"h-5 w-5"})})]}),e.jsx("div",{className:"mt-3",children:e.jsx(O,{variant:"outline",size:"sm",onClick:at,disabled:Y,children:Y?s("host.location.locating","Locating..."):s("host.location.useMyLocation","Use my location")})}),F&&S.length>0&&e.jsx("div",{className:"absolute z-[1000] w-full mt-2 bg-background border rounded-lg shadow-lg max-h-80 overflow-y-auto",children:S.map((o,t)=>{const a=o.display_name.split(","),l=a[0],j=a.slice(1).join(",");return e.jsxs("button",{onClick:()=>et(o),className:"w-full px-4 py-3 text-left hover:bg-accent transition-colors border-b last:border-b-0 flex items-start gap-3",children:[e.jsx(W,{className:"h-5 w-5 text-muted-foreground mt-0.5 flex-shrink-0"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"font-medium text-foreground truncate",children:l}),e.jsx("div",{className:"text-sm text-muted-foreground truncate",children:j})]})]},t)})}),H&&F&&e.jsx("div",{className:"absolute z-[1000] w-full mt-2 bg-background border rounded-lg shadow-lg p-4 text-center text-muted-foreground",children:s("common.searching","Searching...")}),F&&!H&&S.length===0&&f.length>=3&&e.jsx("div",{className:"absolute z-[1000] w-full mt-2 bg-background border rounded-lg shadow-lg p-4 text-center text-muted-foreground",children:s("common.noResults","No results found")})]})}),e.jsx("div",{className:"flex-1 px-4 md:px-8 pb-4",children:e.jsx("div",{className:"max-w-4xl mx-auto h-[400px] md:h-[500px] rounded-lg overflow-hidden border-2 border-border shadow-lg",children:e.jsxs(mt,{center:J,zoom:P,style:{height:"100%",width:"100%"},children:[e.jsx(ht,{attribution:'Â© <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png"}),e.jsx(Lt,{center:tt,zoom:P}),e.jsx(At,{position:h,setPosition:k})]})})}),e.jsx("div",{className:"px-4 md:px-8 pb-8",children:e.jsxs("div",{className:"max-w-4xl mx-auto",children:[e.jsxs("div",{className:"flex justify-between items-center pt-6 border-t",children:[e.jsx(O,{variant:"outline",onClick:it,size:"lg",children:d?s("common.cancel","Cancel"):s("common.back","Back")}),e.jsx(O,{onClick:nt,size:"lg",disabled:D,children:D?s("common.saving","Saving..."):d?s("common.save","Save"):s("common.continue","Continue")})]}),!d&&e.jsx("div",{className:"mt-4 text-center text-sm text-muted-foreground",children:s("common.stepOf","Step {{current}} of {{total}}",{current:3,total:10})})]})})]})};export{Ft as default};
