import{p as H,M as P,r as n,j as e,B as i,H as G,ab as o,aS as O,aT as $}from"./index-BumHlSai.js";import{o as k}from"./whatsapp-DqlDrlWI.js";import{H as z}from"./HostHeader-B1_FfEH8.js";import{L as E}from"./Loading-wlpE3RCN.js";import{a as D}from"./accountService-hlSQof4h.js";import{u as W}from"./useTranslation-DUME4FCN.js";import{C as S}from"./calendar-B4NFKoEL.js";import{M as q}from"./message-square-BTQwkIw7.js";import{G as Y}from"./grid-3x3-BMs6gCgl.js";import{M as J}from"./mail-BqVaG6XR.js";import"./avatar-BcTl2A0a.js";import"./sheet-CXl9c71X.js";import"./LanguageSwitcher-B49yhAFl.js";import"./index-BcTPR2G6.js";import"./chevron-right-Cey3u9Ra.js";import"./check-Cw4ObBPz.js";import"./chevron-left-BgQrOA8v.js";import"./menu-CwDdBYwq.js";import"./plus-zj-BiCMM.js";const pe=()=>{H();const{toast:C}=P(),{t}=W(),[m,y]=n.useState("today"),[d,g]=n.useState([]),[x,h]=n.useState([]),[B,j]=n.useState(!0),[K,Q]=n.useState(!1),[L,u]=n.useState(!1),[p,T]=n.useState(null),[l,b]=n.useState(""),[f,v]=n.useState(!1),M=localStorage.getItem("username")||"",U=s=>{const a=s==null?void 0:s.trim();if(!a)return"AD";const r=a.split(/\s+/);return r.length===1?a.slice(0,2).toUpperCase():(r[0][0]+r[1][0]).toUpperCase()},N=async s=>{var a;try{const r=await D(s);k(((a=r.profile)==null?void 0:a.phone)||null,t("host.reservations.whatsappGreeting",{name:r.user.username}))||C({title:t("common.error"),description:"Guest's phone number is missing.",variant:"destructive"})}catch(r){console.error("Failed to fetch guest phone",r)}};U(M||"User"),n.useEffect(()=>{(async()=>{j(!0);try{const[a,r]=await Promise.all([o.get("/bookings/host/today"),o.get("/bookings/host/upcoming")]);g(a.data),h(r.data)}catch(a){console.error("Failed to fetch bookings:",a)}finally{j(!1)}})()},[]);const _=async s=>{try{await O(s);const[a,r]=await Promise.all([o.get("/bookings/host/today"),o.get("/bookings/host/upcoming")]);g(a.data),h(r.data)}catch(a){console.error("Failed to approve booking:",a)}},R=s=>{T(s),b(""),u(!0)},A=async()=>{var s;if(!(!p||!l.trim())){v(!0);try{await $(p,l);const r=[...d,...x].find(c=>c.booking.id===p);if(r)try{const c=await D(r.booking.guest_id);k(((s=c.profile)==null?void 0:s.phone)||null,t("host.reservations.declineWhatsapp",{reason:l}))}catch(c){console.error("Failed to send WhatsApp notification",c)}u(!1);const[w,I]=await Promise.all([o.get("/bookings/host/today"),o.get("/bookings/host/upcoming")]);g(w.data),h(I.data)}catch(a){console.error("Failed to decline booking:",a)}finally{v(!1)}}};if(d.some(s=>s.booking.status==="pending"),B)return e.jsx(E,{fullScreen:!0,message:t("common.loading","Loading...")});const F=s=>{const a={confirmed:"Confirmed",pending:"Pending",declined:"Declined"};return t(`status.${s}`,a[s]||s)};return e.jsxs("div",{className:"min-h-screen bg-gray-50 pb-20 md:pb-0",children:[e.jsx(z,{}),e.jsxs("main",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[e.jsx("div",{className:"mb-8",children:e.jsx("h1",{className:"text-3xl font-semibold text-gray-900",children:t("host.reservations.title","Reservations")})}),e.jsxs("div",{className:"mb-6 flex items-center gap-2",children:[e.jsx("button",{onClick:()=>y("today"),className:`${m==="today"?"bg-gray-900 text-white shadow":"bg-white text-gray-700 border"} px-4 py-1.5 rounded-full text-sm font-medium`,children:t("common.today","Today")}),e.jsx("button",{onClick:()=>y("upcoming"),className:`${m==="upcoming"?"bg-gray-900 text-white shadow":"bg-white text-gray-700 border"} px-4 py-1.5 rounded-full text-sm font-medium`,children:t("common.upcoming","Upcoming")})]}),m==="today"?e.jsx("section",{className:"mb-12",children:d.length===0?e.jsxs("div",{className:"bg-white rounded-2xl border border-gray-200 p-12 text-center max-w-2xl mx-auto my-16",children:[e.jsx("div",{className:"w-20 h-20 bg-gray-50 rounded-full flex items-center justify-center mx-auto mb-5",children:e.jsx(S,{className:"h-10 w-10 text-gray-400"})}),e.jsx("h3",{className:"text-xl font-semibold text-gray-900",children:t("host.reservations.emptyTodayTitle","No reservations today")}),e.jsx("p",{className:"text-gray-500 mt-2",children:t("host.reservations.emptyTodayDesc","You don't have any guests checking in or out today.")}),e.jsx(i,{className:"mt-6 rounded-full px-5",children:t("host.common.manageListings","Manage Listings")})]}):e.jsx("div",{className:"grid gap-4",children:d.map(s=>e.jsx("div",{className:"bg-white rounded-xl border border-gray-200 p-4 md:p-6 shadow-sm",children:e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center justify-between gap-4",children:[e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:"w-12 h-12 rounded-full bg-gray-100 flex items-center justify-center flex-shrink-0",children:e.jsx("span",{className:"font-semibold text-gray-600",children:s.guest_name.charAt(0).toUpperCase()})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-gray-900",children:s.guest_name}),e.jsx("p",{className:"text-sm text-gray-500",children:s.listing_title}),e.jsxs("div",{className:"flex items-center gap-2 mt-1 text-sm text-gray-500",children:[e.jsxs("span",{children:[s.booking.guests," ",t("common.guests","guests")]}),e.jsx("span",{children:"•"}),e.jsxs("span",{children:[new Date(s.booking.check_in).toLocaleDateString()," - ",new Date(s.booking.check_out).toLocaleDateString()]})]}),e.jsx("div",{className:"mt-2",children:e.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium
                                                            ${s.booking.status==="confirmed"?"bg-green-100 text-green-800":s.booking.status==="pending"?"bg-yellow-100 text-yellow-800":s.booking.status==="declined"?"bg-red-100 text-red-800":"bg-gray-100 text-gray-800"}`,children:F(s.booking.status)})})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs(i,{variant:"outline",className:"rounded-full px-4 flex items-center gap-2",onClick:()=>N(s.booking.guest_id),children:[e.jsx(q,{className:"h-4 w-4"}),t("common.message","Message")]}),s.booking.status==="pending"&&e.jsxs(e.Fragment,{children:[e.jsx(i,{onClick:()=>_(s.booking.id),className:"bg-green-600 hover:bg-green-700 text-white rounded-full px-4",children:t("common.approve","Approve")}),e.jsx(i,{onClick:()=>R(s.booking.id),variant:"outline",className:"text-red-600 hover:bg-red-50 border-red-200 hover:border-red-300 rounded-full px-4",children:t("common.decline","Decline")})]})]})]})},s.booking.id))})}):e.jsxs("section",{children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900 mb-4",children:t("common.upcoming","Upcoming")}),x.length===0?e.jsxs("div",{className:"bg-white rounded-2xl border border-gray-200 p-12 text-center max-w-2xl mx-auto my-16",children:[e.jsx("div",{className:"w-20 h-20 bg-gray-50 rounded-full flex items-center justify-center mx-auto mb-5",children:e.jsx(S,{className:"h-10 w-10 text-gray-400"})}),e.jsx("h3",{className:"text-xl font-semibold text-gray-900",children:t("host.reservations.emptyUpcomingTitle","No upcoming reservations")}),e.jsx("p",{className:"text-gray-500 mt-2",children:t("host.reservations.emptyUpcomingDesc","Finish and publish your listing to receive bookings.")}),e.jsx(i,{className:"mt-6 rounded-full px-5",children:t("host.common.manageListings","Manage Listings")})]}):e.jsx("div",{className:"grid gap-4",children:x.map(s=>e.jsx("div",{className:"bg-white rounded-xl border border-gray-200 p-4 md:p-6 shadow-sm",children:e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center justify-between gap-4",children:[e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:"w-12 h-12 rounded-full bg-gray-100 flex items-center justify-center flex-shrink-0",children:e.jsx("span",{className:"font-semibold text-gray-600",children:s.guest_name.charAt(0).toUpperCase()})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-gray-900",children:s.guest_name}),e.jsx("p",{className:"text-sm text-gray-500",children:s.listing_title}),e.jsxs("div",{className:"flex items-center gap-2 mt-1 text-sm text-gray-500",children:[e.jsxs("span",{children:[s.booking.guests," ",t("common.guests","guests")]}),e.jsx("span",{children:"•"}),e.jsxs("span",{children:[new Date(s.booking.check_in).toLocaleDateString()," - ",new Date(s.booking.check_out).toLocaleDateString()]})]})]})]}),e.jsx(i,{variant:"outline",className:"rounded-full px-4 w-full md:w-auto",onClick:()=>N(s.booking.guest_id),children:t("common.message","Message")})]})},s.booking.id))})]})]}),L&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50 p-4",children:e.jsxs("div",{className:"bg-white rounded-xl max-w-md w-full p-6 shadow-xl",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:t("host.reservations.declineTitle","Decline Booking")}),e.jsx("p",{className:"text-sm text-gray-500 mb-4",children:t("host.reservations.declineHelp","Please provide a reason for declining this booking. This message will be sent to the guest.")}),e.jsx("textarea",{value:l,onChange:s=>b(s.target.value),placeholder:t("host.reservations.declinePlaceholder","e.g., The dates are no longer available..."),className:"w-full h-32 p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-black focus:border-transparent resize-none mb-4"}),e.jsxs("div",{className:"flex justify-end gap-3",children:[e.jsx(i,{variant:"outline",onClick:()=>u(!1),disabled:f,children:t("common.cancel","Cancel")}),e.jsx(i,{onClick:A,disabled:!l.trim()||f,className:"bg-red-600 hover:bg-red-700 text-white",children:f?t("host.reservations.declining","Declining..."):t("host.reservations.declineCta","Decline Booking")})]})]})}),e.jsx("nav",{className:"md:hidden fixed bottom-0 inset-x-0 z-50 bg-white/90 backdrop-blur-lg border-t border-gray-200 pb-safe transition-all duration-300",children:e.jsx("div",{className:"max-w-md mx-auto px-6",children:e.jsxs("ul",{className:"grid grid-cols-3 h-16",children:[e.jsx("li",{className:"flex items-center justify-center",children:e.jsxs("a",{href:"/host/reservations",className:"flex flex-col items-center gap-1 group w-full h-full justify-center",children:[e.jsx("div",{className:"p-1.5 rounded-full group-active:scale-95 transition-transform",children:e.jsx(G,{className:"h-6 w-6 text-primary fill-current"})}),e.jsx("span",{className:"text-[10px] font-medium text-primary",children:t("nav.reservations","Reservations")})]})}),e.jsx("li",{className:"flex items-center justify-center",children:e.jsxs("a",{href:"/host/dashboard",className:"flex flex-col items-center gap-1 group w-full h-full justify-center",children:[e.jsx("div",{className:"p-1.5 rounded-full group-active:scale-95 transition-transform group-hover:bg-gray-100",children:e.jsx(Y,{className:"h-6 w-6 text-gray-500 group-hover:text-gray-900 transition-colors"})}),e.jsx("span",{className:"text-[10px] font-medium text-gray-500 group-hover:text-gray-900 transition-colors",children:t("nav.listings","Listings")})]})}),e.jsx("li",{className:"flex items-center justify-center",children:e.jsxs("a",{href:"/messages?view=host",className:"flex flex-col items-center gap-1 group w-full h-full justify-center",children:[e.jsx("div",{className:"p-1.5 rounded-full group-active:scale-95 transition-transform group-hover:bg-gray-100",children:e.jsx(J,{className:"h-6 w-6 text-gray-500 group-hover:text-gray-900 transition-colors"})}),e.jsx("span",{className:"text-[10px] font-medium text-gray-500 group-hover:text-gray-900 transition-colors",children:t("nav.messages","Messages")})]})})]})})})]})};export{pe as default};
