const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/SearchMap-DUBNlcC4.js","assets/vendor-ui-DcvuiMJW.js","assets/vendor-react-CPc5zwff.js","assets/vendor-maps-DGfzlnCx.js","assets/marker-shadow-D5DIcCoR.js","assets/marker-shadow-Dgihpmma.css","assets/OptimizedImage-Dw--M-ma.js","assets/index-Dd0d9_cy.js","assets/vendor-charts-CNjKuHaK.js","assets/vendor-utils-tyqSID0v.js","assets/index-lw8G4jxF.css","assets/useTranslation-BTMhbqKL.js"])))=>i.map(i=>d[i]);
import{u as e,i as s,g as t,B as a,_ as n,h as i}from"./index-Dd0d9_cy.js";import{j as l,H as o,G as r}from"./vendor-ui-DcvuiMJW.js";import{e as c,j as d,r as m}from"./vendor-react-CPc5zwff.js";import{u}from"./useQuery-LvoaILWK.js";import{u as g,P as h}from"./PropertyCard-BI5jNRZs.js";import"./LanguageSwitcher-DhNIQqEN.js";import{u as p}from"./useWishlist-BsnpXgXf.js";import{S as y,H as f}from"./Header-C1YZcuTT.js";import{u as b}from"./useTranslation-BTMhbqKL.js";import"./vendor-charts-CNjKuHaK.js";import"./vendor-utils-tyqSID0v.js";import"./useBaseQuery-DtuBwOHy.js";import"./OptimizedImage-Dw--M-ma.js";import"./TranslatedText-CQH4VK3e.js";import"./propertyTypes--Kllk2h6.js";import"./index-B9HPLTtY.js";const x=e=>(e||"").trim().toLowerCase().normalize("NFD").replace(new RegExp("\\p{Diacritic}","gu"),""),j=["yaounde","douala","kribi"],v={yaounde:{display:"Yaounde",lat:3.848,lon:11.5021,synonyms:["bastos","biyem","nkolbisson","melen","odza","nkolmesseng","nkoabang","ekounou","essos","madagascar"]},douala:{display:"Douala",lat:4.0511,lon:9.7679,synonyms:["akwa","bonapriso","bonanjo","deido","makepe","ndogbong","logbaba","bepanda","bonamoussadi"]},kribi:{display:"Kribi",lat:2.94,lon:9.91,synonyms:["mpalla","londji","ebambe","lolabe"]},buea:{display:"Buea",lat:4.1527,lon:9.241,synonyms:["molyko","muea","mile 17","bongo square","great soppo","small soppo","bokwango","limbe","tiko","kumba"]},bamenda:{display:"Bamenda",lat:5.9631,lon:10.1591,synonyms:["mankon","bambili","nkambÃ©","kumbo"]},bafoussam:{display:"Bafoussam",lat:5.4769,lon:10.417,synonyms:["dschang","bandjoun","foumban"]},ngaoundere:{display:"Ngaoundere",lat:7.3263,lon:13.5847,synonyms:["adamawa","tibati","meiganga"]},garoua:{display:"Garoua",lat:9.3,lon:13.4,synonyms:[]},maroua:{display:"Maroua",lat:10.5956,lon:14.3247,synonyms:["far north"]},bertoua:{display:"Bertoua",lat:4.5833,lon:13.6833,synonyms:[]},ebolowa:{display:"Ebolowa",lat:2.9,lon:11.15,synonyms:["south"]}},w={centre:["yaounde"],littoral:["douala","nkongsamba","edea"],south:["kribi","ebolowa"],southwest:["buea","limbe","tiko","kumba"],northwest:["bamenda","kumbo","ndop"],west:["bafoussam","dschang","bandjoun"],adamawa:["ngaoundere","tibati","meiganga"],north:["garoua"],"far north":["maroua","kousseri"],east:["bertoua","batouri"]},k=e=>{const s=[e.listing.city,e.listing.address,e.listing.title].filter(Boolean).join(" "),t=x(s);if(t){for(const e of j){if(t.includes(e))return v[e].display;if(v[e].synonyms.some(e=>t.includes(e)))return v[e].display}for(const e of Object.keys(v)){if(j.includes(e))continue;if(t.includes(e))return v[e].display;if(v[e].synonyms.some(e=>t.includes(e)))return v[e].display}}if(e.listing.latitude&&e.listing.longitude){const{latitude:s,longitude:t}=e.listing;let a=null;if(Object.keys(v).forEach(e=>{const n=v[e],i=((e,s,t,a)=>{const n=e=>e*Math.PI/180,i=n(t-e),l=n(a-s),o=Math.sin(i/2)**2+Math.cos(n(e))*Math.cos(n(t))*Math.sin(l/2)**2;return 2*Math.atan2(Math.sqrt(o),Math.sqrt(1-o))*6371})(s,t,n.lat,n.lon);(!a||i<a.dist)&&(a={key:e,dist:i})}),a&&a.dist<=80)return v[a.key].display}return""},N=m.lazy(()=>n(()=>import("./SearchMap-DUBNlcC4.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11]))),M=()=>{var n;const{t:M}=b(),P=c(),[_]=d(),{user:O,logout:$}=e(),{addToWishlist:C,removeFromWishlistByProduct:E,isInWishlist:I}=p(),T=_.get("search")||"";_.get("checkin"),_.get("checkout");const B=parseInt(_.get("guests")||"0"),{isSlowConnection:F,recommendedPageSize:L}=s(),S=Math.max(5,Math.min(20,L)),{data:q,isLoading:z,fetchNextPage:D,hasNextPage:W,isFetchingNextPage:H}=g({queryKey:["products",T,B],initialPageParam:0,staleTime:12e4,gcTime:6e5,placeholderData:e=>e,retry:F?0:2,queryFn:({pageParam:e})=>{const s=Object.keys(v).includes(x(T))||Object.keys(w).includes(x(T))||"other"===x(T)||"buea"===x(T);return i({search:T&&!s?T:void 0,guests:B>0?B:void 0,limit:S,offset:e||0})},getNextPageParam:(e,s)=>{const t=S;return e.length===t?s.length*t:void 0}});m.useEffect(()=>{W&&!H&&D()},[W,H,D,null==(n=null==q?void 0:q.pages)?void 0:n.length]);const{data:K}=u({queryKey:["towns"],queryFn:t}),A=m.useMemo(()=>{var e;const s=(null==(e=null==q?void 0:q.pages)?void 0:e.flat())||[],t=x(T);return s.filter(e=>{if(t){if(!(null==e?void 0:e.listing))return!1;if("other"===t){const s=x(k(e)),t=x(e.listing.city||""),a=s||t;if(a&&(j.includes(a)||"buea"===a))return!1}else if(Object.keys(w).includes(t)){const s=w[t].map(e=>x(e)),a=x(e.listing.city||""),n=x(k(e)),i=a||n;if(!i||!s.includes(i))return!1}else if("buea"===t){const s=x(k(e)),t=x(e.listing.city||"");if("buea"!==s&&"buea"!==t)return!1}else{const s=x(e.listing.city||""),a=x(e.listing.address||""),n=x(e.listing.title||""),i=x(k(e));if(!(s.includes(t)||a.includes(t)||n.includes(t)||i===t))return!1}}return!(B>0&&(e.listing.max_guests||0)<B)})},[null==q?void 0:q.pages,T,B,k,j,w]),G=m.useMemo(()=>{var e;const s=new Map;for(const t of A){if(!(null==t?void 0:t.listing))continue;let a=(t.listing.city||"").trim();a||(a=k(t));const n=x(T),i=x(a);let l=i,o=a;if(!i&&n&&"other"!==n&&(l=n,o=(null==(e=v[n])?void 0:e.display)||T),!l)continue;const r=s.get(l)||{name:o,items:[]};!r.name&&o&&(r.name=o),r.items.push(t),s.set(l,r)}return Array.from(s.values()).sort((e,s)=>{const t=j.indexOf(x(e.name)),a=j.indexOf(x(s.name));return-1!==t&&-1!==a?t-a:-1!==t?-1:-1!==a?1:s.items.length-e.items.length}).map(e=>[e.name,e.items])},[A,j,k]),R=m.useMemo(()=>{const e=[];for(const a of A){if(!(null==a?void 0:a.listing))continue;if("number"==typeof a.listing.latitude&&"number"==typeof a.listing.longitude){e.push({id:a.listing.id,lat:a.listing.latitude,lon:a.listing.longitude,product:a});continue}const s=k(a)||a.listing.city||"",t=x(s),n=Object.keys(v).find(e=>e===t),i=n?v[n]:void 0;i&&"number"==typeof i.lat&&"number"==typeof i.lon&&e.push({id:a.listing.id,lat:i.lat,lon:i.lon,product:a})}const s=new Map;e.forEach((e,t)=>{const a=`${e.lat.toFixed(5)},${e.lon.toFixed(5)}`,n=s.get(a);n?n.idxs.push(t):s.set(a,{idxs:[t],lat:e.lat,lon:e.lon})});const t=[...e];return s.forEach(({idxs:e,lat:s,lon:a})=>{if(e.length<=1)return;const n=7e-4;e.forEach((i,l)=>{const o=2*Math.PI*l/e.length,r=n*Math.cos(o),c=n*Math.sin(o)/Math.cos(s*Math.PI/180);t[i]={...t[i],lat:s+r,lon:a+c}})}),t},[A,k,v]),U=m.useMemo(()=>{const e=x(T);if(e&&v[e]){const s=v[e];return[s.lat,s.lon]}return null},[T,v]),Q=m.useMemo(()=>1===R.length?[R[0].lat,R[0].lon]:U,[R,U]);return l.jsxs("div",{className:"min-h-screen bg-white flex flex-col",children:[l.jsx(y,{title:T?`${M("Search")}: ${T}`:M("search.search"),description:M("search.browse_available",{count:A.length,location:T?`${M("search.in")} ${T}`:M("search.across_cameroon")})}),l.jsx(f,{}),l.jsxs("div",{className:"flex-1 flex flex-col md:flex-row overflow-hidden",children:[l.jsxs("div",{className:"w-full md:w-[60%] lg:w-[55%] xl:w-[50%] overflow-y-auto p-6",children:[l.jsxs("div",{className:"mb-4",children:[l.jsxs("p",{className:"text-sm text-gray-500",children:[1===A.length?M("search.stay_count",{count:1}):M("search.stays_count",{count:A.length}),T?` ${M("search.in")} ${T}`:""]}),l.jsx("h1",{className:"text-2xl font-bold mt-1",children:M("search.stays_in",{location:T||M("search.cameroon")})})]}),K&&K.length>0&&l.jsx("div",{className:"flex gap-2 overflow-x-auto pb-3 mb-4 -mx-2 px-2",style:{scrollbarWidth:"none",msOverflowStyle:"none"},children:K.map(e=>l.jsxs("button",{onClick:()=>P(`/marketplace?search=${encodeURIComponent(e.city)}${B>0?`&guests=${B}`:""}`),className:"px-3 py-1.5 rounded-full border text-sm whitespace-nowrap "+(e.city.toLowerCase()===T.toLowerCase()?"bg-black text-white border-black":"bg-white text-gray-800 border-gray-200 hover:border-black"),children:[e.city," ",l.jsxs("span",{className:"text-gray-500",children:["(",e.count,")"]})]},e.city))}),z?l.jsxs("div",{className:"flex flex-col items-center justify-center py-20 gap-4",children:[l.jsxs("div",{className:"relative",children:[l.jsx("div",{className:"h-12 w-12 rounded-full border-4 border-primary/30 border-t-primary animate-spin"}),l.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:l.jsx(o,{className:"h-4 w-4 text-primary/50"})})]}),l.jsx("p",{className:"text-muted-foreground animate-pulse",children:M("search.loading")})]}):0===A.length?l.jsxs("div",{className:"text-center py-20",children:[l.jsx("p",{className:"text-gray-600",children:M("search.no_results")}),l.jsx(a,{variant:"outline",className:"mt-4",onClick:()=>P("/"),children:M("search.clear_filters")})]}):G.map(([e,s])=>l.jsxs("div",{className:"mb-10",children:[l.jsx("h2",{className:"text-xl font-bold mb-6 flex items-center gap-2",children:e}),l.jsx("div",{className:"grid grid-cols-2 gap-3 md:grid-cols-2 md:gap-6",children:s.map(e=>l.jsx("div",{className:"w-full",children:l.jsx(h,{id:e.listing.id,name:e.listing.title??"Untitled",location:e.listing.city||k(e)||"Unknown",price:e.listing.price_per_night??0,images:e.photos.map(e=>({image_url:e.url})),propertyType:e.listing.property_type})},e.listing.id))})]},e)),l.jsx("div",{className:"flex justify-center mt-6"})]}),!F&&l.jsx("div",{className:"hidden md:block w-[40%] lg:w-[45%] xl:w-[50%] h-[calc(100vh-80px)] sticky top-20",children:l.jsx(m.Suspense,{fallback:l.jsx("div",{className:"h-full w-full bg-slate-100 flex items-center justify-center",children:l.jsxs("div",{className:"flex flex-col items-center gap-2",children:[l.jsx(r,{className:"h-8 w-8 text-slate-300 animate-pulse"}),l.jsx("span",{className:"text-sm text-slate-400",children:M("Loading map...")})]})}),children:l.jsx(N,{mapPoints:R,singlePoint:Q,fallbackCenter:U})})})]})]})};export{M as default};
