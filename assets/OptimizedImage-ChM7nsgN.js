import{j as t}from"./vendor-ui-CAOOb9ur.js";import{r as e}from"./vendor-react-C_40T_Qy.js";import{f as r,ac as a}from"./index-CHW3rl59.js";const s={},n=({src:n,alt:o,className:i="",width:c,height:u,priority:m=!1,quality:l,onLoad:d,onError:h,onClick:b})=>{const[g,f]=e.useState(""),[p,w]=e.useState(""),[v,x]=e.useState(!0),[y,S]=e.useState(!1),[P,j]=e.useState(m),k=e.useRef(null),{recommendedImageQuality:L}=r(),R="true"===(null==s?void 0:s.VITE_SUPABASE_TRANSFORM_ENABLED),E=l||L,U=(t,e,r)=>{if(!t)return"";if(t.startsWith("data:")||t.startsWith("blob:"))return t;try{const a=new URL(t,window.location.origin);let s=r;return s||(s="low"===e?400:"medium"===e?800:1200),a.searchParams.set("w",s.toString()),a.searchParams.set("q","low"===e?"30":"medium"===e?"60":"80"),W()&&a.searchParams.set("fm","webp"),a.toString()}catch{return t}},W=()=>{const t=document.createElement("canvas");return!(!t.getContext||!t.getContext("2d"))&&0===t.toDataURL("image/webp").indexOf("data:image/webp")};e.useEffect(()=>{if(m||!k.current)return;const t=new IntersectionObserver(e=>{e.forEach(e=>{e.isIntersecting&&(j(!0),t.disconnect())})},{rootMargin:"50px",threshold:.01});return t.observe(k.current),()=>{t.disconnect()}},[m]),e.useEffect(()=>{if(!P||!n)return;let t=!0;return(async()=>{try{x(!0),S(!1);const e=(t=>{if(!t||t.startsWith("data:")||t.startsWith("blob:"))return"";try{const e=new URL(t,window.location.origin);if(e.hostname.includes("supabase.co")&&e.pathname.includes("/storage/v1/object/public/")&&R){const t=new URL(e.toString());return t.pathname=t.pathname.replace("/storage/v1/object/public/","/storage/v1/render/image/public/"),t.searchParams.set("width","20"),t.searchParams.set("quality","10"),t.searchParams.set("resize","contain"),W()&&t.searchParams.set("format","webp"),t.toString()}return e.searchParams.set("w","20"),e.searchParams.set("q","10"),e.searchParams.set("blur","10"),W()&&e.searchParams.set("fm","webp"),e.toString()}catch{return""}})(n);e&&t&&w(e);const r=await a.getCachedImage(n);if(r&&t){const t=URL.createObjectURL(r);return f(t),x(!1),void(null==d||d())}const s=U(n,E);t&&f(s),(async()=>{try{const t=await fetch(s,{mode:"cors",credentials:"omit"});if(!t.ok)return;const e=await t.blob();await a.cacheImage(n,e).catch(()=>{})}catch{}})()}catch(e){t&&(f(n),S(!0),x(!1),null==h||h())}})(),()=>{t=!1,g&&g.startsWith("blob:")&&URL.revokeObjectURL(g)}},[P,n,E]);const I={backgroundColor:"#e5e7eb",backgroundImage:p?`url(${p})`:v?"linear-gradient(90deg, #e5e7eb 0%, #f3f4f6 50%, #e5e7eb 100%)":void 0,backgroundSize:p?"cover":v?"200% 100%":void 0,backgroundPosition:"center",filter:p&&v?"blur(10px)":void 0,animation:!p&&v?"shimmer 1.5s infinite":void 0,transition:"filter 0.3s ease-out"},O=((t,e)=>{if(!t||t.startsWith("data:")||t.startsWith("blob:"))return"";try{return("low"===e?[400,600]:[400,800,1200]).map(r=>`${U(t,e,r)} ${r}w`).join(", ")}catch{return""}})(n,E),C=!(!O||g&&(g.startsWith("blob:")||g===n)||y);return t.jsxs(t.Fragment,{children:[t.jsx("style",{children:"\n          @keyframes shimmer {\n            0% { background-position: -200% 0; }\n            100% { background-position: 200% 0; }\n          }\n        "}),t.jsx("img",{ref:k,src:g||p||void 0,srcSet:C?O:void 0,sizes:C?"(max-width: 640px) 400px, (max-width: 1024px) 800px, 1200px":void 0,alt:o,className:i,width:c,height:u,loading:m?"eager":"lazy",crossOrigin:"anonymous",style:!g||v?I:{transition:"opacity 0.3s ease-in"},onClick:b,onLoad:()=>{x(!1)},onError:t=>{g!==n&&n?(f(n),S(!0)):(S(!0),x(!1),null==h||h())}})]})};export{n as O};
