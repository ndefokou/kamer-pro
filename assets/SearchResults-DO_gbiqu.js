import{w as q,x as Z,y as G,r as w,j as o,B as I,p as Y,z as J,q as X,H as ee,E as te,G as se,s as oe,I as ne}from"./index-BumHlSai.js";import{Q as re,a as ie,u as ae}from"./useQuery-wQaSLt0g.js";import{M as K,L as A,a as le,T as ce,i as ue,b as de}from"./marker-shadow-CxIpLtgo.js";import{O as me}from"./OptimizedImage-xP7m_j1R.js";import"./LanguageSwitcher-B49yhAFl.js";import{u as he}from"./useWishlist-DPRVGm7i.js";import{S as fe,H as ge}from"./Header-CQjoyTD4.js";import{C as pe}from"./chevron-left-BgQrOA8v.js";import{C as ye}from"./chevron-right-Cey3u9Ra.js";import{P as be}from"./PropertyCard-DJ6Lzmt9.js";import{u as Q}from"./useTranslation-DUME4FCN.js";import{u as U}from"./hooks-Dy30anLC.js";import{P as D}from"./Popup-D1wFBk5c.js";import"./index-BcTPR2G6.js";import"./check-Cw4ObBPz.js";import"./menu-CwDdBYwq.js";import"./star-CVLH76DC.js";import"./heart-DX2l2ZpK.js";var xe=class extends re{constructor(s,c){super(s,c)}bindMethods(){super.bindMethods(),this.fetchNextPage=this.fetchNextPage.bind(this),this.fetchPreviousPage=this.fetchPreviousPage.bind(this)}setOptions(s){super.setOptions({...s,behavior:q()})}getOptimisticResult(s){return s.behavior=q(),super.getOptimisticResult(s)}fetchNextPage(s){return this.fetch({...s,meta:{fetchMore:{direction:"forward"}}})}fetchPreviousPage(s){return this.fetch({...s,meta:{fetchMore:{direction:"backward"}}})}createResult(s,c){var S,$;const{state:a}=s,h=super.createResult(s,c),{isFetching:f,isRefetching:p,isError:v,isRefetchError:N}=h,t=($=(S=a.fetchMeta)==null?void 0:S.fetchMore)==null?void 0:$.direction,g=v&&t==="forward",y=f&&t==="forward",k=v&&t==="backward",R=f&&t==="backward";return{...h,fetchNextPage:this.fetchNextPage,fetchPreviousPage:this.fetchPreviousPage,hasNextPage:G(c,a.data),hasPreviousPage:Z(c,a.data),isFetchNextPageError:g,isFetchingNextPage:y,isFetchPreviousPageError:k,isFetchingPreviousPage:R,isRefetchError:N&&!g&&!k,isRefetching:p&&!y&&!R}}};function we(s,c){return ie(s,xe)}const ve=({title:s,children:c})=>{const a=w.useRef(null),[h,f]=w.useState(!1),[p,v]=w.useState(!0),N=g=>{if(a.current){const y=a.current.clientWidth*.8,k=a.current.scrollLeft+(g==="left"?-y:y);a.current.scrollTo({left:k,behavior:"smooth"})}},t=()=>{if(a.current){const{scrollLeft:g,scrollWidth:y,clientWidth:k}=a.current;f(g>0),v(g<y-k-10)}};return w.useEffect(()=>(t(),window.addEventListener("resize",t),()=>window.removeEventListener("resize",t)),[]),o.jsxs("div",{className:"mb-12 relative group",children:[o.jsx("div",{className:"flex items-center justify-between mb-6 px-4 md:px-0",children:o.jsx("h2",{className:"text-2xl font-bold text-foreground flex items-center gap-2",children:s})}),o.jsxs("div",{className:"relative group/slider",children:[h&&o.jsx(I,{variant:"ghost",size:"icon",onClick:()=>N("left"),className:"hidden md:flex absolute left-0 top-1/2 -translate-y-1/2 -translate-x-4 z-20 h-10 w-10 rounded-full bg-white border border-gray-200 shadow-elevated hover:scale-105 transition-all opacity-0 group-hover/slider:opacity-100",children:o.jsx(pe,{className:"h-5 w-5 text-foreground"})}),p&&o.jsx(I,{variant:"ghost",size:"icon",onClick:()=>N("right"),className:"hidden md:flex absolute right-0 top-1/2 -translate-y-1/2 translate-x-4 z-20 h-10 w-10 rounded-full bg-white border border-gray-200 shadow-elevated hover:scale-105 transition-all opacity-0 group-hover/slider:opacity-100",children:o.jsx(ye,{className:"h-5 w-5 text-foreground"})}),o.jsx("div",{ref:a,onScroll:t,className:"flex gap-4 md:gap-6 overflow-x-auto scrollbar-hide scroll-smooth pb-4 px-4 md:px-0 -mx-4 md:mx-0",style:{scrollbarWidth:"none",msOverflowStyle:"none"},children:c})]})]})},je=()=>{const{t:s}=Q(),c=U(),[a,h]=w.useState([]),f=w.useRef(null),p=w.useRef(""),v=w.useMemo(()=>({restaurant:"ðŸ½ï¸",cafe:"â˜•",fast_food:"ðŸ”",bar:"ðŸº",pub:"ðŸ»",pharmacy:"ðŸ’Š",hospital:"ðŸ¥",bank:"ðŸ¦",atm:"ðŸ§",fuel:"â›½",school:"ðŸ«",university:"ðŸŽ“",library:"ðŸ“š",supermarket:"ðŸ›’",mall:"ðŸ¬",department_store:"ðŸ¬",convenience:"ðŸ›ï¸",bakery:"ðŸ¥–",fitness_centre:"ðŸ‹ï¸",sports_centre:"ðŸŸï¸",park:"ðŸŒ³",hotel:"ðŸ¨",guest_house:"ðŸ ",attraction:"ðŸŽ¯",station:"ðŸš‰",bus_stop:"ðŸš"}),[]),N=t=>A.divIcon({html:`<div style="background:white;border:1px solid #d1d5db;border-radius:12px;padding:2px 3px;font-size:14px;line-height:14px">${t}</div>`,className:"poi-div-icon",iconSize:[24,24],iconAnchor:[12,12]});return w.useEffect(()=>{const t=()=>{const y=c.getZoom();if(y<12){h([]);return}const k=c.getBounds(),R=k.getSouth(),L=k.getWest(),S=k.getNorth(),$=k.getEast(),P=`${R.toFixed(4)},${L.toFixed(4)},${S.toFixed(4)},${$.toFixed(4)}:${y}`;if(P===p.current)return;p.current=P;const C=`${R},${L},${S},${$}`,O=`
[out:json][timeout:25];
(
  node["amenity"~"restaurant|cafe|fast_food|bar|pub|pharmacy|hospital|bank|atm|fuel|school|university|library"](${C});
  node["shop"~"supermarket|mall|department_store|convenience|bakery"](${C});
  node["leisure"~"fitness_centre|sports_centre|park"](${C});
  node["tourism"~"hotel|guest_house|attraction"](${C});
  node["public_transport"="station"](${C});
  node["highway"="bus_stop"](${C});
);
out center 200;`;fetch("https://overpass-api.de/api/interpreter",{method:"POST",body:O,headers:{"Content-Type":"text/plain;charset=UTF-8"}}).then(M=>M.json()).then(M=>{const T=Array.isArray(M==null?void 0:M.elements)?M.elements:[],z=[];for(const n of T){if(n.type!=="node")continue;const r=n.tags||{},l=r.name||"",e=r.amenity||r.shop||r.leisure||r.tourism||(r.highway==="bus_stop"?"bus_stop":r.public_transport==="station"?"station":"");if(!e||typeof n.lat!="number"||typeof n.lon!="number")continue;const i=e.toString(),u=i in v?i:i.split(";")[0],d=v[u]||"ðŸ“";if(z.push({id:String(n.id),lat:n.lat,lon:n.lon,name:l,emoji:d,type:i}),z.length>=200)break}h(z)}).catch(()=>{})},g=()=>{f.current&&window.clearTimeout(f.current),f.current=window.setTimeout(t,600)};return t(),c.on("moveend",g),()=>{c.off("moveend",g),f.current&&window.clearTimeout(f.current)}},[c,v]),o.jsx(o.Fragment,{children:a.map(t=>o.jsx(K,{position:[t.lat,t.lon],icon:N(t.emoji),children:o.jsx(D,{children:o.jsxs("div",{className:"space-y-1",children:[o.jsx("div",{className:"font-semibold text-sm",children:t.name||s(`poi.${t.type}`,{defaultValue:t.type})}),o.jsx("div",{className:"text-xs text-gray-600",children:s(`poi.${t.type}`,{defaultValue:t.type})})]})})},t.id))})},ke=A.icon({iconUrl:de,shadowUrl:ue,iconSize:[25,41],iconAnchor:[12,41]});A.Marker.prototype.options.icon=ke;const Ne=({bounds:s,singlePoint:c})=>{const a=U();return w.useEffect(()=>{s?a.fitBounds(s,{padding:[24,24],maxZoom:12}):c&&a.setView(c,12)},[a,s,c]),null},m=s=>(s||"").trim().toLowerCase().normalize("NFD").replace(new RegExp("\\p{Diacritic}","gu"),""),E=["yaounde","douala","kribi"],b={yaounde:{display:"Yaounde",lat:3.848,lon:11.5021,synonyms:["bastos","biyem","nkolbisson","melen","odza","nkolmesseng","nkoabang","ekounou","essos","madagascar"]},douala:{display:"Douala",lat:4.0511,lon:9.7679,synonyms:["akwa","bonapriso","bonanjo","deido","makepe","ndogbong","logbaba","bepanda","bonamoussadi"]},kribi:{display:"Kribi",lat:2.94,lon:9.91,synonyms:["mpalla","londji","ebambe","lolabe"]},buea:{display:"Buea",lat:4.1527,lon:9.241,synonyms:["molyko","muea","mile 17","bongo square","great soppo","small soppo","bokwango","limbe","tiko","kumba"]},bamenda:{display:"Bamenda",lat:5.9631,lon:10.1591,synonyms:["mankon","bambili","nkambÃ©","kumbo"]},bafoussam:{display:"Bafoussam",lat:5.4769,lon:10.417,synonyms:["dschang","bandjoun","foumban"]},ngaoundere:{display:"Ngaoundere",lat:7.3263,lon:13.5847,synonyms:["adamawa","tibati","meiganga"]},garoua:{display:"Garoua",lat:9.3,lon:13.4,synonyms:[]},maroua:{display:"Maroua",lat:10.5956,lon:14.3247,synonyms:["far north"]},bertoua:{display:"Bertoua",lat:4.5833,lon:13.6833,synonyms:[]},ebolowa:{display:"Ebolowa",lat:2.9,lon:11.15,synonyms:["south"]}},B={centre:["yaounde"],littoral:["douala","nkongsamba","edea"],south:["kribi","ebolowa"],southwest:["buea","limbe","tiko","kumba"],northwest:["bamenda","kumbo","ndop"],west:["bafoussam","dschang","bandjoun"],adamawa:["ngaoundere","tibati","meiganga"],north:["garoua"],"far north":["maroua","kousseri"],east:["bertoua","batouri"]},Pe=(s,c,a,h)=>{const f=y=>y*Math.PI/180,v=f(a-s),N=f(h-c),t=Math.sin(v/2)**2+Math.cos(f(s))*Math.cos(f(a))*Math.sin(N/2)**2;return 6371*(2*Math.atan2(Math.sqrt(t),Math.sqrt(1-t)))},_=s=>{const c=[s.listing.city,s.listing.address,s.listing.title].filter(Boolean).join(" "),a=m(c);if(a){for(const h of E)if(a.includes(h)||b[h].synonyms.some(p=>a.includes(p)))return b[h].display;for(const h of Object.keys(b)){if(E.includes(h))continue;if(a.includes(h)||b[h].synonyms.some(p=>a.includes(p)))return b[h].display}}if(s.listing.latitude&&s.listing.longitude){const{latitude:h,longitude:f}=s.listing;let p=null;if(Object.keys(b).forEach(v=>{const N=b[v],t=Pe(h,f,N.lat,N.lon);(!p||t<p.dist)&&(p={key:v,dist:t})}),p&&p.dist<=80)return b[p.key].display}return""},Qe=()=>{const{t:s}=Q(),c=Y(),[a]=J(),{user:h,logout:f}=X(),{addToWishlist:p,removeFromWishlistByProduct:v,isInWishlist:N}=he(),t=a.get("search")||"";a.get("checkin"),a.get("checkout");const g=parseInt(a.get("guests")||"0"),{data:y,isLoading:k,fetchNextPage:R,hasNextPage:L,isFetchingNextPage:S}=we({queryKey:["products",t,g],initialPageParam:0,queryFn:({pageParam:n})=>{const r=Object.keys(b).includes(m(t))||Object.keys(B).includes(m(t))||m(t)==="other"||m(t)==="buea";return oe({search:t&&!r?t:void 0,guests:g>0?g:void 0,limit:r?100:20,offset:n||0})},getNextPageParam:(n,r)=>{const l=m(t),i=Object.keys(b).includes(l)||Object.keys(B).includes(l)||l==="other"||l==="buea"?100:20;return n.length===i?r.length*i:void 0}}),{data:$}=ae({queryKey:["towns"],queryFn:ne}),P=w.useMemo(()=>{var l;const n=((l=y==null?void 0:y.pages)==null?void 0:l.flat())||[],r=m(t);return n.filter(e=>{if(r){if(!(e!=null&&e.listing))return!1;if(r==="other"){const i=m(_(e)),u=m(e.listing.city||""),d=i||u;if(d&&(E.includes(d)||d==="buea"))return!1}else if(Object.keys(B).includes(r)){const i=B[r].map(j=>m(j)),u=m(e.listing.city||""),d=m(_(e)),x=u||d;if(!x||!i.includes(x))return!1}else if(r==="buea"){const i=m(_(e)),u=m(e.listing.city||"");if(i!=="buea"&&u!=="buea")return!1}else{const i=m(e.listing.city||""),u=m(e.listing.address||""),d=m(e.listing.title||""),x=m(_(e));if(!(i.includes(r)||u.includes(r)||d.includes(r)||x===r))return!1}}return!(g>0&&(e.listing.max_guests||0)<g)})},[y==null?void 0:y.pages,t,g,_,E,B]),C=w.useMemo(()=>{var l;const n=new Map;for(const e of P){if(!(e!=null&&e.listing))continue;let i=(e.listing.city||"").trim();i||(i=_(e));const u=m(t),d=m(i);let x=d,j=i;if(!d&&u&&u!=="other"&&(x=u,j=((l=b[u])==null?void 0:l.display)||t),!x)continue;const F=n.get(x)||{name:j,items:[]};!F.name&&j&&(F.name=j),F.items.push(e),n.set(x,F)}return Array.from(n.values()).sort((e,i)=>{const u=E.indexOf(m(e.name)),d=E.indexOf(m(i.name));return u!==-1&&d!==-1?u-d:u!==-1?-1:d!==-1?1:i.items.length-e.items.length}).map(e=>[e.name,e.items])},[P,E,_]),O=w.useMemo(()=>{const n=[];for(const e of P){if(!(e!=null&&e.listing))continue;if(typeof e.listing.latitude=="number"&&typeof e.listing.longitude=="number"){n.push({id:e.listing.id,lat:e.listing.latitude,lon:e.listing.longitude,product:e});continue}const i=_(e)||e.listing.city||"",u=m(i),d=Object.keys(b).find(j=>j===u),x=d?b[d]:void 0;x&&typeof x.lat=="number"&&typeof x.lon=="number"&&n.push({id:e.listing.id,lat:x.lat,lon:x.lon,product:e})}const r=new Map;n.forEach((e,i)=>{const u=`${e.lat.toFixed(5)},${e.lon.toFixed(5)}`,d=r.get(u);d?d.idxs.push(i):r.set(u,{idxs:[i],lat:e.lat,lon:e.lon})});const l=[...n];return r.forEach(({idxs:e,lat:i,lon:u})=>{if(e.length<=1)return;const d=7e-4,x=j=>j/Math.cos(i*Math.PI/180);e.forEach((j,F)=>{const W=2*Math.PI*F/e.length,H=d*Math.cos(W),V=x(d*Math.sin(W));l[j]={...l[j],lat:i+H,lon:u+V}})}),l},[P,_,b]),M=w.useMemo(()=>{const n=m(t);if(n&&b[n]){const r=b[n];return[r.lat,r.lon]}return null},[t,b]),T=w.useMemo(()=>{const n=O.map(r=>[r.lat,r.lon]);if(!(n.length===0&&M))return n.length?A.latLngBounds(n):void 0},[O,M]),z=w.useMemo(()=>O.length===1?[O[0].lat,O[0].lon]:M,[O,M]);return o.jsxs("div",{className:"min-h-screen bg-white flex flex-col",children:[o.jsx(fe,{title:t?`${s("Search")}: ${t}`:s("search.search"),description:s("search.browse_available",{count:P.length,location:t?`${s("search.in")} ${t}`:s("search.across_cameroon")})}),o.jsx(ge,{}),o.jsxs("div",{className:"flex-1 flex flex-col md:flex-row overflow-hidden",children:[o.jsxs("div",{className:"w-full md:w-[60%] lg:w-[55%] xl:w-[50%] overflow-y-auto p-6",children:[o.jsxs("div",{className:"mb-4",children:[o.jsxs("p",{className:"text-sm text-gray-500",children:[P.length===1?s("search.stay_count",{count:1}):s("search.stays_count",{count:P.length}),t?` ${s("search.in")} ${t}`:""]}),o.jsx("h1",{className:"text-2xl font-bold mt-1",children:s("search.stays_in",{location:t||s("search.cameroon")})})]}),$&&$.length>0&&o.jsx("div",{className:"flex gap-2 overflow-x-auto pb-3 mb-4 -mx-2 px-2",style:{scrollbarWidth:"none",msOverflowStyle:"none"},children:$.map(n=>o.jsxs("button",{onClick:()=>c(`/marketplace?search=${encodeURIComponent(n.city)}${g>0?`&guests=${g}`:""}`),className:`px-3 py-1.5 rounded-full border text-sm whitespace-nowrap ${n.city.toLowerCase()===t.toLowerCase()?"bg-black text-white border-black":"bg-white text-gray-800 border-gray-200 hover:border-black"}`,children:[n.city," ",o.jsxs("span",{className:"text-gray-500",children:["(",n.count,")"]})]},n.city))}),k?o.jsxs("div",{className:"flex flex-col items-center justify-center py-20 gap-4",children:[o.jsxs("div",{className:"relative",children:[o.jsx("div",{className:"h-12 w-12 rounded-full border-4 border-primary/30 border-t-primary animate-spin"}),o.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:o.jsx(ee,{className:"h-4 w-4 text-primary/50"})})]}),o.jsx("p",{className:"text-muted-foreground animate-pulse",children:s("search.loading")})]}):P.length===0?o.jsxs("div",{className:"text-center py-20",children:[o.jsx("p",{className:"text-gray-600",children:s("search.no_results")}),o.jsx(I,{variant:"outline",className:"mt-4",onClick:()=>c("/"),children:s("search.clear_filters")})]}):C.map(([n,r])=>o.jsx(ve,{title:n,children:r.map(l=>o.jsx("div",{className:"w-[200px] sm:w-[280px]",children:o.jsx(be,{id:l.listing.id,name:l.listing.title??"Untitled",location:l.listing.city||_(l)||"Unknown",price:l.listing.price_per_night??0,images:l.photos.map(e=>({image_url:e.url}))})},l.listing.id))},n)),o.jsx("div",{className:"flex justify-center mt-6",children:L&&o.jsx(I,{onClick:()=>R(),disabled:S,variant:"outline",children:s(S?"search.loading_more":"search.load_more")})})]}),o.jsx("div",{className:"hidden md:block w-[40%] lg:w-[45%] xl:w-[50%] h-[calc(100vh-80px)] sticky top-20",children:o.jsxs(le,{center:[3.848,11.5021],zoom:13,scrollWheelZoom:!0,className:"h-full w-full",children:[o.jsx(ce,{attribution:'Â© <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png"}),o.jsx(Ne,{bounds:T,singlePoint:z}),o.jsx(je,{}),O.map(({id:n,lat:r,lon:l,product:e})=>{var i;return o.jsx(K,{position:[r,l],children:o.jsx(D,{children:o.jsxs("div",{className:"w-48",children:[o.jsx(me,{src:te((i=e.photos[0])==null?void 0:i.url)||"https://images.unsplash.com/photo-1568605114967-8130f3a36994?w=400&h=400&fit=crop",alt:e.listing.title,className:"w-full h-32 object-cover rounded-lg mb-2"}),o.jsx("h3",{className:"font-semibold text-sm truncate",children:e.listing.title}),o.jsx("p",{className:"text-sm font-bold",children:se(e.listing.price_per_night||0)})]})})},n)})]})})]})]})};export{Qe as default};
