import{j as o,r as e,a7 as t,X as s}from"./vendor-ui-CAOOb9ur.js";import{f as r,i as a,r as i}from"./vendor-react-C_40T_Qy.js";import{I as l,o as n}from"./index-CHW3rl59.js";import{O as d}from"./OptimizedImage-ChM7nsgN.js";import{u as c}from"./useTranslation-DgYtz7Wb.js";import"./vendor-charts-knjLkUkQ.js";import"./vendor-utils-tyqSID0v.js";const h=()=>{const h=r(),{t:p}=c(),{id:m}=a(),[u,g]=i.useState([]),[x,b]=i.useState([]),[f,y]=i.useState(!1),v=i.useRef(null);i.useEffect(()=>{j()},[m]);const j=async()=>{var o;try{const e=await l.get(`/listings/${m}`),t=(null==(o=e.data.photos)?void 0:o.filter(o=>{var e;return(null==(e=o.caption)?void 0:e.toLowerCase().includes("bathroom"))||"bathroom"===o.room_type}))||[];g(t)}catch(e){}},w=u.length+x.length;return o.jsxs("div",{className:"min-h-screen bg-white",children:[o.jsx("header",{className:"sticky top-0 bg-white border-b border-gray-200 z-10",children:o.jsxs("div",{className:"max-w-7xl mx-auto px-6 h-16 flex items-center justify-between",children:[o.jsx("button",{onClick:()=>h(`/host/editor/${m}`),className:"p-2 hover:bg-gray-100 rounded-full transition-colors",children:o.jsx(e,{className:"h-5 w-5"})}),o.jsx("h2",{className:"text-lg font-semibold",children:p("host.editor.fullBathroom","Full bathroom")}),o.jsx("div",{className:"w-10"})]})}),o.jsxs("div",{className:"max-w-4xl mx-auto px-6 py-8",children:[o.jsx("h1",{className:"text-3xl font-semibold mb-2",children:p("host.editor.bathroomPhotos","Bathroom photos")}),o.jsx("p",{className:"text-gray-500 mb-8",children:p("host.editor.addBathroomPhotosHelp","Add photos of your bathroom. You can select multiple photos at once.")}),w>0&&o.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-4 mb-6",children:[u.map(e=>o.jsxs("div",{className:"relative aspect-square rounded-lg overflow-hidden border border-gray-200 group",children:[o.jsx(d,{src:n(e.url),alt:e.caption,className:"w-full h-full object-cover"}),o.jsx("div",{className:"absolute inset-0 bg-black/40 opacity-0 group-hover:opacity-100 transition-opacity flex items-start justify-end p-2",children:o.jsx("button",{onClick:()=>(async o=>{if(confirm(p("host.editor.confirmDeletePhoto","Are you sure you want to delete this photo?")))try{const e=((await l.get(`/listings/${m}`)).data.photos||[]).filter(e=>String(e.id)!==String(o)).map((o,e)=>({url:o.url,caption:o.caption,room_type:o.room_type,is_cover:1===o.is_cover,display_order:e}));await l.post(`/listings/${m}/photos`,{photos:e}),g(e=>e.filter(e=>String(e.id)!==String(o)))}catch(e){}})(e.id),className:"p-1.5 bg-white rounded-full text-red-600 hover:bg-gray-100 shadow-sm",title:p("common.delete","Delete"),children:o.jsx(t,{className:"h-4 w-4"})})})]},e.id)),x.map((e,t)=>o.jsxs("div",{className:"relative aspect-square rounded-lg overflow-hidden border-2 border-green-500",children:[o.jsx(d,{src:e.preview,alt:p("common.pendingUpload","Pending upload"),className:"w-full h-full object-cover"}),o.jsx("button",{onClick:()=>(o=>{b(e=>{const t=[...e];return URL.revokeObjectURL(t[o].preview),t.splice(o,1),t})})(t),className:"absolute top-2 right-2 p-1.5 bg-white rounded-full shadow-lg hover:bg-gray-100 transition-colors",children:o.jsx(s,{className:"h-4 w-4"})}),o.jsx("div",{className:"absolute bottom-2 left-2 px-2 py-1 bg-green-500 text-white text-xs font-medium rounded",children:p("common.new","New")})]},`pending-${t}`))]}),o.jsxs("div",{className:"border-2 border-dashed border-gray-300 rounded-xl p-12 text-center bg-white mb-6",children:[0===w&&o.jsx("div",{className:"mb-6",children:o.jsxs("svg",{className:"h-32 w-32 mx-auto mb-6",viewBox:"0 0 120 100",fill:"none",children:[o.jsx("rect",{x:"20",y:"50",width:"80",height:"30",rx:"4",fill:"#E5E7EB",stroke:"#9CA3AF",strokeWidth:"1.5"}),o.jsx("rect",{x:"25",y:"55",width:"70",height:"15",rx:"2",fill:"#60A5FA",opacity:"0.6"}),o.jsx("circle",{cx:"30",cy:"45",r:"3",fill:"#9CA3AF"}),o.jsx("rect",{x:"28",y:"35",width:"4",height:"10",fill:"#9CA3AF"}),o.jsx("ellipse",{cx:"30",cy:"82",rx:"4",ry:"2",fill:"#6B7280"}),o.jsx("ellipse",{cx:"90",cy:"82",rx:"4",ry:"2",fill:"#6B7280"})]})}),o.jsx("input",{ref:v,type:"file",multiple:!0,accept:"image/*",onChange:o=>{const e=o.target.files;if(!e||0===e.length)return;const t=Array.from(e).map(o=>({file:o,preview:URL.createObjectURL(o)}));b(o=>[...o,...t]),v.current&&(v.current.value="")},className:"hidden"}),o.jsx("button",{onClick:()=>{var o;return null==(o=v.current)?void 0:o.click()},disabled:f,className:"px-6 py-2 border border-gray-900 rounded-lg font-medium hover:bg-gray-100 transition-colors disabled:opacity-50",children:0===w?p("host.editor.addPhotos","Add photos"):p("host.photos.addMorePhotos","Add more photos")}),x.length>0&&o.jsxs("p",{className:"text-sm text-gray-500 mt-3",children:[x.length," ",1!==x.length?p("host.photos.photosPlural","photos"):p("host.photos.photoSingular","photo")," ",p("host.photos.readyToUpload","ready to upload")]})]}),x.length>0&&o.jsxs("div",{className:"flex justify-end gap-3",children:[o.jsx("button",{onClick:()=>{x.forEach(o=>URL.revokeObjectURL(o.preview)),b([])},disabled:f,className:"px-6 py-3 border border-gray-300 rounded-lg font-medium hover:bg-gray-50 transition-colors disabled:opacity-50",children:p("common.cancel","Cancel")}),o.jsx("button",{onClick:async()=>{if(0!==x.length){y(!0);try{const o=(await l.get(`/listings/${m}`)).data.photos||[],e=[];for(const r of x){const o=new FormData;o.append("file",r.file);const t=await l.post("/upload/images",o,{headers:{"Content-Type":"multipart/form-data"}});e.push(t.data.urls[0])}const t=o.map(o=>({url:o.url,caption:o.caption,room_type:o.room_type,is_cover:1===o.is_cover,display_order:o.display_order})),s=e.map(o=>({url:o,caption:"Bathroom photo",room_type:"bathroom",is_cover:!1,display_order:0}));await l.post(`/listings/${m}/photos`,{photos:[...t,...s]}),x.forEach(o=>URL.revokeObjectURL(o.preview)),b([]),await j()}catch(o){}finally{y(!1)}}},disabled:f,className:"px-6 py-3 bg-black text-white rounded-lg font-medium hover:bg-gray-800 transition-colors disabled:opacity-50",children:f?p("common.saving","Saving..."):p("common.savePhotosCount","Save {{count}} {{unit}}",{count:x.length,unit:1!==x.length?p("host.photos.photosPlural","photos"):p("host.photos.photoSingular","photo")})})]})]})]})};export{h as default};
