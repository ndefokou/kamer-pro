const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/ReviewModal-cw-IXcPT.js","assets/vendor-ui-CAOOb9ur.js","assets/vendor-react-C_40T_Qy.js","assets/index-CHW3rl59.js","assets/vendor-charts-knjLkUkQ.js","assets/vendor-utils-tyqSID0v.js","assets/index-i5g5NqsL.css","assets/textarea-DUrprI0I.js","assets/label-C4Tkq_z1.js","assets/ShareModal-C-5bD-rH.js","assets/OptimizedImage-ChM7nsgN.js","assets/MessageHostModal-DOlE-x0c.js","assets/ReportHostModal-Bb39Kn6d.js","assets/PhotoGallery-DO-uiyqH.js","assets/ListingMap-ELFvvJAA.js","assets/vendor-maps-B_ay1OW3.js","assets/marker-shadow-D5DIcCoR.js","assets/marker-shadow-Dgihpmma.css","assets/useTranslation-DgYtz7Wb.js"])))=>i.map(i=>d[i]);
import{c as e,n as s,f as t,B as i,o as l,p as a,D as n,r,s as o,t as c,v as d,w as m,_ as u,x as h,y as x,q as g}from"./index-CHW3rl59.js";import{j as p,c as f,P as v,K as j,J as b,I as N,M as w,z as y,G as _,N as k,Q as C,X as S,r as D,q as I}from"./vendor-ui-CAOOb9ur.js";import{r as M,i as P,f as R,R as F}from"./vendor-react-C_40T_Qy.js";import{u as O}from"./useQuery-DUJaOdb7.js";import{L as $}from"./Loading-CFf4ybmz.js";import{O as A}from"./OptimizedImage-ChM7nsgN.js";import{o as E}from"./whatsapp-B6PH0vCN.js";import{D as T,A as L}from"./HouseRulesSection-C_sNNjuX.js";import{F as z}from"./Footer-D45jx7FM.js";import{S as q,H}from"./Header--VKnAQ8w.js";import{D as V}from"./index.esm-CUuDCt5y.js";import{A as Y,a as W,b as J}from"./avatar-Cbexax3d.js";import{u as U}from"./useWishlist-XpO0FfUG.js";import{T as B}from"./TranslatedText-BL0fQdvT.js";import{u as G}from"./useTranslation-DgYtz7Wb.js";import{f as K}from"./fr-qjbnyBeO.js";import{e as Q,f as X}from"./vendor-utils-tyqSID0v.js";import"./vendor-charts-knjLkUkQ.js";import"./LanguageSwitcher-CRTEz5Uf.js";import"./index-BzbEf57Q.js";var Z="Progress",[ee]=f(Z),[se,te]=ee(Z),ie=M.forwardRef((e,s)=>{const{__scopeProgress:t,value:i=null,max:l,getValueLabel:a=ne,...n}=e;(l||0===l)&&ce(l);const r=ce(l)?l:100;null!==i&&de(i,r);const o=de(i,r)?i:null,c=oe(o)?a(o,r):void 0;return p.jsx(se,{scope:t,value:o,max:r,children:p.jsx(v.div,{"aria-valuemax":r,"aria-valuemin":0,"aria-valuenow":oe(o)?o:void 0,"aria-valuetext":c,role:"progressbar","data-state":re(o,r),"data-value":o??void 0,"data-max":r,...n,ref:s})})});ie.displayName=Z;var le="ProgressIndicator",ae=M.forwardRef((e,s)=>{const{__scopeProgress:t,...i}=e,l=te(le,t);return p.jsx(v.div,{"data-state":re(l.value,l.max),"data-value":l.value??void 0,"data-max":l.max,...i,ref:s})});function ne(e,s){return`${Math.round(e/s*100)}%`}function re(e,s){return null==e?"indeterminate":e===s?"complete":"loading"}function oe(e){return"number"==typeof e}function ce(e){return oe(e)&&!isNaN(e)&&e>0}function de(e,s){return oe(e)&&!isNaN(e)&&e<=s&&e>=0}ae.displayName=le;var me=ie,ue=ae;const he=M.forwardRef(({className:s,value:t,...i},l)=>p.jsx(me,{ref:l,className:e("relative h-4 w-full overflow-hidden rounded-full bg-secondary",s),...i,children:p.jsx(ue,{className:"h-full w-full flex-1 bg-primary transition-all",style:{transform:`translateX(-${100-(t||0)}%)`}})}));he.displayName=me.displayName;const xe=M.lazy(()=>u(()=>import("./ReviewModal-cw-IXcPT.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8]))),ge=M.lazy(()=>u(()=>import("./ShareModal-C-5bD-rH.js"),__vite__mapDeps([9,1,2,3,4,5,6,10]))),pe=M.lazy(()=>u(()=>import("./MessageHostModal-DOlE-x0c.js"),__vite__mapDeps([11,1,2,3,4,5,6,7]))),fe=M.lazy(()=>u(()=>import("./ReportHostModal-Bb39Kn6d.js"),__vite__mapDeps([12,1,2,3,4,5,6,8,7]))),ve=M.lazy(()=>u(()=>import("./PhotoGallery-DO-uiyqH.js"),__vite__mapDeps([13,1,2,3,4,5,6,10]))),je=M.lazy(()=>u(()=>import("./ListingMap-ELFvvJAA.js"),__vite__mapDeps([14,1,2,15,16,17,18,3,4,5,6]))),be=()=>{var e,u;const{id:f}=P(),v=R(),{addToWishlist:Z,removeFromWishlistByProduct:ee,isInWishlist:se}=U(),{data:te,isLoading:ie,error:le,refetch:ae}=O({queryKey:["listing",f],queryFn:()=>g(f),enabled:!!f});F.useEffect(()=>{if(!f)return;let e=null;const s=e=>{const s=e.detail;(null==s?void 0:s.listingId)===f&&ae()};try{"BroadcastChannel"in window&&(e=new BroadcastChannel("calendar-updates"),e.onmessage=e=>{const s=e.data;"calendar_updated"===(null==s?void 0:s.type)&&s.listingId===f&&ae()})}catch{}return window.addEventListener("calendar_updated",s),()=>{window.removeEventListener("calendar_updated",s);try{null==e||e.close()}catch{}}},[f,ae]);const[ne,re]=F.useState(null),[oe,ce]=F.useState(null),[de,me]=F.useState(1),[ue,be]=F.useState(0),[Ne,we]=F.useState(0),[ye,_e]=F.useState(0),[ke,Ce]=F.useState(!1),[Se,De]=F.useState(new Date),[Ie,Me]=F.useState(!1),[Pe,Re]=F.useState(!1),[Fe,Oe]=F.useState(!1),[$e,Ae]=F.useState(!1),[Ee,Te]=F.useState(!1),[Le,ze]=F.useState(!1),[qe,He]=F.useState(!1),{t:Ve,i18n:Ye}=G(),We="fr"===Ye.language?K:Q,Je=(null==(e=Ye.language)?void 0:e.startsWith("fr"))?"fr-FR":"en-US",[Ue,Be]=F.useState(0),[Ge,Ke]=F.useState([]),{toast:Qe}=s(),Xe=F.useRef(null),Ze=F.useRef(null),es=F.useRef(null),{isSlowConnection:ss}=t(),[ts,is]=F.useState(!ss);F.useEffect(()=>{if(ts||!es.current)return;const e=new IntersectionObserver(s=>{s.forEach(s=>{s.isIntersecting&&(is(!0),e.disconnect())})},{rootMargin:"100px",threshold:.1});return e.observe(es.current),()=>{e.disconnect()}},[ts]);const ls=()=>{var e,s;try{null==(s=null==(e=document.activeElement)?void 0:e.blur)||s.call(e)}catch{}Re(!0)},as=F.useCallback(e=>{let s={cleanliness:5,accuracy:5,checkin:5,communication:5,location:5,value:5};try{e.ratings&&"string"==typeof e.ratings&&(s=JSON.parse(e.ratings)),e.ratings&&"object"==typeof e.ratings&&(s=e.ratings)}catch{}return{id:Number(e.id),user:{name:e.username||"Guest",avatar:e.avatar||"https://github.com/shadcn.png"},guestId:Number(e.guest_id),ratings:s,comment:e.comment||"",timestamp:e.created_at||(new Date).toISOString()}},[]);F.useEffect(()=>{(async()=>{if(f)try{const e=await m(f);Ke(e.map(as))}catch(e){}})()},[f,as]);const ns=F.useMemo(()=>(null==te?void 0:te.photos)?[...te.photos].sort((e,s)=>(s.is_cover||0)-(e.is_cover||0)):[],[null==te?void 0:te.photos]),rs=F.useMemo(()=>(null==te?void 0:te.unavailable_dates)?te.unavailable_dates.map(e=>({from:new Date(e.check_in),to:new Date(e.check_out)})):[],[null==te?void 0:te.unavailable_dates]);if(ie)return p.jsx($,{fullScreen:!0,message:Ve("common.loading","Loading...")});if(le||!te)return p.jsxs("div",{className:"min-h-screen flex flex-col items-center justify-center gap-4",children:[p.jsx("h1",{className:"text-2xl font-bold",children:Ve("listing.errors.notFound")}),p.jsx(i,{onClick:()=>v("/"),children:Ve("listing.actions.goHome")})]});const{listing:os,amenities:cs}=te,ds=(te.host_username||"").trim()||"Host",ms=te.host_avatar??localStorage.getItem("host_avatar")??void 0,us=de+ue,hs=Number(localStorage.getItem("userId"))===os.host_id,xs=Number(localStorage.getItem("userId")||"")||null,gs=se(os.id),ps=!!xs&&Ge.some(e=>e.guestId===xs),fs=ne&&oe?Math.ceil((oe.getTime()-ne.getTime())/864e5):0,vs=fs*(os.price_per_night||0),js=vs+0,bs=(e,s)=>!!e&&(e.getDate()===s.getDate()&&e.getMonth()===s.getMonth()&&e.getFullYear()===s.getFullYear()),Ns=e=>!(!ne||!oe)&&(e>ne&&e<oe),ws=e=>!!(e<new Date((new Date).setHours(0,0,0,0)))||rs.some(s=>e>=s.from&&e<s.to),ys=e=>{if(!ws(e))if(!ne||ne&&oe)re(e),ce(null);else if(e>ne){if(rs.some(s=>s.from>ne&&s.from<e||s.to>ne&&s.to<e||s.from<=ne&&s.to>=e))return void Qe({title:"Dates unavailable",description:"Selected range includes unavailable dates.",variant:"destructive"});ce(e)}else re(e),ce(null)},_s=()=>{De(new Date(Se.getFullYear(),Se.getMonth()+1))},ks=()=>{De(new Date(Se.getFullYear(),Se.getMonth()-1))},Cs=async()=>{if(hs)return void Qe({title:"Not allowed",description:"You cannot reserve your own listing.",variant:"destructive"});if(!ne||!oe)return void Me(!0);if(!!!localStorage.getItem("userId"))return Qe({title:"Account required",description:"Please create an account or log in to reserve a listing.",variant:"destructive"}),void(window.location.href=`/login?tab=register&redirect=${encodeURIComponent("/")}`);if((os.max_guests||0)>0&&us>(os.max_guests||0))Qe({title:"Too many guests",description:`This place allows up to ${os.max_guests} guests. Reduce the number of guests to continue.`,variant:"destructive"});else try{await x({listing_id:os.id,check_in:X(ne,"yyyy-MM-dd"),check_out:X(oe,"yyyy-MM-dd"),guests:us}),Qe({title:"Reservation successful",description:"Your reservation request has been sent."}),v("/bookings")}catch(e){Qe({title:"Reservation failed",description:"Please try again.",variant:"destructive"})}};let Ss=T;try{Ss=os.house_rules?JSON.parse(os.house_rules):T}catch(Ms){Ss=T}let Ds=[],Is=os.description||null;try{if(os.description&&os.description.trim().startsWith("{")){const e=JSON.parse(os.description);Ds=[["listingDescription",Ve("listing.details.about")],["propertyDetails",Ve("propertyDetails")],["guestAccess",Ve("guestAccess")],["guestInteraction",Ve("guestInteraction")],["otherNotes",Ve("otherNotes")],["otherDetails",Ve("otherDetails")]].map(([s,t])=>({title:t,text:"string"==typeof e[s]?e[s].trim():""})).filter(e=>e.text),Ds.length>0&&(Is=null)}}catch(Ms){Ds=[],Is=os.description||null}return p.jsxs("div",{className:"min-h-screen bg-background pb-20",children:[p.jsx(q,{title:os.title||Ve("listing.details.untitled"),description:(null==(u=os.description)?void 0:u.substring(0,160))||Ve("listing.details.seoDescription"),image:ns[0]?l(ns[0].url):void 0,type:"article"}),p.jsx(H,{}),p.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[p.jsxs("div",{className:"flex justify-between items-start mb-6",children:[p.jsxs("div",{children:[p.jsx("h1",{className:"text-2xl md:text-3xl font-bold mb-2",children:p.jsx(B,{as:"span",text:os.title})}),p.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[p.jsxs("span",{className:"font-medium text-foreground",children:["★ ",Ve("listing.details.new")]}),p.jsx("span",{children:"•"}),p.jsxs("span",{className:"underline",children:[os.city,", ",os.country]})]})]}),p.jsxs("div",{className:"flex gap-2",children:[p.jsxs(i,{variant:"outline",size:"sm",className:"gap-2",onClick:()=>Ae(!0),children:[p.jsx(j,{className:"h-4 w-4"}),Ve("listing.actions.share")]}),p.jsxs(i,{variant:"outline",size:"sm",className:"gap-2",onClick:()=>{if(!f)return;const e=f;gs?ee(e):Z(e)},children:[p.jsx(b,{className:"h-4 w-4 "+(gs?"fill-green-600 text-green-600":"")}),Ve("listing.actions.save")]})]})]}),p.jsx(M.Suspense,{fallback:null,children:p.jsx(ge,{isOpen:$e,onClose:()=>Ae(!1),listing:{...os,photos:ns}})}),p.jsx(M.Suspense,{fallback:null,children:p.jsx(pe,{isOpen:Ee,onClose:()=>Te(!1),listingId:os.id,hostId:os.host_id,hostName:ds})}),p.jsx(M.Suspense,{fallback:null,children:p.jsx(fe,{isOpen:Le,onClose:()=>ze(!1),hostId:os.host_id,listingId:os.id})}),p.jsx(M.Suspense,{fallback:null,children:p.jsx(ve,{isOpen:qe,onClose:()=>He(!1),photos:ns,initialPhotoIndex:Ue})}),p.jsx("div",{className:"mb-8 rounded-xl overflow-hidden shadow-sm",children:ns.length>0?p.jsxs("div",{className:"relative group",children:[1===ns.length?p.jsx(A,{src:l(ns[0].url),alt:os.title,className:"w-full h-[300px] sm:h-[400px] md:h-[500px] object-cover cursor-pointer hover:scale-105 transition-transform duration-700",onClick:()=>{Be(0),He(!0)},priority:!0}):ns.length<=4?p.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-2",children:ns.slice(0,4).map((e,s)=>p.jsx("div",{className:"relative overflow-hidden cursor-pointer "+(0===s?"sm:col-span-2 h-[300px] sm:h-[400px]":"h-[200px] sm:h-[250px]"),onClick:()=>{Be(s),He(!0)},children:p.jsx(A,{src:l(e.url),alt:`Photo ${s+1}`,className:"w-full h-full object-cover hover:scale-105 transition-transform duration-500",quality:0===s?"high":"medium"})},e.id))}):p.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-2 h-[300px] md:h-[450px]",children:[p.jsx("div",{className:"md:col-span-2 md:row-span-2 relative cursor-pointer overflow-hidden h-full",onClick:()=>{Be(0),He(!0)},children:p.jsx(A,{src:l(ns[0].url),alt:os.title,className:"w-full h-full object-cover hover:scale-105 transition-transform duration-500",quality:"high",priority:!0})}),p.jsx("div",{className:"hidden md:grid md:col-span-2 md:grid-cols-2 md:grid-rows-2 gap-2 h-full",children:ns.slice(1,5).map((e,s)=>p.jsx("div",{className:"relative cursor-pointer overflow-hidden h-full",onClick:()=>{Be(s+1),He(!0)},children:p.jsx(A,{src:l(e.url),alt:`Photo ${s+2}`,className:"w-full h-full object-cover hover:scale-105 transition-transform duration-500",quality:"medium"})},e.id))})]}),p.jsxs("button",{className:"absolute bottom-4 right-4 bg-white/90 backdrop-blur-sm px-4 py-2 rounded-lg border border-black/10 font-medium text-sm hover:bg-white hover:scale-105 transition-all shadow-sm flex items-center gap-2",onClick:()=>{Be(0),He(!0)},children:[p.jsx("span",{className:"hidden sm:inline",children:Ve("listing.actions.showAllPhotos",{defaultValue:"Show all photos"})}),p.jsx("span",{className:"sm:hidden",children:Ve("listing.details.photos",{defaultValue:"Photos"})})]})]}):p.jsx("div",{className:"w-full h-64 md:h-[400px] bg-muted flex items-center justify-center rounded-xl",children:p.jsx("p",{className:"text-muted-foreground",children:Ve("listing.details.noPhotos")})})}),p.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-12",children:[p.jsxs("div",{className:"md:col-span-2",children:[p.jsxs("div",{className:"border-b pb-6 mb-6",children:[p.jsx("h2",{className:"text-xl font-semibold mb-1",children:p.jsx(B,{as:"span",text:os.title})}),p.jsxs("p",{className:"text-muted-foreground",children:[Ve("listing.details.unitCount.guests",{count:os.max_guests})," • ",Ve("listing.details.unitCount.bedrooms",{count:os.bedrooms})," • ",Ve("listing.details.unitCount.beds",{count:os.beds})," • ",Ve("listing.details.unitCount.baths",{count:os.bathrooms})]})]}),p.jsxs("div",{className:"border-b pb-6 mb-6",children:[p.jsx("h3",{className:"font-semibold mb-4",children:Ve("listing.details.about")}),Ds.length>0?p.jsx("div",{className:"space-y-4",children:Ds.map((e,s)=>p.jsxs("div",{className:"space-y-1",children:[p.jsx("div",{className:"font-semibold",children:e.title}),p.jsx(B,{as:"p",className:"text-muted-foreground whitespace-pre-line",text:e.text})]},s))}):p.jsx(B,{as:"p",className:"text-muted-foreground whitespace-pre-line",text:Is||""})]}),p.jsxs("div",{className:"border-b pb-6 mb-6",children:[p.jsx("h3",{className:"font-semibold mb-4",children:Ve("listing.details.offers")}),p.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:cs.slice(0,10).map(e=>{const s=L[e];if(!s)return null;const t=s.icon;return p.jsxs("div",{className:"flex items-center gap-3",children:[p.jsx(t,{className:"h-6 w-6 text-gray-700"}),p.jsx("span",{className:"text-gray-900",children:Ve(`amenities.${e}`,{defaultValue:s.label})})]},e)})}),cs.length>10&&p.jsx(i,{variant:"outline",className:"mt-6",children:Ve("listing.details.showAllAmenities",{count:cs.length})})]}),p.jsxs("div",{className:"border-b pb-12 mb-12",children:[p.jsx("h3",{className:"text-xl font-semibold mb-2",children:ne&&oe?Ve("listing.details.nightsInCity",{count:Math.ceil((oe.getTime()-ne.getTime())/864e5),city:os.city}):Ve("listing.details.selectCheckIn")}),p.jsx("p",{className:"text-muted-foreground mb-6",children:ne&&oe?`${X(ne,"MMM d, yyyy",{locale:We})} - ${X(oe,"MMM d, yyyy",{locale:We})}`:Ve("listing.details.addDatesPricing")}),p.jsx("div",{className:"hidden md:block",children:p.jsx(V,{mode:"range",selected:ne?{from:ne,to:oe||void 0}:void 0,onSelect:e=>{(null==e?void 0:e.from)&&re(e.from),ce((null==e?void 0:e.to)||null),e||(re(null),ce(null))},numberOfMonths:2,pagedNavigation:!0,disabled:[{before:new Date},...rs],modifiersStyles:{selected:{backgroundColor:"#222222",color:"white"},range_middle:{backgroundColor:"#F7F7F7",color:"#222222"},range_start:{backgroundColor:"#222222",color:"white"},range_end:{backgroundColor:"#222222",color:"white"}},locale:We,className:"border-0"})}),p.jsx("div",{className:"md:hidden flex justify-center",children:p.jsx(V,{mode:"range",selected:ne?{from:ne,to:oe||void 0}:void 0,onSelect:e=>{(null==e?void 0:e.from)&&re(e.from),ce((null==e?void 0:e.to)||null),e||(re(null),ce(null))},numberOfMonths:1,disabled:[{before:new Date},...rs],modifiersStyles:{selected:{backgroundColor:"#222222",color:"white"},range_middle:{backgroundColor:"#F7F7F7",color:"#222222"},range_start:{backgroundColor:"#222222",color:"white"},range_end:{backgroundColor:"#222222",color:"white"}},locale:We})}),p.jsx("div",{className:"flex justify-end mt-4",children:p.jsx(i,{variant:"ghost",className:"underline font-semibold",onClick:()=>{re(null),ce(null)},children:Ve("listing.actions.clearDates")})})]}),p.jsxs("div",{className:"border-b pb-12 mb-12",children:[p.jsxs("div",{className:"flex items-center justify-between mb-8",children:[p.jsxs("div",{className:"flex items-center gap-2",children:[p.jsx(N,{className:"h-5 w-5 fill-current"}),p.jsx("h2",{className:"text-2xl font-semibold",children:0===Ge.length?Ve("listing.reviews.noReviewsYet"):`${(Ge.reduce((e,s)=>e+Object.values(s.ratings).reduce((e,s)=>e+s,0)/6,0)/Ge.length).toFixed(2)} · ${Ve("listing.reviews.count",{count:Ge.length})}`})]}),p.jsx(i,{variant:"outline",disabled:ps,onClick:()=>{if(!xs){Qe({title:"Login required",description:"Please log in to write a review.",variant:"destructive"});const e=`${window.location.pathname}${window.location.search}`;return void(window.location.href=`/login?redirect=${encodeURIComponent(e||"/")}`)}ps?Qe({title:"Already reviewed",description:"You can only review this listing once."}):Oe(!0)},children:Ve("listing.actions.writeReview")})]}),p.jsx(xe,{isOpen:Fe,onClose:()=>Oe(!1),onSubmit:async e=>{var s;if(f)try{const s=await h(f,{ratings:e.ratings,comment:e.comment}),t=as(s);Ke(e=>[t,...e]),Oe(!1),Qe({title:Ve("Success"),description:Ve("Thank you for your feedback!")})}catch(t){const e=null==(s=t.response)?void 0:s.status;if(409===e)return Oe(!1),void Qe({title:Ve("Already reviewed"),description:Ve("You can only review this listing once."),variant:"destructive"});if(401===e){Qe({title:Ve("Login required"),description:Ve("Please log in to write a review."),variant:"destructive"});const e=`${window.location.pathname}${window.location.search}`;return void(window.location.href=`/login?redirect=${encodeURIComponent(e||"/")}`)}Qe({title:Ve("Failed to submit review"),description:Ve("Please try again later."),variant:"destructive"})}}}),Ge.length>0&&p.jsxs(p.Fragment,{children:[p.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-x-12 gap-y-4 mb-8",children:["cleanliness","accuracy","checkin","communication","location","value"].map(e=>{const s=Ge.reduce((s,t)=>s+t.ratings[e],0)/Ge.length;return p.jsxs("div",{className:"flex items-center justify-between",children:[p.jsx("span",{className:"text-sm md:text-base capitalize",children:Ve(`listing.reviews.categories.${e}`)}),p.jsxs("div",{className:"flex items-center gap-3 w-1/2",children:[p.jsx(he,{value:20*s,className:"h-1"}),p.jsx("span",{className:"text-xs font-semibold",children:s.toFixed(1)})]})]},e)})}),p.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-8",children:Ge.map(e=>p.jsxs("div",{children:[p.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[p.jsxs(Y,{className:"h-10 w-10",children:[p.jsx(W,{src:e.user.avatar}),p.jsx(J,{children:e.user.name.charAt(0)})]}),p.jsxs("div",{children:[p.jsx("div",{className:"font-semibold",children:e.user.name}),p.jsx("div",{className:"text-sm text-muted-foreground",children:new Date(e.timestamp).toLocaleDateString(Je,{month:"long",year:"numeric"})})]})]}),p.jsx(B,{as:"p",className:"text-muted-foreground line-clamp-3",text:e.comment})]},e.id))})]})]})]}),p.jsx("div",{className:"relative hidden md:block",children:p.jsxs("div",{className:"sticky top-24 border rounded-xl p-6 shadow-lg bg-white",children:[p.jsx("div",{className:"flex justify-between items-end mb-6",children:p.jsxs("div",{children:[p.jsx("span",{className:"text-2xl font-bold",children:a(os.price_per_night||0)}),p.jsxs("span",{className:"text-muted-foreground",children:[" / ",Ve("per night")]})]})}),p.jsxs("div",{className:"border rounded-lg mb-4",children:[p.jsxs("div",{className:"grid grid-cols-2 border-b",children:[p.jsxs("div",{className:"p-3 border-r cursor-pointer hover:bg-gray-50",onClick:()=>{window.matchMedia("(max-width: 767px)").matches?ls():(Me(!0),setTimeout(()=>{var e;return null==(e=Ze.current)?void 0:e.scrollIntoView({behavior:"smooth",block:"start"})},0))},children:[p.jsx("div",{className:"text-[10px] font-bold uppercase",children:Ve("listing.booking.checkIn")}),p.jsx("div",{className:"text-sm",children:ne?ne.toLocaleDateString(Ye.language):Ve("listing.booking.addDate")})]}),p.jsxs("div",{className:"p-3 cursor-pointer hover:bg-gray-50",onClick:()=>{window.matchMedia("(max-width: 767px)").matches?ls():(Me(!0),setTimeout(()=>{var e;return null==(e=Ze.current)?void 0:e.scrollIntoView({behavior:"smooth",block:"start"})},0))},children:[p.jsx("div",{className:"text-[10px] font-bold uppercase",children:Ve("listing.booking.checkout")}),p.jsx("div",{className:"text-sm",children:oe?oe.toLocaleDateString(Ye.language):Ve("listing.booking.addDate")})]})]}),p.jsxs("div",{className:"p-3 relative",children:[p.jsxs("div",{className:"cursor-pointer",onClick:()=>Ce(!ke),children:[p.jsx("div",{className:"text-[10px] font-bold uppercase",children:Ve("listing.booking.guests")}),p.jsx("div",{className:"text-sm",children:Ve("listing.booking.guestCount",{count:us})})]}),ke&&p.jsxs("div",{className:"absolute top-full left-0 right-0 mt-2 bg-white border border-gray-300 rounded-lg shadow-lg p-4 z-10 w-80",children:[p.jsxs("div",{className:"flex items-center justify-between py-4 border-b border-gray-200",children:[p.jsxs("div",{children:[p.jsx("div",{className:"font-semibold",children:Ve("listing.booking.adults")}),p.jsx("div",{className:"text-sm text-gray-500",children:Ve("Age 13+")})]}),p.jsxs("div",{className:"flex items-center gap-3",children:[p.jsx("button",{onClick:()=>me(Math.max(1,de-1)),disabled:de<=1,className:"w-8 h-8 rounded-full border flex items-center justify-center transition-colors "+(de<=1?"border-gray-200 text-gray-300":"border-gray-400 text-gray-600"),children:p.jsx(w,{className:"h-4 w-4"})}),p.jsx("span",{className:"w-8 text-center font-medium",children:de}),p.jsx("button",{onClick:()=>me(de+1),className:"w-8 h-8 rounded-full border border-gray-400 text-gray-600 flex items-center justify-center",children:p.jsx(y,{className:"h-4 w-4"})})]})]}),p.jsx(i,{variant:"ghost",className:"w-full mt-2",onClick:()=>Ce(!1),children:Ve("listing.actions.close")})]})]})]}),Ie&&p.jsxs("div",{className:"mb-4",ref:Ze,children:[p.jsxs("div",{className:"flex items-center justify-between mb-2",children:[p.jsx("button",{className:"text-sm font-semibold underline",onClick:()=>Me(!1),"aria-label":"Close calendar",children:Ve("listing.actions.close")}),p.jsx("button",{className:"text-sm underline text-muted-foreground hover:text-foreground",onClick:()=>{re(null),ce(null)},children:Ve("listing.actions.clearDates")})]}),(()=>{const e=(s=Se,new Date(s.getFullYear(),s.getMonth()+1,0).getDate());var s;const t=(e=>new Date(e.getFullYear(),e.getMonth(),1).getDay())(Se),i=[];Ve("common.months",{returnObjects:!0});const l=Ve("common.daysMin",{returnObjects:!0});for(let a=0;a<t;a++)i.push(p.jsx("div",{className:"h-10"},`empty-${a}`));for(let a=1;a<=e;a++){const e=new Date(Se.getFullYear(),Se.getMonth(),a),s=bs(ne,e),t=bs(oe,e),l=Ns(e),n=ws(e);i.push(p.jsx("button",{onClick:()=>!n&&ys(e),disabled:n,className:`h-10 w-10 flex items-center justify-center rounded-full text-sm font-medium transition-all\n                        ${n?"text-gray-300 cursor-not-allowed":"hover:bg-gray-100 text-gray-900"}\n                        ${s||t?"bg-gray-900 text-white hover:bg-gray-800":""}\n                        ${!l||s||t?"":"bg-gray-100"}\n                    `,children:a},a))}return p.jsxs("div",{className:"bg-white rounded-xl p-6 border border-gray-200",children:[p.jsxs("div",{className:"flex items-center justify-between mb-6",children:[p.jsx("button",{onClick:ks,className:"p-2 hover:bg-gray-100 rounded-full transition-colors","aria-label":Ve("common.back"),children:p.jsx(D,{className:"h-4 w-4"})}),p.jsx("h4",{className:"text-base font-semibold",children:new Intl.DateTimeFormat(Ye.language,{month:"long",year:"numeric"}).format(Se)}),p.jsx("button",{onClick:_s,className:"p-2 hover:bg-gray-100 rounded-full transition-colors","aria-label":Ve("common.next"),children:p.jsx(I,{className:"h-4 w-4"})})]}),p.jsx("div",{className:"grid grid-cols-7 gap-1 mb-3",children:l.map(e=>p.jsx("div",{className:"h-10 flex items-center justify-center text-xs font-medium text-gray-500",children:e},e))}),p.jsx("div",{className:"grid grid-cols-7 gap-1",children:i})]})})()]}),ne&&oe&&fs>0&&p.jsxs("div",{className:"mb-4 pb-4 border-b space-y-3",children:[p.jsxs("div",{className:"flex justify-between text-sm",children:[p.jsxs("span",{className:"text-muted-foreground",children:[a(os.price_per_night||0)," × ",fs," ",Ve(1===fs?"night":"nights")]}),p.jsx("span",{className:"font-medium",children:a(vs)})]}),!1,p.jsxs("div",{className:"flex justify-between text-base font-bold pt-3 border-t",children:[p.jsx("span",{children:Ve("listing.booking.total")}),p.jsx("span",{children:a(js)})]})]}),p.jsx(i,{className:"w-full bg-green-600 hover:bg-green-700 text-white font-semibold py-6 text-lg",onClick:Cs,disabled:hs||!ne||!oe,children:Ve("listing.actions.reserve")}),p.jsx("div",{className:"text-center mt-4 text-sm text-muted-foreground",children:Ve("listing.booking.noCharge")})]})})]}),p.jsxs("div",{className:"py-8 border-t border-gray-200",children:[p.jsx("h3",{className:"text-xl font-semibold mb-4",children:Ve("listing.details.location")}),p.jsxs("div",{className:"mb-6",children:[p.jsx("p",{className:"font-medium text-gray-900 text-lg",children:os.address||`${os.city}, ${os.country}`}),os.latitude&&os.longitude&&p.jsxs("p",{className:"text-gray-500 mt-1",children:[os.latitude,", ",os.longitude]})]}),p.jsx("div",{ref:es,className:"h-64 md:h-[400px] rounded-xl overflow-hidden z-0 relative",children:ts?p.jsx(M.Suspense,{fallback:p.jsx("div",{className:"h-full w-full bg-slate-100 flex items-center justify-center",children:p.jsx(_,{className:"h-8 w-8 text-slate-300 animate-pulse"})}),children:p.jsx(je,{latitude:os.latitude,longitude:os.longitude,title:os.title})}):p.jsx("div",{className:"h-full w-full bg-slate-100 flex items-center justify-center",children:p.jsxs("div",{className:"flex flex-col items-center gap-2",children:[p.jsx(_,{className:"h-8 w-8 text-slate-300"}),p.jsx("p",{className:"text-sm text-slate-400",children:Ve("Scroll to load map...")})]})})})]}),(os.getting_around||os.scenic_views&&os.scenic_views.length>0)&&p.jsx("div",{className:"py-8 border-t border-gray-200",children:p.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-8",children:[os.getting_around&&p.jsxs("div",{children:[p.jsx("h3",{className:"text-xl font-semibold mb-4",children:Ve("listing.details.gettingAround")}),p.jsx(B,{as:"p",className:"text-muted-foreground whitespace-pre-line",text:os.getting_around||""})]}),os.scenic_views&&p.jsxs("div",{children:[p.jsx("h3",{className:"text-xl font-semibold mb-4",children:Ve("listing.details.scenicViews")}),p.jsx("div",{className:"flex flex-wrap gap-2",children:(()=>{try{const e="string"==typeof os.scenic_views?JSON.parse(os.scenic_views):os.scenic_views;return Array.isArray(e)?e.map((e,s)=>p.jsx("div",{className:"bg-gray-100 px-3 py-1 rounded-full text-sm text-gray-700",children:p.jsx(B,{as:"span",text:e})},s)):null}catch(Ms){return null}})()})]})]})}),p.jsxs("div",{className:"mt-12 pt-8 border-t border-gray-200",children:[p.jsx("h3",{className:"text-xl font-semibold mb-6",children:Ve("listing.host.meet")}),p.jsxs("div",{className:"bg-[#F0EFE9] rounded-2xl p-6 md:p-8 grid grid-cols-1 md:grid-cols-3 gap-8",children:[p.jsxs("div",{className:"bg-white rounded-2xl p-6 shadow-lg flex flex-col items-center text-center md:col-span-1 cursor-pointer hover:shadow-xl transition",onClick:()=>v(`/hosts/${os.host_id}`),children:[p.jsx("div",{className:"relative mb-4",children:p.jsxs(Y,{className:"h-24 w-24",children:[p.jsx(W,{src:ms||void 0}),p.jsx(J,{children:ds.slice(0,2).toUpperCase()})]})}),p.jsx("h4",{className:"text-2xl font-bold mb-1",children:ds}),p.jsx("div",{className:"w-full space-y-4 mt-4",children:p.jsxs("div",{className:"flex justify-between items-center border-b pb-4",children:[p.jsxs("div",{className:"text-left",children:[p.jsx("div",{className:"font-bold text-lg",children:Ge.length}),p.jsx("div",{className:"text-xs text-muted-foreground",children:Ve("listing.host.reviews")})]}),p.jsxs("div",{className:"text-right",children:[p.jsx("div",{className:"font-bold text-lg",children:Ge.length>0?(Ge.reduce((e,s)=>e+Object.values(s.ratings).reduce((e,s)=>e+s,0)/6,0)/Ge.length).toFixed(2):Ve("listing.details.new")}),p.jsx("div",{className:"text-xs text-muted-foreground",children:Ve("listing.host.rating")})]}),p.jsxs("div",{className:"text-right",children:[p.jsx("div",{className:"font-bold text-lg",children:Ve("listing.details.new")}),p.jsx("div",{className:"text-xs text-muted-foreground",children:Ve("listing.host.yearsHosting")})]})]})})]}),p.jsx("div",{className:"md:col-span-2 space-y-6",children:p.jsxs("div",{className:"pt-4",children:[p.jsx("h4",{className:"text-lg font-semibold mb-2",children:Ve("listing.host.aboutTitle")}),localStorage.getItem("host_location")&&p.jsxs("div",{className:"flex items-center gap-2 mb-2 text-gray-700",children:[p.jsx(_,{className:"h-5 w-5"}),p.jsx("span",{children:Ve("listing.host.livesIn",{location:localStorage.getItem("host_location")})})]}),localStorage.getItem("host_languages")&&p.jsxs("div",{className:"flex items-center gap-2 mb-4 text-gray-700",children:[p.jsx(k,{className:"h-5 w-5"}),p.jsx("span",{children:Ve("listing.host.speaks",{langs:localStorage.getItem("host_languages")})})]}),p.jsx("p",{className:"text-muted-foreground mb-6",children:Ve("listing.host.bioDefault")}),p.jsx(i,{variant:"outline",className:"font-semibold border-black text-black hover:bg-gray-100",onClick:()=>{const e=null==te?void 0:te.contact_phone;E(e,Ve("listing.actions.whatsappGreeting",{name:ds}))||Te(!0)},children:Ve("listing.actions.messageHost")}),p.jsx("div",{className:"mt-4 flex justify-center md:justify-start",children:p.jsxs("button",{onClick:()=>ze(!0),className:"flex items-center gap-2 text-sm text-muted-foreground hover:text-foreground underline",children:[p.jsx(C,{className:"h-4 w-4"}),Ve("listing.actions.reportHost")]})})]})})]})]}),p.jsxs("div",{className:"mt-12 pt-8 border-t border-gray-200",children:[p.jsx("h3",{className:"text-xl font-semibold mb-6",children:Ve("listing.details.thingsToKnow")}),p.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-8",children:[p.jsxs("div",{children:[p.jsx("h4",{className:"font-semibold mb-4",children:Ve("listing.details.houseRules")}),p.jsxs("div",{className:"space-y-2 text-sm text-gray-700",children:[p.jsxs("p",{children:[Ve("listing.booking.checkIn"),": ",Ss.check_in_start," - ",Ss.check_in_end]}),p.jsxs("p",{children:[Ve("listing.booking.checkout"),": ",Ss.checkout_time]}),p.jsx("p",{children:Ve("listing.details.maxGuests",{count:os.max_guests})}),p.jsx("p",{children:Ss.pets_allowed?Ve("host.editor.safety.rules.pets"):Ve("preview.noPets")}),p.jsx("p",{children:Ss.events_allowed?Ve("host.editor.safety.rules.events"):Ve("preview.noParties")}),p.jsx("p",{children:Ss.smoking_allowed?Ve("listing.details.houseRulesProps.smokingAllowed"):Ve("preview.noSmoking")}),p.jsx("p",{children:Ss.quiet_hours?Ve("listing.details.houseRulesProps.quietHoursEnforced"):Ve("listing.details.houseRulesProps.quietHoursNotEnforced")}),p.jsx("p",{children:Ss.commercial_photography_allowed?Ve("listing.details.houseRulesProps.photographyAllowed"):Ve("listing.details.houseRulesProps.photographyNotAllowed")})]})]}),p.jsxs("div",{children:[p.jsx("h4",{className:"font-semibold mb-4",children:Ve("listing.details.safetyProperty")}),p.jsx("div",{className:"space-y-2 text-sm text-gray-700",children:os.safety_devices&&(()=>{let e=[];try{e=os.safety_devices.trim().startsWith("[")?JSON.parse(os.safety_devices):os.safety_devices.split(",")}catch(Ms){e=[os.safety_devices]}return e.map((e,s)=>p.jsx(B,{as:"p",text:e},s))})()})]}),p.jsxs("div",{children:[p.jsx("h4",{className:"font-semibold mb-4",children:Ve("listing.details.cancellationPolicy")}),p.jsx("p",{className:"text-sm text-gray-700",children:os.cancellation_policy||Ve("listing.details.flexibleCancellation")})]})]})]})]}),p.jsx("div",{className:"fixed bottom-0 inset-x-0 z-50 bg-white border-t border-gray-200 p-4 md:hidden pb-safe",children:p.jsxs("div",{className:"flex items-center justify-between max-w-7xl mx-auto",children:[p.jsxs("div",{className:"flex flex-col",children:[ne&&oe?p.jsxs("div",{className:"flex items-baseline gap-1",children:[p.jsx("span",{className:"font-bold text-lg",children:a(js)}),p.jsx("span",{className:"text-sm text-muted-foreground",children:Ve("listing.booking.total")})]}):p.jsxs("div",{className:"flex items-baseline gap-1",children:[p.jsx("span",{className:"font-bold text-lg",children:a(os.price_per_night||0)}),p.jsxs("span",{className:"text-sm text-muted-foreground",children:["/ ",Ve("per night")]})]}),p.jsx("span",{className:"text-xs font-medium underline cursor-pointer",onClick:()=>Re(!0),children:ne&&oe?`${X(ne,"MMM d",{locale:We})} - ${X(oe,"MMM d",{locale:We})}`:Ve("listing.booking.addDate")})]}),p.jsx(i,{className:"bg-green-600 hover:bg-green-700 text-white font-semibold px-8",onClick:()=>ne&&oe?Cs():ls(),children:Ve(ne&&oe?"listing.actions.reserve":"listing.booking.selectDates")})]})}),p.jsx(n,{open:Pe,onOpenChange:e=>{var s,t;if(e)try{null==(t=null==(s=document.activeElement)?void 0:s.blur)||t.call(s)}catch{}Re(e)},children:p.jsxs(r,{className:"md:hidden w-full max-w-none p-0 gap-0",onOpenAutoFocus:e=>{var s;e.preventDefault(),null==(s=Xe.current)||s.focus()},children:[p.jsxs("div",{className:"flex items-center justify-between px-4 py-3 border-b",children:[p.jsx("button",{ref:Xe,className:"p-2 -ml-2","aria-label":"Close",onClick:()=>Re(!1),children:p.jsx(S,{className:"h-5 w-5"})}),p.jsx("button",{className:"text-sm font-semibold underline",onClick:()=>{re(null),ce(null)},children:Ve("listing.actions.clearDates")})]}),p.jsxs("div",{className:"px-4 pt-4",children:[p.jsxs(o,{className:"mb-2",children:[p.jsx(c,{className:"text-lg font-semibold",children:Ve("listing.details.selectCheckIn")}),p.jsx(d,{className:"text-sm text-muted-foreground",children:Ve("listing.details.addDatesPricing")})]}),p.jsx(V,{mode:"range",selected:ne?{from:ne,to:oe||void 0}:void 0,onSelect:e=>{(null==e?void 0:e.from)&&re(e.from),ce((null==e?void 0:e.to)||null),e||(re(null),ce(null))},numberOfMonths:1,disabled:[{before:new Date},...rs],modifiersStyles:{selected:{backgroundColor:"#222222",color:"white"},range_middle:{backgroundColor:"#F7F7F7",color:"#222222"},range_start:{backgroundColor:"#222222",color:"white"},range_end:{backgroundColor:"#222222",color:"white"}},locale:We,className:"border-0"})]}),p.jsx("div",{className:"p-4 border-t",children:p.jsx(i,{className:"w-full",disabled:!ne||!oe,onClick:()=>{Me(!1),Cs()},children:Ve("listing.actions.reserve")})})]})}),p.jsx(z,{})]})};export{be as default};
