import{O as I,r as C,j as e,d as Rs,P as Ke,c as Fs,Q as B,S as G,T as ae,U as J,B as p,E as P,V as se,p as Xe,M as Ze,W as Qe,Y as es,Z as As,_ as Ts,$ as b,J as Os,G as L,X as Ls,a0 as Es,a1 as zs,a2 as Us,a3 as Hs,a4 as qs}from"./index-BumHlSai.js";import{u as Vs}from"./useQuery-wQaSLt0g.js";import{L as Ws}from"./Loading-wlpE3RCN.js";import{O as F}from"./OptimizedImage-xP7m_j1R.js";import{o as Ys}from"./whatsapp-DqlDrlWI.js";import{K as Bs,S as pe,D as xe,A as Gs}from"./HouseRulesSection-CkXw60GU.js";import{a as Js,T as Ks,M as Xs,L as ss,i as Zs,b as Qs}from"./marker-shadow-CxIpLtgo.js";import{F as et}from"./Footer-D_4nY92E.js";import{S as st,H as tt}from"./Header-CQjoyTD4.js";import{D as ge}from"./index.esm-DZts7F4_.js";import{A as Ve,a as We,b as Ye}from"./avatar-BcTl2A0a.js";import{T as ve}from"./textarea-C_drbF4B.js";import{L as fe}from"./label-Dp3vxcFY.js";import{M as je}from"./message-square-BTQwkIw7.js";import{S as ts}from"./star-CVLH76DC.js";import{M as at}from"./mail-BqVaG6XR.js";import{C as ee}from"./chevron-left-BgQrOA8v.js";import{H as be}from"./heart-DX2l2ZpK.js";import{C as as}from"./chevron-right-Cey3u9Ra.js";import{u as it}from"./useWishlist-DPRVGm7i.js";import{u as is}from"./useTranslation-DUME4FCN.js";import{M as lt}from"./minus-BBPBE3n7.js";import{P as nt}from"./plus-zj-BiCMM.js";import{P as rt}from"./Popup-D1wFBk5c.js";import{f as ot}from"./fr-WkZ76UWi.js";import{e as ct,f as E}from"./format-OVVNnQ9P.js";import"./wind-Crj9PVxn.js";import"./shield-alert-BAzvxJqx.js";import"./trash-2-CcGP-z7s.js";import"./zap-Bnsr_mvQ.js";import"./chevron-down-CeatZl6_.js";import"./LanguageSwitcher-B49yhAFl.js";import"./index-BcTPR2G6.js";import"./check-Cw4ObBPz.js";import"./menu-CwDdBYwq.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const dt=I("CircleCheckBig",[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const mt=I("Code",[["polyline",{points:"16 18 22 12 16 6",key:"z7tu5w"}],["polyline",{points:"8 6 2 12 8 18",key:"1eg1df"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ht=I("Copy",[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ut=I("Facebook",[["path",{d:"M18 2h-3a5 5 0 0 0-5 5v3H7v4h3v8h4v-8h3l1-4h-4V7a1 1 0 0 1 1-1h3z",key:"1jg4f8"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ls=I("Map",[["path",{d:"M14.106 5.553a2 2 0 0 0 1.788 0l3.659-1.83A1 1 0 0 1 21 4.619v12.764a1 1 0 0 1-.553.894l-4.553 2.277a2 2 0 0 1-1.788 0l-4.212-2.106a2 2 0 0 0-1.788 0l-3.659 1.83A1 1 0 0 1 3 19.381V6.618a1 1 0 0 1 .553-.894l4.553-2.277a2 2 0 0 1 1.788 0z",key:"169xi5"}],["path",{d:"M15 5.764v15",key:"1pn4in"}],["path",{d:"M9 3.236v15",key:"1uimfh"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Be=I("MessageCircle",[["path",{d:"M7.9 20A9 9 0 1 0 4 16.1L2 22Z",key:"vv11sd"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xt=I("ShieldCheck",[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const gt=I("SprayCan",[["path",{d:"M3 3h.01",key:"159qn6"}],["path",{d:"M7 5h.01",key:"1hq22a"}],["path",{d:"M11 7h.01",key:"1osv80"}],["path",{d:"M3 7h.01",key:"1xzrh3"}],["path",{d:"M7 9h.01",key:"19b3jx"}],["path",{d:"M3 11h.01",key:"1eifu7"}],["rect",{width:"4",height:"4",x:"15",y:"5",key:"mri9e4"}],["path",{d:"m19 9 2 2v10c0 .6-.4 1-1 1h-6c-.6 0-1-.4-1-1V11l2-2",key:"aib6hk"}],["path",{d:"m13 14 8-2",key:"1d7bmk"}],["path",{d:"m13 19 8-2",key:"1y2vml"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pt=I("Tag",[["path",{d:"M12.586 2.586A2 2 0 0 0 11.172 2H4a2 2 0 0 0-2 2v7.172a2 2 0 0 0 .586 1.414l8.704 8.704a2.426 2.426 0 0 0 3.42 0l6.58-6.58a2.426 2.426 0 0 0 0-3.42z",key:"vktsd0"}],["circle",{cx:"7.5",cy:"7.5",r:".5",fill:"currentColor",key:"kqv944"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ft=I("Twitter",[["path",{d:"M22 4s-.7 2.1-2 3.4c1.6 10-9.4 17.3-18 11.6 2.2.1 4.4-.6 6-2C3 15.5.5 9.6 3 5c2.2 2.6 5.6 4.1 9 4-.9-4.2 4-6.6 7-3.8 1.1 0 3-1.2 3-1.2z",key:"pff0z6"}]]);var ye="Progress",Ne=100,[bt]=Rs(ye),[vt,jt]=bt(ye),ns=C.forwardRef((a,m)=>{const{__scopeProgress:c,value:h=null,max:u,getValueLabel:o=yt,...j}=a;(u||u===0)&&!Ge(u)&&console.error(Nt(`${u}`,"Progress"));const g=Ge(u)?u:Ne;h!==null&&!Je(h,g)&&console.error(wt(`${h}`,"Progress"));const v=Je(h,g)?h:null,l=te(v)?o(v,g):void 0;return e.jsx(vt,{scope:c,value:v,max:g,children:e.jsx(Ke.div,{"aria-valuemax":g,"aria-valuemin":0,"aria-valuenow":te(v)?v:void 0,"aria-valuetext":l,role:"progressbar","data-state":cs(v,g),"data-value":v??void 0,"data-max":g,...j,ref:m})})});ns.displayName=ye;var rs="ProgressIndicator",os=C.forwardRef((a,m)=>{const{__scopeProgress:c,...h}=a,u=jt(rs,c);return e.jsx(Ke.div,{"data-state":cs(u.value,u.max),"data-value":u.value??void 0,"data-max":u.max,...h,ref:m})});os.displayName=rs;function yt(a,m){return`${Math.round(a/m*100)}%`}function cs(a,m){return a==null?"indeterminate":a===m?"complete":"loading"}function te(a){return typeof a=="number"}function Ge(a){return te(a)&&!isNaN(a)&&a>0}function Je(a,m){return te(a)&&!isNaN(a)&&a<=m&&a>=0}function Nt(a,m){return`Invalid prop \`max\` of value \`${a}\` supplied to \`${m}\`. Only numbers greater than 0 are valid max values. Defaulting to \`${Ne}\`.`}function wt(a,m){return`Invalid prop \`value\` of value \`${a}\` supplied to \`${m}\`. The \`value\` prop must be:
  - a positive number
  - less than the value passed to \`max\` (or ${Ne} if no \`max\` prop is set)
  - \`null\` or \`undefined\` if the progress is indeterminate.

Defaulting to \`null\`.`}var ds=ns,kt=os;const ms=C.forwardRef(({className:a,value:m,...c},h)=>e.jsx(ds,{ref:h,className:Fs("relative h-4 w-full overflow-hidden rounded-full bg-secondary",a),...c,children:e.jsx(kt,{className:"h-full w-full flex-1 bg-primary transition-all",style:{transform:`translateX(-${100-(m||0)}%)`}})}));ms.displayName=ds.displayName;const Ct=[{id:"cleanliness",label:"Cleanliness",icon:gt},{id:"accuracy",label:"Accuracy",icon:dt},{id:"checkin",label:"Check-in",icon:Bs},{id:"communication",label:"Communication",icon:je},{id:"location",label:"Location",icon:ls},{id:"value",label:"Value",icon:pt}],St=({isOpen:a,onClose:m,onSubmit:c})=>{const[h,u]=C.useState({cleanliness:5,accuracy:5,checkin:5,communication:5,location:5,value:5}),[o,j]=C.useState(""),g=(l,f)=>{u(r=>({...r,[l]:f}))},v=()=>{const l={ratings:h,comment:o,timestamp:new Date().toISOString()};c(l),m()};return e.jsx(B,{open:a,onOpenChange:m,children:e.jsxs(G,{className:"sm:max-w-[600px] max-h-[90vh] overflow-y-auto",children:[e.jsx(ae,{children:e.jsx(J,{className:"text-2xl font-bold",children:"Write a Review"})}),e.jsxs("div",{className:"grid gap-6 py-4",children:[e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:Ct.map(l=>{const f=l.icon;return e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(f,{className:"h-4 w-4 text-gray-500"}),e.jsx(fe,{className:"font-semibold",children:l.label})]}),e.jsx("div",{className:"flex gap-1",children:[1,2,3,4,5].map(r=>e.jsx("button",{type:"button",onClick:()=>g(l.id,r),className:"focus:outline-none transition-transform hover:scale-110",children:e.jsx(ts,{className:`h-6 w-6 ${r<=h[l.id]?"fill-[#FFD700] text-[#FFD700]":"text-white"}`})},r))})]},l.id)})}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(fe,{htmlFor:"comment",className:"font-semibold",children:"Your Message"}),e.jsx(ve,{id:"comment",placeholder:"Share your experience...",value:o,onChange:l=>j(l.target.value),className:"min-h-[100px]"})]})]}),e.jsxs("div",{className:"flex justify-end gap-3",children:[e.jsx(p,{variant:"outline",onClick:m,children:"Cancel"}),e.jsx(p,{onClick:v,className:"bg-[#FF385C] hover:bg-[#D9324E] text-white",children:"Submit Review"})]})]})})},Mt=({isOpen:a,onClose:m,listing:c})=>{const h=window.location.href,u=()=>{navigator.clipboard.writeText(h),se.success("Link copied to clipboard!")},o=()=>{const y=`Check out this place: ${c.title||"Amazing Place"}`,$=`I found this amazing place on Le Mboko and thought you'd love it:

${c.title||"Amazing Place"}
${h}`;window.open(`mailto:?subject=${encodeURIComponent(y)}&body=${encodeURIComponent($)}`)},j=()=>{const y=`Check out this place: ${c.title||"Amazing Place"} - ${h}`;window.open(`https://wa.me/?text=${encodeURIComponent(y)}`,"_blank")},g=()=>{const y=`Check out this place: ${c.title||"Amazing Place"} - ${h}`;window.open(`sms:?body=${encodeURIComponent(y)}`)},v=()=>{window.open(`https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(h)}`,"_blank")},l=()=>{const y=`Check out this place: ${c.title||"Amazing Place"}`;window.open(`https://twitter.com/intent/tweet?text=${encodeURIComponent(y)}&url=${encodeURIComponent(h)}`,"_blank")},f=()=>{window.open(`fb-messenger://share/?link=${encodeURIComponent(h)}`)},r=()=>{const y=`<iframe src="${h}" width="600" height="400" frameborder="0"></iframe>`;navigator.clipboard.writeText(y),se.success("Embed code copied to clipboard!")},x=c.photos.find(y=>y.is_cover)||c.photos[0];return e.jsx(B,{open:a,onOpenChange:m,children:e.jsxs(G,{className:"sm:max-w-[600px] p-0 overflow-hidden rounded-2xl",children:[e.jsx("div",{className:"p-6 pb-0",children:e.jsx("div",{className:"flex items-center justify-between mb-4",children:e.jsx(J,{className:"text-xl font-bold",children:"Partager cette annonce"})})}),e.jsxs("div",{className:"px-6 pb-6",children:[e.jsxs("div",{className:"flex gap-4 mb-8",children:[e.jsx("div",{className:"h-24 w-24 rounded-xl overflow-hidden flex-shrink-0",children:e.jsx(F,{src:P(x==null?void 0:x.url),alt:c.title,className:"h-full w-full object-cover"})}),e.jsxs("div",{className:"flex flex-col justify-center",children:[e.jsx("h3",{className:"font-medium text-gray-900 line-clamp-2",children:c.title||"Amazing Place"}),e.jsxs("div",{className:"text-sm text-gray-500 mt-1",children:[c.property_type||"Property"," · ",c.city||"Location"," · ",c.bedrooms||0," bedroom",c.bedrooms!==1?"s":""," · ",c.beds||0," bed",c.beds!==1?"s":""," · ",c.bathrooms||0," bath",c.bathrooms!==1?"s":""]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsxs(p,{variant:"outline",className:"h-14 justify-start px-4 border-gray-200 hover:bg-gray-50 hover:border-black rounded-xl gap-3",onClick:u,children:[e.jsx(ht,{className:"h-5 w-5"}),e.jsx("span",{className:"font-medium",children:"Copier le lien"})]}),e.jsxs(p,{variant:"outline",className:"h-14 justify-start px-4 border-gray-200 hover:bg-gray-50 hover:border-black rounded-xl gap-3",onClick:o,children:[e.jsx(at,{className:"h-5 w-5"}),e.jsx("span",{className:"font-medium",children:"E-mail"})]}),e.jsxs(p,{variant:"outline",className:"h-14 justify-start px-4 border-gray-200 hover:bg-gray-50 hover:border-black rounded-xl gap-3",onClick:g,children:[e.jsx(je,{className:"h-5 w-5"}),e.jsx("span",{className:"font-medium",children:"Messages"})]}),e.jsxs(p,{variant:"outline",className:"h-14 justify-start px-4 border-gray-200 hover:bg-gray-50 hover:border-black rounded-xl gap-3",onClick:j,children:[e.jsx(Be,{className:"h-5 w-5"}),e.jsx("span",{className:"font-medium",children:"WhatsApp"})]}),e.jsxs(p,{variant:"outline",className:"h-14 justify-start px-4 border-gray-200 hover:bg-gray-50 hover:border-black rounded-xl gap-3",onClick:f,children:[e.jsx(Be,{className:"h-5 w-5"})," ",e.jsx("span",{className:"font-medium",children:"Messenger"})]}),e.jsxs(p,{variant:"outline",className:"h-14 justify-start px-4 border-gray-200 hover:bg-gray-50 hover:border-black rounded-xl gap-3",onClick:v,children:[e.jsx(ut,{className:"h-5 w-5"}),e.jsx("span",{className:"font-medium",children:"Facebook"})]}),e.jsxs(p,{variant:"outline",className:"h-14 justify-start px-4 border-gray-200 hover:bg-gray-50 hover:border-black rounded-xl gap-3",onClick:l,children:[e.jsx(ft,{className:"h-5 w-5"}),e.jsx("span",{className:"font-medium",children:"Twitter"})]}),e.jsxs(p,{variant:"outline",className:"h-14 justify-start px-4 border-gray-200 hover:bg-gray-50 hover:border-black rounded-xl gap-3",onClick:r,children:[e.jsx(mt,{className:"h-5 w-5"}),e.jsx("span",{className:"font-medium",children:"Intégrer"})]})]})]})]})})},_t=({isOpen:a,onClose:m,listingId:c,hostId:h,hostName:u})=>{const[o,j]=C.useState(""),[g,v]=C.useState(!1),l=Xe(),{toast:f}=Ze(),r=async()=>{if(o.trim()){v(!0);try{const x=await As(c,h,o);f({title:"Message sent",description:"Your message has been sent to the host."}),m(),l(`/messages?conversationId=${x.conversation_id}`)}catch(x){console.error("Failed to send message:",x),f({title:"Error",description:"Failed to send message. Please try again.",variant:"destructive"})}finally{v(!1)}}};return e.jsx(B,{open:a,onOpenChange:m,children:e.jsxs(G,{className:"sm:max-w-[425px]",children:[e.jsx(ae,{children:e.jsxs(J,{children:["Message ",u]})}),e.jsx("div",{className:"grid gap-4 py-4",children:e.jsx(ve,{placeholder:`Hi ${u}, I'm interested in your place...`,value:o,onChange:x=>j(x.target.value),className:"min-h-[100px]"})}),e.jsxs(Qe,{children:[e.jsx(p,{variant:"outline",onClick:m,disabled:g,children:"Cancel"}),e.jsx(p,{onClick:r,disabled:!o.trim()||g,children:g?e.jsx(es,{className:"h-4 w-4 animate-spin"}):"Send Message"})]})]})})},It=({isOpen:a,onClose:m,hostId:c,listingId:h})=>{const[u,o]=C.useState(""),[j,g]=C.useState(!1),v=async l=>{if(l.preventDefault(),!!u.trim()){g(!0);try{await Ts({host_id:c,listing_id:h,reason:u.trim()}),se.success("Report submitted successfully. Thank you for your feedback."),o(""),m()}catch(f){console.error("Failed to submit report:",f),se.error("Failed to submit report. Please try again.")}finally{g(!1)}}};return e.jsx(B,{open:a,onOpenChange:m,children:e.jsxs(G,{className:"sm:max-w-[425px]",children:[e.jsx(ae,{children:e.jsx(J,{children:"Report this Host"})}),e.jsxs("form",{onSubmit:v,className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(fe,{htmlFor:"reason",children:"Why are you reporting this host?"}),e.jsx(ve,{id:"reason",placeholder:"Please provide details about your concern...",value:u,onChange:l=>o(l.target.value),className:"min-h-[100px]",required:!0})]}),e.jsxs(Qe,{children:[e.jsx(p,{type:"button",variant:"outline",onClick:m,disabled:j,children:"Cancel"}),e.jsx(p,{type:"submit",disabled:!u.trim()||j,children:j?e.jsxs(e.Fragment,{children:[e.jsx(es,{className:"mr-2 h-4 w-4 animate-spin"}),"Submitting..."]}):"Submit Report"})]})]})]})})},Dt=({isOpen:a,onClose:m,photos:c,initialPhotoIndex:h=0})=>{const[u,o]=C.useState("grid"),[j,g]=C.useState(h);if(C.useEffect(()=>(a?document.body.style.overflow="hidden":(document.body.style.overflow="unset",o("grid")),()=>{document.body.style.overflow="unset"}),[a]),C.useEffect(()=>{g(h)},[h]),!a)return null;const v=r=>{g(r),o("lightbox")},l=r=>{r==null||r.stopPropagation(),g(x=>(x+1)%c.length)},f=r=>{r==null||r.stopPropagation(),g(x=>(x-1+c.length)%c.length)};return u==="lightbox"?e.jsxs("div",{className:"fixed inset-0 z-[60] bg-black flex flex-col",children:[e.jsxs("div",{className:"flex items-center justify-between px-4 py-4 text-white",children:[e.jsxs(p,{variant:"ghost",className:"text-white hover:bg-white/10 gap-2",onClick:()=>o("grid"),children:[e.jsx(ee,{className:"h-5 w-5"}),"Back to grid"]}),e.jsxs("div",{className:"text-sm font-medium",children:[j+1," / ",c.length]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(p,{variant:"ghost",size:"icon",className:"text-white hover:bg-white/10",children:e.jsx(pe,{className:"h-5 w-5"})}),e.jsx(p,{variant:"ghost",size:"icon",className:"text-white hover:bg-white/10",children:e.jsx(be,{className:"h-5 w-5"})})]})]}),e.jsxs("div",{className:"flex-1 relative flex items-center justify-center group",children:[e.jsx("button",{className:"absolute left-4 p-2 rounded-full bg-black/50 text-white hover:bg-black/70 transition-colors opacity-0 group-hover:opacity-100",onClick:f,children:e.jsx(ee,{className:"h-8 w-8"})}),e.jsx(F,{src:P(c[j].url),alt:`Photo ${j+1}`,className:"w-full h-full object-contain",quality:"high",priority:!0}),e.jsx("button",{className:"absolute right-4 p-2 rounded-full bg-black/50 text-white hover:bg-black/70 transition-colors opacity-0 group-hover:opacity-100",onClick:l,children:e.jsx(as,{className:"h-8 w-8"})})]}),e.jsx("div",{className:"h-20 bg-black/90 flex items-center justify-center gap-2 px-4 overflow-x-auto",children:c.map((r,x)=>e.jsx("button",{onClick:()=>g(x),className:`relative h-14 w-20 flex-shrink-0 rounded-md overflow-hidden transition-opacity ${x===j?"ring-2 ring-white opacity-100":"opacity-50 hover:opacity-75"}`,children:e.jsx(F,{src:P(r.url),alt:`Thumbnail ${x+1}`,className:"h-full w-full object-cover",quality:"low"})},r.id))})]}):e.jsxs("div",{className:"fixed inset-0 z-[60] bg-white animate-in slide-in-from-bottom-10 duration-200",children:[e.jsxs("div",{className:"sticky top-0 z-10 bg-white border-b px-4 h-16 flex items-center justify-between",children:[e.jsx(p,{variant:"ghost",size:"icon",onClick:m,className:"hover:bg-gray-100 rounded-full",children:e.jsx(ee,{className:"h-5 w-5"})}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(p,{variant:"ghost",size:"sm",className:"gap-2",children:[e.jsx(pe,{className:"h-4 w-4"}),"Share"]}),e.jsxs(p,{variant:"ghost",size:"sm",className:"gap-2",children:[e.jsx(be,{className:"h-4 w-4"}),"Save"]})]})]}),e.jsxs("div",{className:"max-w-7xl mx-auto px-4 py-8 overflow-y-auto h-[calc(100vh-64px)]",children:[e.jsx("h2",{className:"text-2xl font-bold mb-6",children:"Photo tour"}),e.jsx("div",{className:"columns-1 md:columns-2 lg:columns-3 gap-4 space-y-4",children:c.map((r,x)=>e.jsxs("div",{className:"break-inside-avoid cursor-pointer group relative",onClick:()=>v(x),children:[e.jsx(F,{src:P(r.url),alt:`Photo ${x+1}`,className:"w-full rounded-lg hover:opacity-95 transition-opacity",quality:"medium"}),e.jsx("div",{className:"absolute inset-0 bg-black/0 group-hover:bg-black/10 transition-colors rounded-lg"})]},r.id))})]})]})},Pt=1e3*60*60*24*30;function $t(a,m,c){const h=`${c||"auto"}::${m}::${a}`;let u=0;for(let o=0;o<h.length;o++)u=(u<<5)-u+h.charCodeAt(o),u|=0;return`lt_cache_${u}`}async function Rt(a,m,c={}){var h,u,o,j;try{const g=c.source??"auto",v=c.endpoint??((u=(h=import.meta)==null?void 0:h.env)==null?void 0:u.VITE_TRANSLATE_ENDPOINT)??"/api/translate",l=c.apiKey??((j=(o=import.meta)==null?void 0:o.env)==null?void 0:j.VITE_TRANSLATE_API_KEY)??void 0,f=c.ttlMs??Pt;if(!a||!m)return a;const r=$t(a,m,g),x=Date.now();try{const z=localStorage.getItem(r);if(z){const{v:we,exp:ie}=JSON.parse(z);if(!ie||ie>x)return we}}catch{console.debug("translate cache read failed")}const y=await fetch(v,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({q:a,source:g,target:m,format:"text",api_key:l})});if(!y.ok)return a;const $=await y.json(),K=($==null?void 0:$.translatedText)??a;try{localStorage.setItem(r,JSON.stringify({v:K,exp:x+f}))}catch{console.debug("translate cache write failed")}return K}catch{return a}}const R=({text:a,as:m="span",className:c,langOverride:h})=>{const{i18n:u}=is(),o=(h||u.language||"en").split("-")[0],[j,g]=b.useState(a||void 0);b.useMemo(()=>`${o}::${a||""}`,[o,a]),b.useEffect(()=>{let l=!1;return(async()=>{const r=a||"";if(!r){g("");return}const x=o;try{const y=await Rt(r,x);l||g(y||r)}catch{l||g(r)}})(),()=>{l=!0}},[o,a]);const v=m;return e.jsx(v,{className:c,children:j})},Ft=ss.icon({iconUrl:Qs,shadowUrl:Zs,iconSize:[25,41],iconAnchor:[12,41]});ss.Marker.prototype.options.icon=Ft;const ba=()=>{var ze,Ue;const{id:a}=Os(),m=Xe(),{addToWishlist:c,removeFromWishlistByProduct:h,isInWishlist:u}=it(),{data:o,isLoading:j,error:g,refetch:v}=Vs({queryKey:["listing",a],queryFn:()=>qs(a),enabled:!!a});b.useEffect(()=>{if(!a)return;let s=null;const n=d=>{const N=d.detail;(N==null?void 0:N.listingId)===a&&v()};try{"BroadcastChannel"in window&&(s=new BroadcastChannel("calendar-updates"),s.onmessage=d=>{const N=d.data;(N==null?void 0:N.type)==="calendar_updated"&&N.listingId===a&&v()})}catch{}return window.addEventListener("calendar_updated",n),()=>{window.removeEventListener("calendar_updated",n);try{s==null||s.close()}catch{}}},[a,v]);const[l,f]=b.useState(null),[r,x]=b.useState(null),[y,$]=b.useState(1),[K,z]=b.useState(0),[we,ie]=b.useState(0),[At,Tt]=b.useState(0),[ke,Ce]=b.useState(!1),[D,Se]=b.useState(new Date),[hs,U]=b.useState(!1),[us,X]=b.useState(!1),[xs,Z]=b.useState(!1),[gs,Me]=b.useState(!1),[ps,_e]=b.useState(!1),[fs,Ie]=b.useState(!1),[bs,O]=b.useState(!1),{t,i18n:H}=is(),A=H.language==="fr"?ot:ct,vs=(ze=H.language)!=null&&ze.startsWith("fr")?"fr-FR":"en-US",[js,q]=b.useState(0),[k,De]=b.useState([]),{toast:S}=Ze(),Pe=b.useRef(null),le=b.useRef(null),ne=()=>{var s,n;try{(n=(s=document.activeElement)==null?void 0:s.blur)==null||n.call(s)}catch{}X(!0)},re=b.useCallback(s=>{let n={cleanliness:5,accuracy:5,checkin:5,communication:5,location:5,value:5};try{s.ratings&&typeof s.ratings=="string"&&(n=JSON.parse(s.ratings)),s.ratings&&typeof s.ratings=="object"&&(n=s.ratings)}catch{}return{id:Number(s.id),user:{name:s.username||"Guest",avatar:s.avatar||"https://github.com/shadcn.png"},guestId:Number(s.guest_id),ratings:n,comment:s.comment||"",timestamp:s.created_at||new Date().toISOString()}},[]);b.useEffect(()=>{(async()=>{if(a)try{const n=await zs(a);De(n.map(re))}catch(n){console.error("Failed to load reviews",n)}})()},[a,re]);const ys=async s=>{var n;if(a)try{const d=await Us(a,{ratings:s.ratings,comment:s.comment}),N=re(d);De(w=>[N,...w]),Z(!1),S({title:t("Success"),description:t("Thank you for your feedback!")})}catch(d){console.error("Failed to submit review",d);const w=(n=d.response)==null?void 0:n.status;if(w===409){Z(!1),S({title:t("Already reviewed"),description:t("You can only review this listing once."),variant:"destructive"});return}if(w===401){S({title:t("Login required"),description:t("Please log in to write a review."),variant:"destructive"});const T=`${window.location.pathname}${window.location.search}`;window.location.href=`/login?redirect=${encodeURIComponent(T||"/")}`;return}S({title:t("Failed to submit review"),description:t("Please try again later."),variant:"destructive"})}},M=b.useMemo(()=>o!=null&&o.photos?[...o.photos].sort((s,n)=>(n.is_cover||0)-(s.is_cover||0)):[],[o==null?void 0:o.photos]),V=b.useMemo(()=>o!=null&&o.unavailable_dates?o.unavailable_dates.map(s=>({from:new Date(s.check_in),to:new Date(s.check_out)})):[],[o==null?void 0:o.unavailable_dates]);if(j)return e.jsx(Ws,{fullScreen:!0,message:t("common.loading","Loading...")});if(g||!o)return e.jsxs("div",{className:"min-h-screen flex flex-col items-center justify-center gap-4",children:[e.jsx("h1",{className:"text-2xl font-bold",children:t("listing.errors.notFound")}),e.jsx(p,{onClick:()=>m("/"),children:t("listing.actions.goHome")})]});const{listing:i,amenities:oe}=o,W=(o.host_username||"").trim()||"Host",Ns=o.host_avatar??localStorage.getItem("host_avatar")??void 0,ce=y+K,$e=Number(localStorage.getItem("userId"))===i.host_id,de=Number(localStorage.getItem("userId")||"")||null,Re=u(i.id),Fe=!!de&&k.some(s=>s.guestId===de),Q=l&&r?Math.ceil((r.getTime()-l.getTime())/(1e3*60*60*24)):0,Ae=Q*(i.price_per_night||0),Te=0,Oe=Ae+Te,ws=()=>{if(!a)return;const s=a;Re?h(s):c(s)},ks=s=>new Date(s.getFullYear(),s.getMonth()+1,0).getDate(),Cs=s=>new Date(s.getFullYear(),s.getMonth(),1).getDay(),Le=(s,n)=>s?s.getDate()===n.getDate()&&s.getMonth()===n.getMonth()&&s.getFullYear()===n.getFullYear():!1,Ss=s=>!l||!r?!1:s>l&&s<r,Ee=s=>s<new Date(new Date().setHours(0,0,0,0))?!0:V.some(d=>s>=d.from&&s<d.to),Ms=s=>{if(!Ee(s))if(!l||l&&r)f(s),x(null);else if(s>l){if(V.some(d=>d.from>l&&d.from<s||d.to>l&&d.to<s||d.from<=l&&d.to>=s)){S({title:"Dates unavailable",description:"Selected range includes unavailable dates.",variant:"destructive"});return}x(s)}else f(s),x(null)},_s=()=>{Se(new Date(D.getFullYear(),D.getMonth()+1))},Is=()=>{Se(new Date(D.getFullYear(),D.getMonth()-1))},Ds=()=>{const s=ks(D),n=Cs(D),d=[];t("common.months",{returnObjects:!0});const N=t("common.daysMin",{returnObjects:!0});for(let w=0;w<n;w++)d.push(e.jsx("div",{className:"h-10"},`empty-${w}`));for(let w=1;w<=s;w++){const T=new Date(D.getFullYear(),D.getMonth(),w),He=Le(l,T),qe=Le(r,T),$s=Ss(T),ue=Ee(T);d.push(e.jsx("button",{onClick:()=>!ue&&Ms(T),disabled:ue,className:`h-10 w-10 flex items-center justify-center rounded-full text-sm font-medium transition-all
                        ${ue?"text-gray-300 cursor-not-allowed":"hover:bg-gray-100 text-gray-900"}
                        ${He||qe?"bg-gray-900 text-white hover:bg-gray-800":""}
                        ${$s&&!He&&!qe?"bg-gray-100":""}
                    `,children:w},w))}return e.jsxs("div",{className:"bg-white rounded-xl p-6 border border-gray-200",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("button",{onClick:Is,className:"p-2 hover:bg-gray-100 rounded-full transition-colors","aria-label":t("common.back"),children:e.jsx(ee,{className:"h-4 w-4"})}),e.jsx("h4",{className:"text-base font-semibold",children:new Intl.DateTimeFormat(H.language,{month:"long",year:"numeric"}).format(D)}),e.jsx("button",{onClick:_s,className:"p-2 hover:bg-gray-100 rounded-full transition-colors","aria-label":t("common.next"),children:e.jsx(as,{className:"h-4 w-4"})})]}),e.jsx("div",{className:"grid grid-cols-7 gap-1 mb-3",children:N.map(w=>e.jsx("div",{className:"h-10 flex items-center justify-center text-xs font-medium text-gray-500",children:w},w))}),e.jsx("div",{className:"grid grid-cols-7 gap-1",children:d})]})},me=async()=>{if($e){S({title:"Not allowed",description:"You cannot reserve your own listing.",variant:"destructive"});return}if(!l||!r){U(!0);return}const s=`${window.location.pathname}${window.location.search}`;if(!!!localStorage.getItem("userId")){S({title:"Login required",description:"Please log in to reserve a listing.",variant:"destructive"}),window.location.href=`/login?redirect=${encodeURIComponent(s||"/")}`;return}if((i.max_guests||0)>0&&ce>(i.max_guests||0)){S({title:"Too many guests",description:`This place allows up to ${i.max_guests} guests. Reduce the number of guests to continue.`,variant:"destructive"});return}try{await Hs({listing_id:i.id,check_in:E(l,"yyyy-MM-dd"),check_out:E(r,"yyyy-MM-dd"),guests:ce}),S({title:"Reservation successful",description:"Your reservation request has been sent."}),m("/bookings")}catch(d){console.error("Failed to reserve:",d),S({title:"Reservation failed",description:"Please try again.",variant:"destructive"})}},Ps=()=>{const s=o==null?void 0:o.contact_phone;Ys(s,t("listing.actions.whatsappGreeting",{name:W}))||_e(!0)};let _=xe;try{_=i.house_rules?JSON.parse(i.house_rules):xe}catch(s){console.error("Failed to parse house rules:",s),_=xe}let Y=[],he=i.description||null;try{if(i.description&&i.description.trim().startsWith("{")){const s=JSON.parse(i.description);Y=[["listingDescription",t("listing.details.about")],["propertyDetails",t("propertyDetails")],["guestAccess",t("guestAccess")],["guestInteraction",t("guestInteraction")],["otherNotes",t("otherNotes")],["otherDetails",t("otherDetails")]].map(([d,N])=>({title:N,text:typeof s[d]=="string"?s[d].trim():""})).filter(d=>d.text),Y.length>0&&(he=null)}}catch{Y=[],he=i.description||null}return e.jsxs("div",{className:"min-h-screen bg-background pb-20",children:[e.jsx(st,{title:i.title||t("listing.details.untitled"),description:((Ue=i.description)==null?void 0:Ue.substring(0,160))||t("listing.details.seoDescription"),image:M[0]?P(M[0].url):void 0,type:"article"}),e.jsx(tt,{}),e.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[e.jsxs("div",{className:"flex justify-between items-start mb-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl md:text-3xl font-bold mb-2",children:e.jsx(R,{as:"span",text:i.title})}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[e.jsxs("span",{className:"font-medium text-foreground",children:["★ ",t("listing.details.new")]}),e.jsx("span",{children:"•"}),e.jsxs("span",{className:"underline",children:[i.city,", ",i.country]})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(p,{variant:"outline",size:"sm",className:"gap-2",onClick:()=>Me(!0),children:[e.jsx(pe,{className:"h-4 w-4"}),t("listing.actions.share")]}),e.jsxs(p,{variant:"outline",size:"sm",className:"gap-2",onClick:ws,children:[e.jsx(be,{className:`h-4 w-4 ${Re?"fill-green-600 text-green-600":""}`}),t("listing.actions.save")]})]})]}),e.jsx(Mt,{isOpen:gs,onClose:()=>Me(!1),listing:{...i,photos:M}}),e.jsx(_t,{isOpen:ps,onClose:()=>_e(!1),listingId:i.id,hostId:i.host_id,hostName:W}),e.jsx(It,{isOpen:fs,onClose:()=>Ie(!1),hostId:i.host_id,listingId:i.id}),e.jsx(Dt,{isOpen:bs,onClose:()=>O(!1),photos:M,initialPhotoIndex:js}),e.jsx("div",{className:"mb-8 rounded-xl overflow-hidden shadow-sm",children:M.length>0?e.jsxs("div",{className:"relative group",children:[M.length===1?e.jsx(F,{src:P(M[0].url),alt:i.title,className:"w-full h-[300px] sm:h-[400px] md:h-[500px] object-cover cursor-pointer hover:scale-105 transition-transform duration-700",onClick:()=>{q(0),O(!0)},priority:!0}):M.length<=4?e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-2",children:M.slice(0,4).map((s,n)=>e.jsx("div",{className:`relative overflow-hidden cursor-pointer ${n===0?"sm:col-span-2 h-[300px] sm:h-[400px]":"h-[200px] sm:h-[250px]"}`,onClick:()=>{q(n),O(!0)},children:e.jsx(F,{src:P(s.url),alt:`Photo ${n+1}`,className:"w-full h-full object-cover hover:scale-105 transition-transform duration-500",quality:n===0?"high":"medium"})},s.id))}):e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-2 h-[300px] md:h-[450px]",children:[e.jsx("div",{className:"md:col-span-2 md:row-span-2 relative cursor-pointer overflow-hidden h-full",onClick:()=>{q(0),O(!0)},children:e.jsx(F,{src:P(M[0].url),alt:i.title,className:"w-full h-full object-cover hover:scale-105 transition-transform duration-500",quality:"high",priority:!0})}),e.jsx("div",{className:"hidden md:grid md:col-span-2 md:grid-cols-2 md:grid-rows-2 gap-2 h-full",children:M.slice(1,5).map((s,n)=>e.jsx("div",{className:"relative cursor-pointer overflow-hidden h-full",onClick:()=>{q(n+1),O(!0)},children:e.jsx(F,{src:P(s.url),alt:`Photo ${n+2}`,className:"w-full h-full object-cover hover:scale-105 transition-transform duration-500",quality:"medium"})},s.id))})]}),e.jsxs("button",{className:"absolute bottom-4 right-4 bg-white/90 backdrop-blur-sm px-4 py-2 rounded-lg border border-black/10 font-medium text-sm hover:bg-white hover:scale-105 transition-all shadow-sm flex items-center gap-2",onClick:()=>{q(0),O(!0)},children:[e.jsx("span",{className:"hidden sm:inline",children:t("listing.actions.showAllPhotos")}),e.jsx("span",{className:"sm:hidden",children:t("listing.details.photos")})]})]}):e.jsx("div",{className:"w-full h-64 md:h-[400px] bg-muted flex items-center justify-center rounded-xl",children:e.jsx("p",{className:"text-muted-foreground",children:t("listing.details.noPhotos")})})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-12",children:[e.jsxs("div",{className:"md:col-span-2",children:[e.jsxs("div",{className:"border-b pb-6 mb-6",children:[e.jsx("h2",{className:"text-xl font-semibold mb-1",children:e.jsx(R,{as:"span",text:`${i.property_type} hosted by ${W}`})}),e.jsxs("p",{className:"text-muted-foreground",children:[t("listing.details.unitCount.guests",{count:i.max_guests})," • ",t("listing.details.unitCount.bedrooms",{count:i.bedrooms})," • ",t("listing.details.unitCount.beds",{count:i.beds})," • ",t("listing.details.unitCount.baths",{count:i.bathrooms})]})]}),e.jsxs("div",{className:"border-b pb-6 mb-6",children:[e.jsx("h3",{className:"font-semibold mb-4",children:t("listing.details.about")}),Y.length>0?e.jsx("div",{className:"space-y-4",children:Y.map((s,n)=>e.jsxs("div",{className:"space-y-1",children:[e.jsx("div",{className:"font-semibold",children:s.title}),e.jsx(R,{as:"p",className:"text-muted-foreground whitespace-pre-line",text:s.text})]},n))}):e.jsx(R,{as:"p",className:"text-muted-foreground whitespace-pre-line",text:he||""})]}),e.jsxs("div",{className:"border-b pb-6 mb-6",children:[e.jsx("h3",{className:"font-semibold mb-4",children:t("listing.details.offers")}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:oe.slice(0,10).map(s=>{const n=Gs[s];if(!n)return null;const d=n.icon;return e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(d,{className:"h-6 w-6 text-gray-700"}),e.jsx("span",{className:"text-gray-900",children:t(`amenities.${s}`)})]},s)})}),oe.length>10&&e.jsx(p,{variant:"outline",className:"mt-6",children:t("listing.details.showAllAmenities",{count:oe.length})})]}),e.jsxs("div",{className:"border-b pb-12 mb-12",children:[e.jsx("h3",{className:"text-xl font-semibold mb-2",children:l&&r?t("listing.details.nightsInCity",{count:Math.ceil((r.getTime()-l.getTime())/(1e3*60*60*24)),city:i.city}):t("listing.details.selectCheckIn")}),e.jsx("p",{className:"text-muted-foreground mb-6",children:l&&r?`${E(l,"MMM d, yyyy",{locale:A})} - ${E(r,"MMM d, yyyy",{locale:A})}`:t("listing.details.addDatesPricing")}),e.jsx("div",{className:"hidden md:block",children:e.jsx(ge,{mode:"range",selected:l?{from:l,to:r||void 0}:void 0,onSelect:s=>{s!=null&&s.from&&f(s.from),x((s==null?void 0:s.to)||null),s||(f(null),x(null))},numberOfMonths:2,pagedNavigation:!0,disabled:[{before:new Date},...V],modifiersStyles:{selected:{backgroundColor:"#222222",color:"white"},range_middle:{backgroundColor:"#F7F7F7",color:"#222222"},range_start:{backgroundColor:"#222222",color:"white"},range_end:{backgroundColor:"#222222",color:"white"}},locale:A,className:"border-0"})}),e.jsx("div",{className:"md:hidden flex justify-center",children:e.jsx(ge,{mode:"range",selected:l?{from:l,to:r||void 0}:void 0,onSelect:s=>{s!=null&&s.from&&f(s.from),x((s==null?void 0:s.to)||null),s||(f(null),x(null))},numberOfMonths:1,disabled:[{before:new Date},...V],modifiersStyles:{selected:{backgroundColor:"#222222",color:"white"},range_middle:{backgroundColor:"#F7F7F7",color:"#222222"},range_start:{backgroundColor:"#222222",color:"white"},range_end:{backgroundColor:"#222222",color:"white"}},locale:A})}),e.jsx("div",{className:"flex justify-end mt-4",children:e.jsx(p,{variant:"ghost",className:"underline font-semibold",onClick:()=>{f(null),x(null)},children:t("listing.actions.clearDates")})})]}),e.jsxs("div",{className:"border-b pb-12 mb-12",children:[e.jsxs("div",{className:"flex items-center justify-between mb-8",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ts,{className:"h-5 w-5 fill-current"}),e.jsx("h2",{className:"text-2xl font-semibold",children:k.length===0?t("listing.reviews.noReviewsYet"):`${(k.reduce((s,n)=>s+Object.values(n.ratings).reduce((d,N)=>d+N,0)/6,0)/k.length).toFixed(2)} · ${t("listing.reviews.count",{count:k.length})}`})]}),e.jsx(p,{variant:"outline",disabled:Fe,onClick:()=>{if(!de){S({title:"Login required",description:"Please log in to write a review.",variant:"destructive"});const s=`${window.location.pathname}${window.location.search}`;window.location.href=`/login?redirect=${encodeURIComponent(s||"/")}`;return}if(Fe){S({title:"Already reviewed",description:"You can only review this listing once."});return}Z(!0)},children:t("listing.actions.writeReview")})]}),e.jsx(St,{isOpen:xs,onClose:()=>Z(!1),onSubmit:ys}),k.length>0&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-x-12 gap-y-4 mb-8",children:["cleanliness","accuracy","checkin","communication","location","value"].map(s=>{const n=k.reduce((d,N)=>d+N.ratings[s],0)/k.length;return e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm md:text-base capitalize",children:t(`listing.reviews.categories.${s}`)}),e.jsxs("div",{className:"flex items-center gap-3 w-1/2",children:[e.jsx(ms,{value:n*20,className:"h-1"}),e.jsx("span",{className:"text-xs font-semibold",children:n.toFixed(1)})]})]},s)})}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-8",children:k.map(s=>e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsxs(Ve,{className:"h-10 w-10",children:[e.jsx(We,{src:s.user.avatar}),e.jsx(Ye,{children:s.user.name.charAt(0)})]}),e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold",children:s.user.name}),e.jsx("div",{className:"text-sm text-muted-foreground",children:new Date(s.timestamp).toLocaleDateString(vs,{month:"long",year:"numeric"})})]})]}),e.jsx(R,{as:"p",className:"text-muted-foreground line-clamp-3",text:s.comment})]},s.id))})]})]})]}),e.jsx("div",{className:"relative hidden md:block",children:e.jsxs("div",{className:"sticky top-24 border rounded-xl p-6 shadow-lg bg-white",children:[e.jsx("div",{className:"flex justify-between items-end mb-6",children:e.jsxs("div",{children:[e.jsx("span",{className:"text-2xl font-bold",children:L(i.price_per_night||0)}),e.jsxs("span",{className:"text-muted-foreground",children:[" / ",t("per night")]})]})}),e.jsxs("div",{className:"border rounded-lg mb-4",children:[e.jsxs("div",{className:"grid grid-cols-2 border-b",children:[e.jsxs("div",{className:"p-3 border-r cursor-pointer hover:bg-gray-50",onClick:()=>{window.matchMedia("(max-width: 767px)").matches?ne():(U(!0),setTimeout(()=>{var s;return(s=le.current)==null?void 0:s.scrollIntoView({behavior:"smooth",block:"start"})},0))},children:[e.jsx("div",{className:"text-[10px] font-bold uppercase",children:t("listing.booking.checkIn")}),e.jsx("div",{className:"text-sm",children:l?l.toLocaleDateString(H.language):t("listing.booking.addDate")})]}),e.jsxs("div",{className:"p-3 cursor-pointer hover:bg-gray-50",onClick:()=>{window.matchMedia("(max-width: 767px)").matches?ne():(U(!0),setTimeout(()=>{var s;return(s=le.current)==null?void 0:s.scrollIntoView({behavior:"smooth",block:"start"})},0))},children:[e.jsx("div",{className:"text-[10px] font-bold uppercase",children:t("listing.booking.checkout")}),e.jsx("div",{className:"text-sm",children:r?r.toLocaleDateString(H.language):t("listing.booking.addDate")})]})]}),e.jsxs("div",{className:"p-3 relative",children:[e.jsxs("div",{className:"cursor-pointer",onClick:()=>Ce(!ke),children:[e.jsx("div",{className:"text-[10px] font-bold uppercase",children:t("listing.booking.guests")}),e.jsx("div",{className:"text-sm",children:t("listing.booking.guestCount",{count:ce})})]}),ke&&e.jsxs("div",{className:"absolute top-full left-0 right-0 mt-2 bg-white border border-gray-300 rounded-lg shadow-lg p-4 z-10 w-80",children:[e.jsxs("div",{className:"flex items-center justify-between py-4 border-b border-gray-200",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold",children:t("listing.booking.adults")}),e.jsx("div",{className:"text-sm text-gray-500",children:t("Age 13+")})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{onClick:()=>$(Math.max(1,y-1)),disabled:y<=1,className:`w-8 h-8 rounded-full border flex items-center justify-center transition-colors ${y<=1?"border-gray-200 text-gray-300":"border-gray-400 text-gray-600"}`,children:e.jsx(lt,{className:"h-4 w-4"})}),e.jsx("span",{className:"w-8 text-center font-medium",children:y}),e.jsx("button",{onClick:()=>$(y+1),className:"w-8 h-8 rounded-full border border-gray-400 text-gray-600 flex items-center justify-center",children:e.jsx(nt,{className:"h-4 w-4"})})]})]}),e.jsx(p,{variant:"ghost",className:"w-full mt-2",onClick:()=>Ce(!1),children:t("listing.actions.close")})]})]})]}),hs&&e.jsxs("div",{className:"mb-4",ref:le,children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("button",{className:"text-sm font-semibold underline",onClick:()=>U(!1),"aria-label":"Close calendar",children:t("listing.actions.close")}),e.jsx("button",{className:"text-sm underline text-muted-foreground hover:text-foreground",onClick:()=>{f(null),x(null)},children:t("listing.actions.clearDates")})]}),Ds()]}),l&&r&&Q>0&&e.jsxs("div",{className:"mb-4 pb-4 border-b space-y-3",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsxs("span",{className:"text-muted-foreground",children:[L(i.price_per_night||0)," × ",Q," ",t(Q===1?"night":"nights")]}),e.jsx("span",{className:"font-medium",children:L(Ae)})]}),Te>0,e.jsxs("div",{className:"flex justify-between text-base font-bold pt-3 border-t",children:[e.jsx("span",{children:t("listing.booking.total")}),e.jsx("span",{children:L(Oe)})]})]}),e.jsx(p,{className:"w-full bg-green-600 hover:bg-green-700 text-white font-semibold py-6 text-lg",onClick:me,disabled:$e||!l||!r,children:t("listing.actions.reserve")}),e.jsx("div",{className:"text-center mt-4 text-sm text-muted-foreground",children:t("listing.booking.noCharge")})]})})]}),e.jsxs("div",{className:"py-8 border-t border-gray-200",children:[e.jsx("h3",{className:"text-xl font-semibold mb-4",children:t("listing.details.location")}),e.jsxs("div",{className:"mb-6",children:[e.jsx("p",{className:"font-medium text-gray-900 text-lg",children:i.address||`${i.city}, ${i.country}`}),i.latitude&&i.longitude&&e.jsxs("p",{className:"text-gray-500 mt-1",children:[i.latitude,", ",i.longitude]})]}),e.jsx("div",{className:"h-64 md:h-[400px] rounded-xl overflow-hidden z-0 relative",children:e.jsxs(Js,{center:[i.latitude||4.0511,i.longitude||9.7679],zoom:13,scrollWheelZoom:!1,className:"h-full w-full",children:[e.jsx(Ks,{attribution:'© <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png"}),e.jsx(Xs,{position:[i.latitude||4.0511,i.longitude||9.7679],children:e.jsxs(rt,{children:[e.jsx("div",{className:"font-semibold",children:i.title}),e.jsx("div",{className:"text-sm text-gray-600",children:t("listing.details.exactLocation")})]})})]})})]}),(i.getting_around||i.scenic_views&&i.scenic_views.length>0)&&e.jsx("div",{className:"py-8 border-t border-gray-200",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-8",children:[i.getting_around&&e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-semibold mb-4",children:t("listing.details.gettingAround")}),e.jsx(R,{as:"p",className:"text-muted-foreground whitespace-pre-line",text:i.getting_around||""})]}),i.scenic_views&&e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-semibold mb-4",children:t("listing.details.scenicViews")}),e.jsx("div",{className:"flex flex-wrap gap-2",children:(()=>{try{const s=typeof i.scenic_views=="string"?JSON.parse(i.scenic_views):i.scenic_views;return Array.isArray(s)?s.map((n,d)=>e.jsx("div",{className:"bg-gray-100 px-3 py-1 rounded-full text-sm text-gray-700",children:e.jsx(R,{as:"span",text:n})},d)):null}catch{return null}})()})]})]})}),e.jsxs("div",{className:"mt-12 pt-8 border-t border-gray-200",children:[e.jsx("h3",{className:"text-xl font-semibold mb-6",children:t("listing.host.meet")}),e.jsxs("div",{className:"bg-[#F0EFE9] rounded-2xl p-6 md:p-8 grid grid-cols-1 md:grid-cols-3 gap-8",children:[e.jsxs("div",{className:"bg-white rounded-2xl p-6 shadow-lg flex flex-col items-center text-center md:col-span-1 cursor-pointer hover:shadow-xl transition",onClick:()=>m(`/hosts/${i.host_id}`),children:[e.jsx("div",{className:"relative mb-4",children:e.jsxs(Ve,{className:"h-24 w-24",children:[e.jsx(We,{src:Ns||void 0}),e.jsx(Ye,{children:W.slice(0,2).toUpperCase()})]})}),e.jsx("h4",{className:"text-2xl font-bold mb-1",children:W}),e.jsx("div",{className:"w-full space-y-4 mt-4",children:e.jsxs("div",{className:"flex justify-between items-center border-b pb-4",children:[e.jsxs("div",{className:"text-left",children:[e.jsx("div",{className:"font-bold text-lg",children:k.length}),e.jsx("div",{className:"text-xs text-muted-foreground",children:t("listing.host.reviews")})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"font-bold text-lg",children:k.length>0?(k.reduce((s,n)=>s+Object.values(n.ratings).reduce((d,N)=>d+N,0)/6,0)/k.length).toFixed(2):t("listing.details.new")}),e.jsx("div",{className:"text-xs text-muted-foreground",children:t("listing.host.rating")})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"font-bold text-lg",children:t("listing.details.new")}),e.jsx("div",{className:"text-xs text-muted-foreground",children:t("listing.host.yearsHosting")})]})]})})]}),e.jsx("div",{className:"md:col-span-2 space-y-6",children:e.jsxs("div",{className:"pt-4",children:[e.jsx("h4",{className:"text-lg font-semibold mb-2",children:t("listing.host.aboutTitle")}),localStorage.getItem("host_location")&&e.jsxs("div",{className:"flex items-center gap-2 mb-2 text-gray-700",children:[e.jsx(ls,{className:"h-5 w-5"}),e.jsx("span",{children:t("listing.host.livesIn",{location:localStorage.getItem("host_location")})})]}),localStorage.getItem("host_languages")&&e.jsxs("div",{className:"flex items-center gap-2 mb-4 text-gray-700",children:[e.jsx(je,{className:"h-5 w-5"}),e.jsx("span",{children:t("listing.host.speaks",{langs:localStorage.getItem("host_languages")})})]}),e.jsx("p",{className:"text-muted-foreground mb-6",children:t("listing.host.bioDefault")}),e.jsx(p,{variant:"outline",className:"font-semibold border-black text-black hover:bg-gray-100",onClick:Ps,children:t("listing.actions.messageHost")}),e.jsx("div",{className:"mt-4 flex justify-center md:justify-start",children:e.jsxs("button",{onClick:()=>Ie(!0),className:"flex items-center gap-2 text-sm text-muted-foreground hover:text-foreground underline",children:[e.jsx(xt,{className:"h-4 w-4"}),t("listing.actions.reportHost")]})})]})})]})]}),e.jsxs("div",{className:"mt-12 pt-8 border-t border-gray-200",children:[e.jsx("h3",{className:"text-xl font-semibold mb-6",children:t("listing.details.thingsToKnow")}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-8",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold mb-4",children:t("listing.details.houseRules")}),e.jsxs("div",{className:"space-y-2 text-sm text-gray-700",children:[e.jsxs("p",{children:[t("listing.booking.checkIn"),": ",_.check_in_start," - ",_.check_in_end]}),e.jsxs("p",{children:[t("listing.booking.checkout"),": ",_.checkout_time]}),e.jsx("p",{children:t("listing.details.maxGuests",{count:i.max_guests})}),e.jsx("p",{children:_.pets_allowed?t("host.editor.safety.rules.pets"):t("preview.noPets")}),e.jsx("p",{children:_.events_allowed?t("host.editor.safety.rules.events"):t("preview.noParties")}),e.jsx("p",{children:_.smoking_allowed?t("listing.details.houseRulesProps.smokingAllowed"):t("preview.noSmoking")}),e.jsx("p",{children:_.quiet_hours?t("listing.details.houseRulesProps.quietHoursEnforced"):t("listing.details.houseRulesProps.quietHoursNotEnforced")}),e.jsx("p",{children:_.commercial_photography_allowed?t("listing.details.houseRulesProps.photographyAllowed"):t("listing.details.houseRulesProps.photographyNotAllowed")})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold mb-4",children:t("listing.details.safetyProperty")}),e.jsx("div",{className:"space-y-2 text-sm text-gray-700",children:i.safety_devices&&(()=>{let s=[];try{i.safety_devices.trim().startsWith("[")?s=JSON.parse(i.safety_devices):s=i.safety_devices.split(",")}catch{s=[i.safety_devices]}return s.map((n,d)=>e.jsx(R,{as:"p",text:n},d))})()})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold mb-4",children:t("listing.details.cancellationPolicy")}),e.jsx("p",{className:"text-sm text-gray-700",children:i.cancellation_policy||t("listing.details.flexibleCancellation")})]})]})]})]}),e.jsx("div",{className:"fixed bottom-0 inset-x-0 z-50 bg-white border-t border-gray-200 p-4 md:hidden pb-safe",children:e.jsxs("div",{className:"flex items-center justify-between max-w-7xl mx-auto",children:[e.jsxs("div",{className:"flex flex-col",children:[l&&r?e.jsxs("div",{className:"flex items-baseline gap-1",children:[e.jsx("span",{className:"font-bold text-lg",children:L(Oe)}),e.jsx("span",{className:"text-sm text-muted-foreground",children:t("listing.booking.total")})]}):e.jsxs("div",{className:"flex items-baseline gap-1",children:[e.jsx("span",{className:"font-bold text-lg",children:L(i.price_per_night||0)}),e.jsxs("span",{className:"text-sm text-muted-foreground",children:["/ ",t("per night")]})]}),e.jsx("span",{className:"text-xs font-medium underline cursor-pointer",onClick:()=>X(!0),children:l&&r?`${E(l,"MMM d",{locale:A})} - ${E(r,"MMM d",{locale:A})}`:t("listing.booking.addDate")})]}),e.jsx(p,{className:"bg-green-600 hover:bg-green-700 text-white font-semibold px-8",onClick:()=>l&&r?me():ne(),children:t(l&&r?"listing.actions.reserve":"listing.booking.selectDates")})]})}),e.jsx(B,{open:us,onOpenChange:s=>{var n,d;if(s)try{(d=(n=document.activeElement)==null?void 0:n.blur)==null||d.call(n)}catch{}X(s)},children:e.jsxs(G,{className:"md:hidden w-full max-w-none p-0 gap-0",onOpenAutoFocus:s=>{var n;s.preventDefault(),(n=Pe.current)==null||n.focus()},children:[e.jsxs("div",{className:"flex items-center justify-between px-4 py-3 border-b",children:[e.jsx("button",{ref:Pe,className:"p-2 -ml-2","aria-label":"Close",onClick:()=>X(!1),children:e.jsx(Ls,{className:"h-5 w-5"})}),e.jsx("button",{className:"text-sm font-semibold underline",onClick:()=>{f(null),x(null)},children:t("listing.actions.clearDates")})]}),e.jsxs("div",{className:"px-4 pt-4",children:[e.jsxs(ae,{className:"mb-2",children:[e.jsx(J,{className:"text-lg font-semibold",children:t("listing.details.selectCheckIn")}),e.jsx(Es,{className:"text-sm text-muted-foreground",children:t("listing.details.addDatesPricing")})]}),e.jsx(ge,{mode:"range",selected:l?{from:l,to:r||void 0}:void 0,onSelect:s=>{s!=null&&s.from&&f(s.from),x((s==null?void 0:s.to)||null),s||(f(null),x(null))},numberOfMonths:1,disabled:[{before:new Date},...V],modifiersStyles:{selected:{backgroundColor:"#222222",color:"white"},range_middle:{backgroundColor:"#F7F7F7",color:"#222222"},range_start:{backgroundColor:"#222222",color:"white"},range_end:{backgroundColor:"#222222",color:"white"}},locale:A,className:"border-0"})]}),e.jsx("div",{className:"p-4 border-t",children:e.jsx(p,{className:"w-full",disabled:!l||!r,onClick:()=>{U(!1),me()},children:t("listing.actions.reserve")})})]})}),e.jsx(et,{})]})};export{ba as default};
