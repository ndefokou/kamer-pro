import{j as e,r as o,a7 as t,X as s}from"./vendor-ui-DcvuiMJW.js";import{e as r,k as a,r as i}from"./vendor-react-CPc5zwff.js";import{G as l,n as d}from"./index-DwPe7WlF.js";import{O as n}from"./OptimizedImage-DunbvjKP.js";import{u as c}from"./useTranslation-BptfK32d.js";import"./vendor-charts-CNjKuHaK.js";import"./vendor-utils-tyqSID0v.js";const h=()=>{const h=r(),{t:p}=c(),{id:m}=a(),[u,g]=i.useState([]),[x,b]=i.useState([]),[y,f]=i.useState(!1),v=i.useRef(null);i.useEffect(()=>{j()},[m]);const j=async()=>{var e;try{const o=await l.get(`/listings/${m}`),t=(null==(e=o.data.photos)?void 0:e.filter(e=>{var o;return(null==(o=e.caption)?void 0:o.toLowerCase().includes("bedroom"))||"bedroom"===e.room_type}))||[];g(t)}catch(o){}},w=u.length+x.length;return e.jsxs("div",{className:"min-h-screen bg-white",children:[e.jsx("header",{className:"sticky top-0 bg-white border-b border-gray-200 z-10",children:e.jsxs("div",{className:"max-w-7xl mx-auto px-6 h-16 flex items-center justify-between",children:[e.jsx("button",{onClick:()=>h(`/host/editor/${m}`),className:"p-2 hover:bg-gray-100 rounded-full transition-colors",children:e.jsx(o,{className:"h-5 w-5"})}),e.jsx("h2",{className:"text-lg font-semibold",children:p("host.editor.bedroom","Bedroom")}),e.jsx("div",{className:"w-10"})]})}),e.jsxs("div",{className:"max-w-4xl mx-auto px-6 py-8",children:[e.jsx("h1",{className:"text-3xl font-semibold mb-2",children:p("host.editor.bedroomPhotos","Bedroom photos")}),e.jsx("p",{className:"text-gray-500 mb-8",children:p("host.editor.addBedroomPhotosHelp","Add photos of your bedroom. You can select multiple photos at once.")}),w>0&&e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-4 mb-6",children:[u.map(o=>e.jsxs("div",{className:"relative aspect-square rounded-lg overflow-hidden border border-gray-200 group",children:[e.jsx(n,{src:d(o.url),alt:o.caption,className:"w-full h-full object-cover"}),e.jsx("div",{className:"absolute inset-0 bg-black/40 opacity-0 group-hover:opacity-100 transition-opacity flex items-start justify-end p-2",children:e.jsx("button",{onClick:()=>(async e=>{if(confirm(p("host.editor.confirmDeletePhoto","Are you sure you want to delete this photo?")))try{const o=((await l.get(`/listings/${m}`)).data.photos||[]).filter(o=>String(o.id)!==String(e)).map((e,o)=>({url:e.url,caption:e.caption,room_type:e.room_type,is_cover:1===e.is_cover||!0===e.is_cover,display_order:o}));await l.post(`/listings/${m}/photos`,{photos:o}),g(o=>o.filter(o=>String(o.id)!==String(e)))}catch(o){}})(o.id),className:"p-1.5 bg-white rounded-full text-red-600 hover:bg-gray-100 shadow-sm",title:p("common.delete","Delete"),children:e.jsx(t,{className:"h-4 w-4"})})})]},o.id)),x.map((o,t)=>e.jsxs("div",{className:"relative aspect-square rounded-lg overflow-hidden border-2 border-green-500",children:[e.jsx(n,{src:o.preview,alt:p("common.pendingUpload","Pending upload"),className:"w-full h-full object-cover"}),e.jsx("button",{onClick:()=>(e=>{b(o=>{const t=[...o];return URL.revokeObjectURL(t[e].preview),t.splice(e,1),t})})(t),className:"absolute top-2 right-2 p-1.5 bg-white rounded-full shadow-lg hover:bg-gray-100 transition-colors",children:e.jsx(s,{className:"h-4 w-4"})}),e.jsx("div",{className:"absolute bottom-2 left-2 px-2 py-1 bg-green-500 text-white text-xs font-medium rounded",children:p("common.new","New")})]},`pending-${t}`))]}),e.jsxs("div",{className:"border-2 border-dashed border-gray-300 rounded-xl p-12 text-center bg-white mb-6",children:[0===w&&e.jsx("div",{className:"mb-6",children:e.jsxs("svg",{className:"h-32 w-32 mx-auto mb-6",viewBox:"0 0 120 100",fill:"none",children:[e.jsx("path",{d:"M20 60 L100 60 L100 75 L20 75 Z",fill:"#E5E7EB",stroke:"#9CA3AF",strokeWidth:"1.5"}),e.jsx("path",{d:"M25 50 L95 50 L95 60 L25 60 Z",fill:"#F97316",stroke:"#EA580C",strokeWidth:"1.5"}),e.jsx("rect",{x:"70",y:"40",width:"20",height:"12",rx:"2",fill:"#D1D5DB",stroke:"#9CA3AF",strokeWidth:"1.5"}),e.jsx("line",{x1:"25",y1:"75",x2:"25",y2:"85",stroke:"#9CA3AF",strokeWidth:"2"}),e.jsx("line",{x1:"95",y1:"75",x2:"95",y2:"85",stroke:"#9CA3AF",strokeWidth:"2"})]})}),e.jsx("input",{ref:v,type:"file",multiple:!0,accept:"image/*",onChange:e=>{const o=e.target.files;if(!o||0===o.length)return;const t=Array.from(o).map(e=>({file:e,preview:URL.createObjectURL(e)}));b(e=>[...e,...t]),v.current&&(v.current.value="")},className:"hidden"}),e.jsx("button",{onClick:()=>{var e;return null==(e=v.current)?void 0:e.click()},disabled:y,className:"px-6 py-2 border border-gray-900 rounded-lg font-medium hover:bg-gray-100 transition-colors disabled:opacity-50",children:0===w?p("host.editor.addPhotos","Add photos"):p("host.photos.addMorePhotos","Add more photos")}),x.length>0&&e.jsxs("p",{className:"text-sm text-gray-500 mt-3",children:[x.length," ",1!==x.length?p("host.photos.photosPlural","photos"):p("host.photos.photoSingular","photo")," ",p("host.photos.readyToUpload","ready to upload")]})]}),x.length>0&&e.jsxs("div",{className:"flex justify-end gap-3",children:[e.jsx("button",{onClick:()=>{x.forEach(e=>URL.revokeObjectURL(e.preview)),b([])},disabled:y,className:"px-6 py-3 border border-gray-300 rounded-lg font-medium hover:bg-gray-50 transition-colors disabled:opacity-50",children:p("common.cancel","Cancel")}),e.jsx("button",{onClick:async()=>{if(0!==x.length){f(!0);try{const e=(await l.get(`/listings/${m}`)).data.photos||[],o=[];for(const r of x){const e=new FormData;e.append("file",r.file);const t=await l.post("/upload/images",e,{headers:{"Content-Type":"multipart/form-data"}});o.push(t.data.urls[0])}const t=e.map(e=>({url:e.url,caption:e.caption,room_type:e.room_type,is_cover:1===e.is_cover||!0===e.is_cover,display_order:e.display_order})),s=o.map(e=>({url:e,caption:"Bedroom photo",room_type:"bedroom",is_cover:!1,display_order:0}));await l.post(`/listings/${m}/photos`,{photos:[...t,...s]}),x.forEach(e=>URL.revokeObjectURL(e.preview)),b([]),await j()}catch(e){}finally{f(!1)}}},disabled:y,className:"px-6 py-3 bg-black text-white rounded-lg font-medium hover:bg-gray-800 transition-colors disabled:opacity-50",children:y?p("common.saving","Saving..."):p("common.savePhotosCount","Save {{count}} {{unit}}",{count:x.length,unit:1!==x.length?p("host.photos.photosPlural","photos"):p("host.photos.photoSingular","photo")})})]})]})]})};export{h as default};
