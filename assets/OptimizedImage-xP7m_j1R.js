import{r as s,a$ as q,j as m,b0 as v}from"./index-BumHlSai.js";const M=({src:a,alt:x,className:R="",width:j,height:S,priority:f=!1,quality:k,onLoad:r,onError:c,onClick:O})=>{const[i,u]=s.useState(""),[l,n]=s.useState(!0),[E,d]=s.useState(!1),[h,P]=s.useState(f),b=s.useRef(null),{recommendedImageQuality:y}=q(),w=k||y,U=(e,o)=>{if(!e)return"";if(e.startsWith("data:")||e.startsWith("blob:"))return e;try{const t=new URL(e,window.location.origin);return o==="low"?(t.searchParams.set("w","400"),t.searchParams.set("q","50")):o==="medium"?(t.searchParams.set("w","800"),t.searchParams.set("q","70")):(t.searchParams.set("w","1200"),t.searchParams.set("q","85")),z()&&t.searchParams.set("fm","webp"),t.toString()}catch{return e}},z=()=>{const e=document.createElement("canvas");return e.getContext&&e.getContext("2d")?e.toDataURL("image/webp").indexOf("data:image/webp")===0:!1};s.useEffect(()=>{if(f||!b.current)return;const e=new IntersectionObserver(o=>{o.forEach(t=>{t.isIntersecting&&(P(!0),e.disconnect())})},{rootMargin:"50px",threshold:.01});return e.observe(b.current),()=>{e.disconnect()}},[f]),s.useEffect(()=>{if(!h||!a)return;let e=!0;return(async()=>{try{n(!0),d(!1);const t=await v.getCachedImage(a);if(t&&e){const g=URL.createObjectURL(t);u(g),n(!1),r==null||r();return}const W=U(a,w),p=await fetch(W);if(!p.ok)throw new Error("Failed to load image");const I=await p.blob();if(await v.cacheImage(a,I),e){const g=URL.createObjectURL(I);u(g),n(!1),r==null||r()}}catch(t){console.error("Error loading image:",t),e&&(u(a),d(!0),n(!1),c==null||c())}})(),()=>{e=!1,i&&i.startsWith("blob:")&&URL.revokeObjectURL(i)}},[h,a,w]);const C={backgroundColor:"#e5e7eb",backgroundImage:l?"linear-gradient(90deg, #e5e7eb 0%, #f3f4f6 50%, #e5e7eb 100%)":void 0,backgroundSize:l?"200% 100%":void 0,animation:l?"shimmer 1.5s infinite":void 0};return m.jsxs(m.Fragment,{children:[m.jsx("style",{children:`
          @keyframes shimmer {
            0% { background-position: -200% 0; }
            100% { background-position: 200% 0; }
          }
        `}),m.jsx("img",{ref:b,src:i||void 0,alt:x,className:R,width:j,height:S,loading:f?"eager":"lazy",style:i?void 0:C,onClick:O,onError:()=>{d(!0),n(!1),c==null||c()}})]})};export{M as O};
