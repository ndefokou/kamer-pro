import{j as e,r as t,_ as a,a0 as s}from"./vendor-ui-CAOOb9ur.js";import{f as r,h as l,r as o}from"./vendor-react-C_40T_Qy.js";import{I as n,u as i,B as u}from"./index-CHW3rl59.js";import{L as c}from"./Loading-CFf4ybmz.js";import{L as d}from"./LanguageSwitcher-CRTEz5Uf.js";import{u as m}from"./useTranslation-DgYtz7Wb.js";import"./vendor-charts-knjLkUkQ.js";import"./vendor-utils-tyqSID0v.js";import"./index-BzbEf57Q.js";const g=new class{async startRegistration(e){return(await n.post("/auth/register/start",{username:e})).data}async completeRegistration(e,t,a,s){return(await n.post("/auth/register/complete",{username:e,email:t,credential_id:a,public_key:s})).data}async startAuthentication(e){return(await n.post("/auth/login/start",{username:e})).data}async completeAuthentication(e,t){return(await n.post("/auth/login/complete",{username:e,signature:t})).data}async register(e,t,a,s){return(await n.post("/auth/register",{username:e,password:t,phone:a,email:s})).data}async login(e,t){return(await n.post("/auth/login",{email:e,password:t})).data}static arrayBufferToBase64(e){const t=new Uint8Array(e);let a="";for(let s=0;s<t.byteLength;s++)a+=String.fromCharCode(t[s]);return btoa(a)}static base64ToArrayBuffer(e){const t=atob(e),a=new Uint8Array(t.length);for(let s=0;s<t.length;s++)a[s]=t.charCodeAt(s);return a.buffer}},h=async(e,t=3,a=600)=>{let s;for(let l=0;l<t;l++)try{return await e()}catch(r){if(s=r,l<t-1){const e=a*Math.pow(2,l);await new Promise(t=>setTimeout(t,e))}}throw s},x=()=>{const{t:n}=m(),x=r(),[p]=l(),f=o.useMemo(()=>p.get("redirect")||"/",[p]),{login:b,user:y,loading:j}=i(),[v,w]=o.useState(p.get("tab")||"login"),[N,S]=o.useState(""),[k,C]=o.useState(""),[I,A]=o.useState(!1),[z,L]=o.useState(""),[B,F]=o.useState(""),[T,_]=o.useState(""),[E,M]=o.useState(""),[P,R]=o.useState(""),[U,D]=o.useState(!1),[H,V]=o.useState(!1),[q,G]=o.useState(!1),[J,K]=o.useState(null);o.useEffect(()=>{const e=p.get("tab");"login"!==e&&"register"!==e||w(e)},[p]),o.useEffect(()=>{y&&x(f,{replace:!0})},[y,x,f]);return j?e.jsx(c,{fullScreen:!0,message:n("common.loading")}):e.jsxs("div",{className:"min-h-screen bg-white flex items-center justify-center px-4 py-10 relative",children:[e.jsx(u,{variant:"ghost",size:"icon",onClick:()=>x(-1),className:"absolute top-6 left-6 rounded-full hover:bg-gray-100","aria-label":n("common.back"),children:e.jsx(t,{className:"h-6 w-6"})}),e.jsx("div",{className:"absolute top-6 right-6",children:e.jsx(d,{})}),e.jsxs("div",{className:"w-full max-w-md",children:[e.jsxs("div",{className:"mb-6 text-center",children:[e.jsx("h1",{className:"text-2xl font-semibold",children:n("auth.welcome")}),e.jsx("p",{className:"text-gray-600 text-sm",children:n("auth.loginSubtitle")})]}),e.jsxs("div",{className:"flex p-1 bg-gray-100 rounded-full mb-6 w-full",children:[e.jsx("button",{className:"flex-1 py-2 rounded-full text-sm font-semibold "+("login"===v?"bg-white shadow":"text-gray-600"),onClick:()=>w("login"),children:n("auth.login")}),e.jsx("button",{className:"flex-1 py-2 rounded-full text-sm font-semibold "+("register"===v?"bg-white shadow":"text-gray-600"),onClick:()=>w("register"),children:n("auth.register")})]}),e.jsxs("div",{className:"bg-white border border-gray-200 rounded-xl p-6 space-y-4",children:["login"===v?e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:n("auth.email")}),e.jsx("input",{type:"email",value:N,onChange:e=>S(e.target.value),className:"w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-gray-300",placeholder:"you@example.com"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:n("auth.password")}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:I?"text":"password",value:k,onChange:e=>C(e.target.value),className:"w-full border border-gray-300 rounded-lg px-3 py-2 pr-10 focus:outline-none focus:ring-2 focus:ring-gray-300",placeholder:"••••••••"}),e.jsx("button",{type:"button",onClick:()=>A(!I),className:"absolute right-3 top-1/2 -translate-y-1/2 text-gray-500 hover:text-gray-700",children:I?e.jsx(a,{size:18}):e.jsx(s,{size:18})})]})]})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:n("auth.username")}),e.jsx("input",{value:z,onChange:e=>L(e.target.value),className:"w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-gray-300",placeholder:"johndoe"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:n("auth.email")}),e.jsx("input",{type:"email",value:T,onChange:e=>_(e.target.value),className:"w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-gray-300",placeholder:"you@example.com"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:n("auth.phoneLabel")}),e.jsx("input",{type:"tel",value:B,onChange:e=>F(e.target.value),className:"w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-gray-300",placeholder:"+237 6xx xx xx xx"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:n("auth.password")}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:U?"text":"password",value:E,onChange:e=>M(e.target.value),className:"w-full border border-gray-300 rounded-lg px-3 py-2 pr-10 focus:outline-none focus:ring-2 focus:ring-gray-300",placeholder:"••••••••"}),e.jsx("button",{type:"button",onClick:()=>D(!U),className:"absolute right-3 top-1/2 -translate-y-1/2 text-gray-500 hover:text-gray-700",children:U?e.jsx(a,{size:18}):e.jsx(s,{size:18})})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:n("auth.confirmPassword")}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:H?"text":"password",value:P,onChange:e=>R(e.target.value),className:"w-full border border-gray-300 rounded-lg px-3 py-2 pr-10 focus:outline-none focus:ring-2 focus:ring-gray-300",placeholder:"••••••••"}),e.jsx("button",{type:"button",onClick:()=>V(!H),className:"absolute right-3 top-1/2 -translate-y-1/2 text-gray-500 hover:text-gray-700",children:H?e.jsx(a,{size:18}):e.jsx(s,{size:18})})]})]})]}),J&&e.jsx("div",{className:"text-sm text-red-600",children:J}),e.jsx("div",{className:"pt-2",children:"login"===v?e.jsx(u,{disabled:q,onClick:async()=>{var e,t;G(!0),K(null);try{if(!N.trim()||!k)return void K(n("auth.enterEmailPassword"));const e=await h(()=>g.login(N.trim(),k));e.token&&(localStorage.setItem("token",e.token),localStorage.setItem("userId",e.user_id.toString()),localStorage.setItem("username",e.username||"")),await b(),x(f,{replace:!0})}catch(a){const s=(null==(t=null==(e=null==a?void 0:a.response)?void 0:e.data)?void 0:t.error)||(null==a?void 0:a.message)||n("auth.loginFailed");K(s)}finally{G(!1)}},className:"w-full bg-gray-900 text-white hover:bg-gray-800",children:n(q?"auth.signingIn":"auth.signIn")}):e.jsx(u,{disabled:q,onClick:async()=>{var e,t;G(!0),K(null);try{if(!(z.trim()&&B.trim()&&E&&T.trim()&&P))return void K(n("auth.fillAllFields"));if(E!==P)return void K(n("auth.passwordsDoNotMatch"));const e=await h(()=>g.register(z.trim(),E,B.trim(),T.trim()));e.token&&(localStorage.setItem("token",e.token),localStorage.setItem("userId",e.user_id.toString()),localStorage.setItem("username",e.username||"")),await b(),x(f,{replace:!0})}catch(a){const s=(null==(t=null==(e=null==a?void 0:a.response)?void 0:e.data)?void 0:t.error)||(null==a?void 0:a.message)||n("auth.registrationFailed");K(s)}finally{G(!1)}},className:"w-full bg-gray-900 text-white hover:bg-gray-800",children:n(q?"auth.creatingAccount":"auth.createAccount")})}),e.jsx("div",{className:"text-xs text-gray-500 text-center",children:n("auth.agreeTerms")})]})]})]})};export{x as default};
