import{O as E,z as A,r as n,a5 as H,j as e,Y as g,B as u,E as F,a6 as V,a7 as K,a8 as O}from"./index-BumHlSai.js";import{u as M}from"./useQuery-wQaSLt0g.js";import{u as Q}from"./useMutation-BI-sjjQw.js";import{I as S}from"./input-Ct3vV0ca.js";import{A as _,a as I,b as k}from"./avatar-BcTl2A0a.js";import{O as R}from"./OptimizedImage-xP7m_j1R.js";import{S as D,H as T}from"./Header-CQjoyTD4.js";import{H as U}from"./HostHeader-B1_FfEH8.js";import{M as B}from"./MobileNav-DOEiLKDh.js";import{u as Y}from"./useTranslation-DUME4FCN.js";import{S as G}from"./search-bg3BFgJa.js";import{C as J}from"./chevron-left-BgQrOA8v.js";import{f as W}from"./fr-WkZ76UWi.js";import{e as X,f as C}from"./format-OVVNnQ9P.js";import"./LanguageSwitcher-B49yhAFl.js";import"./index-BcTPR2G6.js";import"./chevron-right-Cey3u9Ra.js";import"./check-Cw4ObBPz.js";import"./menu-CwDdBYwq.js";import"./sheet-CXl9c71X.js";import"./plus-zj-BiCMM.js";import"./heart-DX2l2ZpK.js";import"./calendar-B4NFKoEL.js";import"./message-square-BTQwkIw7.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Z=E("EllipsisVertical",[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"12",cy:"5",r:"1",key:"gxeob9"}],["circle",{cx:"12",cy:"19",r:"1",key:"lyex9k"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ee=E("Send",[["path",{d:"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z",key:"1ffxy3"}],["path",{d:"m21.854 2.147-10.94 10.939",key:"12cjpa"}]]),Se=()=>{const{t:r,i18n:L}=Y(),f=L.language==="fr"?W:X,[p,j]=A(),c=p.get("conversationId"),P=p.get("view")==="host",[t,o]=n.useState(c),[d,y]=n.useState(""),h=n.useRef(null),v=H(),{data:a,isLoading:q}=M({queryKey:["conversations"],queryFn:K}),{data:m,isLoading:$}=M({queryKey:["messages",t],queryFn:()=>O(t),enabled:!!t,refetchInterval:5e3}),x=Q({mutationFn:({conversationId:s,content:i})=>V(s,i),onSuccess:()=>{y(""),v.invalidateQueries({queryKey:["messages",t]}),v.invalidateQueries({queryKey:["conversations"]})}});n.useEffect(()=>{h.current&&h.current.scrollIntoView({behavior:"smooth"})},[m]),n.useEffect(()=>{c?o(c):a&&a.length>0&&!t&&o(a[0].conversation.id)},[c,a]);const z=s=>{s.preventDefault(),!(!d.trim()||!t)&&x.mutate({conversationId:t,content:d})},l=a==null?void 0:a.find(s=>s.conversation.id===t),N=parseInt(localStorage.getItem("userId")||"0");return q?e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsx(g,{className:"h-8 w-8 animate-spin"})}):e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsx(D,{title:r("messages.title","Messages"),description:"Manage your communications with hosts and guests on Le Mboko."}),P?e.jsx(U,{}):e.jsx(T,{}),e.jsx("div",{className:"pt-8 pb-10",children:e.jsx("div",{className:"max-w-6xl mx-auto px-4 sm:px-6 lg:px-8 h-[calc(100vh-140px)]",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-sm border overflow-hidden h-full flex",children:[e.jsxs("div",{className:`w-full md:w-1/3 border-r flex flex-col ${t?"hidden md:flex":"flex"}`,children:[e.jsxs("div",{className:"p-4 border-b",children:[e.jsx("h2",{className:"text-xl font-bold mb-4",children:r("messages.title","Messages")}),e.jsxs("div",{className:"relative",children:[e.jsx(G,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),e.jsx(S,{placeholder:r("messages.searchPlaceholder","Search messages"),className:"pl-9 bg-gray-50 border-gray-200"})]})]}),e.jsx("div",{className:"flex-1 overflow-y-auto",children:(a==null?void 0:a.length)===0?e.jsx("div",{className:"p-8 text-center text-gray-500",children:r("messages.noMessages","No messages yet")}):a==null?void 0:a.map(s=>{var i,b,w;return e.jsx("div",{onClick:()=>{o(s.conversation.id),j({conversationId:s.conversation.id})},className:`p-4 border-b cursor-pointer hover:bg-gray-50 transition-colors ${t===s.conversation.id?"bg-gray-50 border-l-4 border-l-black":""}`,children:e.jsxs("div",{className:"flex gap-3",children:[e.jsxs(_,{className:"h-12 w-12",children:[e.jsx(I,{src:s.other_user.avatar}),e.jsx(k,{children:s.other_user.name.charAt(0)})]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex justify-between items-start mb-1",children:[e.jsx("h3",{className:"font-semibold truncate",children:s.other_user.name}),s.last_message&&e.jsx("span",{className:"text-xs text-gray-500 whitespace-nowrap ml-2",children:C(new Date(s.last_message.created_at),"MMM d",{locale:f})})]}),e.jsx("p",{className:"text-sm text-gray-600 truncate mb-1",children:s.listing_title}),e.jsx("p",{className:`text-sm truncate ${!((i=s.last_message)!=null&&i.read_at)&&((b=s.last_message)==null?void 0:b.sender_id)!==N?"font-bold text-black":"text-gray-500"}`,children:((w=s.last_message)==null?void 0:w.content)||r("messages.noMessages","No messages yet")})]})]})},s.conversation.id)})})]}),e.jsx("div",{className:`flex-1 flex flex-col ${t?"flex":"hidden md:flex"}`,children:l?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"p-4 border-b flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(u,{variant:"ghost",size:"icon",className:"md:hidden",onClick:()=>{o(null),j({})},children:e.jsx(J,{className:"h-5 w-5"})}),e.jsxs(_,{className:"h-10 w-10",children:[e.jsx(I,{src:l.other_user.avatar}),e.jsx(k,{children:l.other_user.name.charAt(0)})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold",children:l.other_user.name}),e.jsx("p",{className:"text-xs text-gray-500",children:r("messages.responseTime",{time:"1 hour",defaultValue:"Response time: 1 hour"})})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[l.listing_image&&e.jsx(R,{src:F(l.listing_image),alt:"Listing",className:"h-10 w-10 rounded object-cover hidden sm:block"}),e.jsx(u,{variant:"ghost",size:"icon",children:e.jsx(Z,{className:"h-5 w-5"})})]})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-4 space-y-4 bg-white",children:[$?e.jsx("div",{className:"flex justify-center py-8",children:e.jsx(g,{className:"h-6 w-6 animate-spin text-gray-400"})}):m==null?void 0:m.map(s=>{const i=s.sender_id===N;return e.jsx("div",{className:`flex ${i?"justify-end":"justify-start"}`,children:e.jsxs("div",{className:`max-w-[70%] rounded-2xl px-4 py-2 ${i?"bg-black text-white rounded-tr-none":"bg-gray-100 text-gray-900 rounded-tl-none"}`,children:[e.jsx("p",{className:"text-sm",children:s.content}),e.jsx("div",{className:`text-[10px] mt-1 ${i?"text-gray-400":"text-gray-500"}`,children:C(new Date(s.created_at),"h:mm a",{locale:f})})]})},s.id)}),e.jsx("div",{ref:h})]}),e.jsx("div",{className:"p-4 border-t",children:e.jsxs("form",{onSubmit:z,className:"flex gap-2",children:[e.jsx(S,{value:d,onChange:s=>y(s.target.value),placeholder:r("messages.typePlaceholder","Type a message..."),className:"flex-1",disabled:x.isPending}),e.jsx(u,{type:"submit",size:"icon",disabled:!d.trim()||x.isPending,children:x.isPending?e.jsx(g,{className:"h-4 w-4 animate-spin"}):e.jsx(ee,{className:"h-4 w-4"})})]})})]}):e.jsx("div",{className:"flex-1 flex items-center justify-center text-gray-400",children:r("messages.selectConversation","Select a conversation to start messaging")})})]})})}),e.jsx(B,{})]})};export{Se as default};
