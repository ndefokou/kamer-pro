import{O as J,ab as m,p as K,z as Q,r as i,q as V,j as e,B as E}from"./index-BumHlSai.js";import{L as X}from"./Loading-wlpE3RCN.js";import{L as Y}from"./LanguageSwitcher-B49yhAFl.js";import{u as Z}from"./useTranslation-DUME4FCN.js";import{C as ee}from"./chevron-left-BgQrOA8v.js";import{E as A}from"./eye-DjaNXgzk.js";import"./index-BcTPR2G6.js";import"./chevron-right-Cey3u9Ra.js";import"./check-Cw4ObBPz.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const I=J("EyeOff",[["path",{d:"M10.733 5.076a10.744 10.744 0 0 1 11.205 6.575 1 1 0 0 1 0 .696 10.747 10.747 0 0 1-1.444 2.49",key:"ct8e1f"}],["path",{d:"M14.084 14.158a3 3 0 0 1-4.242-4.242",key:"151rxh"}],["path",{d:"M17.479 17.499a10.75 10.75 0 0 1-15.417-5.151 1 1 0 0 1 0-.696 10.75 10.75 0 0 1 4.446-5.143",key:"13bj9a"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]]);class te{async startRegistration(s){return(await m.post("/auth/register/start",{username:s})).data}async completeRegistration(s,a,l,n){return(await m.post("/auth/register/complete",{username:s,email:a,credential_id:l,public_key:n})).data}async startAuthentication(s){return(await m.post("/auth/login/start",{username:s})).data}async completeAuthentication(s,a){return(await m.post("/auth/login/complete",{username:s,signature:a})).data}async register(s,a,l,n){return(await m.post("/auth/register",{username:s,password:a,phone:l,email:n})).data}async login(s,a){return(await m.post("/auth/login",{email:s,password:a})).data}static arrayBufferToBase64(s){const a=new Uint8Array(s);let l="";for(let n=0;n<a.byteLength;n++)l+=String.fromCharCode(a[n]);return btoa(l)}static base64ToArrayBuffer(s){const a=atob(s),l=new Uint8Array(a.length);for(let n=0;n<a.length;n++)l[n]=a.charCodeAt(n);return l.buffer}}const T=new te,M=async(t,s=3,a=600)=>{let l;for(let n=0;n<s;n++)try{return await t()}catch(u){if(l=u,n<s-1){const f=a*Math.pow(2,n);await new Promise(d=>setTimeout(d,f))}}throw l},de=()=>{const{t}=Z(),s=K(),[a]=Q(),l=i.useMemo(()=>a.get("redirect")||"/",[a]),{login:n,user:u,loading:f}=V(),[d,y]=i.useState(a.get("tab")||"login"),[b,B]=i.useState(""),[w,F]=i.useState(""),[j,R]=i.useState(!1),[v,_]=i.useState(""),[N,D]=i.useState(""),[S,O]=i.useState(""),[h,U]=i.useState(""),[k,$]=i.useState(""),[C,q]=i.useState(!1),[L,W]=i.useState(!1),[x,p]=i.useState(!1),[z,c]=i.useState(null);i.useEffect(()=>{const r=a.get("tab");(r==="login"||r==="register")&&y(r)},[a]),i.useEffect(()=>{u&&s(l,{replace:!0})},[u,s,l]);const G=async()=>{var r,g;p(!0),c(null);try{if(!b.trim()||!w){c(t("auth.enterEmailPassword"));return}const o=await M(()=>T.login(b.trim(),w));o.token&&(localStorage.setItem("token",o.token),localStorage.setItem("userId",o.user_id.toString()),localStorage.setItem("username",o.username||"")),await n(),s(l,{replace:!0})}catch(o){const P=((g=(r=o==null?void 0:o.response)==null?void 0:r.data)==null?void 0:g.error)||(o==null?void 0:o.message)||t("auth.loginFailed");c(P)}finally{p(!1)}},H=async()=>{var r,g;p(!0),c(null);try{if(!v.trim()||!N.trim()||!h||!S.trim()||!k){c(t("auth.fillAllFields"));return}if(h!==k){c(t("auth.passwordsDoNotMatch"));return}const o=await M(()=>T.register(v.trim(),h,N.trim(),S.trim()));o.token&&(localStorage.setItem("token",o.token),localStorage.setItem("userId",o.user_id.toString()),localStorage.setItem("username",o.username||"")),await n(),s(l,{replace:!0})}catch(o){const P=((g=(r=o==null?void 0:o.response)==null?void 0:r.data)==null?void 0:g.error)||(o==null?void 0:o.message)||t("auth.registrationFailed");c(P)}finally{p(!1)}};return f?e.jsx(X,{fullScreen:!0,message:t("common.loading")}):e.jsxs("div",{className:"min-h-screen bg-white flex items-center justify-center px-4 py-10 relative",children:[e.jsx(E,{variant:"ghost",size:"icon",onClick:()=>s(-1),className:"absolute top-6 left-6 rounded-full hover:bg-gray-100","aria-label":t("common.back"),children:e.jsx(ee,{className:"h-6 w-6"})}),e.jsx("div",{className:"absolute top-6 right-6",children:e.jsx(Y,{})}),e.jsxs("div",{className:"w-full max-w-md",children:[e.jsxs("div",{className:"mb-6 text-center",children:[e.jsx("h1",{className:"text-2xl font-semibold",children:t("auth.welcome")}),e.jsx("p",{className:"text-gray-600 text-sm",children:t("auth.loginSubtitle")})]}),e.jsxs("div",{className:"flex p-1 bg-gray-100 rounded-full mb-6 w-full",children:[e.jsx("button",{className:`flex-1 py-2 rounded-full text-sm font-semibold ${d==="login"?"bg-white shadow":"text-gray-600"}`,onClick:()=>y("login"),children:t("auth.login")}),e.jsx("button",{className:`flex-1 py-2 rounded-full text-sm font-semibold ${d==="register"?"bg-white shadow":"text-gray-600"}`,onClick:()=>y("register"),children:t("auth.register")})]}),e.jsxs("div",{className:"bg-white border border-gray-200 rounded-xl p-6 space-y-4",children:[d==="login"?e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:t("auth.email")}),e.jsx("input",{type:"email",value:b,onChange:r=>B(r.target.value),className:"w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-gray-300",placeholder:"you@example.com"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:t("auth.password")}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:j?"text":"password",value:w,onChange:r=>F(r.target.value),className:"w-full border border-gray-300 rounded-lg px-3 py-2 pr-10 focus:outline-none focus:ring-2 focus:ring-gray-300",placeholder:"••••••••"}),e.jsx("button",{type:"button",onClick:()=>R(!j),className:"absolute right-3 top-1/2 -translate-y-1/2 text-gray-500 hover:text-gray-700",children:j?e.jsx(I,{size:18}):e.jsx(A,{size:18})})]})]})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:t("auth.username")}),e.jsx("input",{value:v,onChange:r=>_(r.target.value),className:"w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-gray-300",placeholder:"johndoe"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:t("auth.email")}),e.jsx("input",{type:"email",value:S,onChange:r=>O(r.target.value),className:"w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-gray-300",placeholder:"you@example.com"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:t("auth.phoneLabel")}),e.jsx("input",{type:"tel",value:N,onChange:r=>D(r.target.value),className:"w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-gray-300",placeholder:"+237 6xx xx xx xx"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:t("auth.password")}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:C?"text":"password",value:h,onChange:r=>U(r.target.value),className:"w-full border border-gray-300 rounded-lg px-3 py-2 pr-10 focus:outline-none focus:ring-2 focus:ring-gray-300",placeholder:"••••••••"}),e.jsx("button",{type:"button",onClick:()=>q(!C),className:"absolute right-3 top-1/2 -translate-y-1/2 text-gray-500 hover:text-gray-700",children:C?e.jsx(I,{size:18}):e.jsx(A,{size:18})})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:t("auth.confirmPassword")}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:L?"text":"password",value:k,onChange:r=>$(r.target.value),className:"w-full border border-gray-300 rounded-lg px-3 py-2 pr-10 focus:outline-none focus:ring-2 focus:ring-gray-300",placeholder:"••••••••"}),e.jsx("button",{type:"button",onClick:()=>W(!L),className:"absolute right-3 top-1/2 -translate-y-1/2 text-gray-500 hover:text-gray-700",children:L?e.jsx(I,{size:18}):e.jsx(A,{size:18})})]})]})]}),z&&e.jsx("div",{className:"text-sm text-red-600",children:z}),e.jsx("div",{className:"pt-2",children:d==="login"?e.jsx(E,{disabled:x,onClick:G,className:"w-full bg-gray-900 text-white hover:bg-gray-800",children:t(x?"auth.signingIn":"auth.signIn")}):e.jsx(E,{disabled:x,onClick:H,className:"w-full bg-gray-900 text-white hover:bg-gray-800",children:t(x?"auth.creatingAccount":"auth.createAccount")})}),e.jsx("div",{className:"text-xs text-gray-500 text-center",children:t("auth.agreeTerms")})]})]})]})};export{de as default};
