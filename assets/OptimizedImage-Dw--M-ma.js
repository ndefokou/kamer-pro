import{j as t}from"./vendor-ui-DcvuiMJW.js";import{r as e}from"./vendor-react-CPc5zwff.js";import{i as r,ab as n}from"./index-Dd0d9_cy.js";const a=()=>{if("undefined"==typeof document)return!1;const t=document.createElement("canvas");return!(!t.getContext||!t.getContext("2d"))&&0===t.toDataURL("image/webp").indexOf("data:image/webp")},s=(t,e,r)=>{if(!t)return"";if(t.startsWith("data:")||t.startsWith("blob:"))return t;try{const n=new URL(t,window.location.origin);let s=r;return s||(s="low"===e?400:"medium"===e?800:1200),n.searchParams.set("w",s.toString()),n.searchParams.set("q","low"===e?"30":"medium"===e?"60":"80"),a()&&n.searchParams.set("fm","webp"),n.toString()}catch{return t}},o=({src:o,alt:i,className:c="",width:u,height:d,priority:l=!1,quality:m,onLoad:h,onError:b,onClick:g})=>{const[f,p]=e.useState(""),[w,x]=e.useState(""),[v,y]=e.useState(!0),[j,k]=e.useState(!1),[S,L]=e.useState(l),P=e.useRef(null),{recommendedImageQuality:R}=r(),W=!1,U=m||R;e.useEffect(()=>{if(l||!P.current)return;const t=new IntersectionObserver(e=>{e.forEach(e=>{e.isIntersecting&&(L(!0),t.disconnect())})},{rootMargin:"50px",threshold:.01});return t.observe(P.current),()=>{t.disconnect()}},[l]),e.useEffect(()=>{if(!S||!o)return;let t=!0;return(async()=>{try{y(!0),k(!1);const e=(t=>{if(!t||t.startsWith("data:")||t.startsWith("blob:"))return"";try{const e=new URL(t,window.location.origin);return e.hostname.includes("supabase.co")&&e.pathname.includes("/storage/v1/object/public/"),e.searchParams.set("w","20"),e.searchParams.set("q","10"),e.searchParams.set("blur","10"),a()&&e.searchParams.set("fm","webp"),e.toString()}catch{return""}})(o);e&&t&&x(e);const r=await n.getCachedImage(o);if(r&&t){const t=URL.createObjectURL(r);return p(t),y(!1),void(null==h||h())}const i=s(o,U);t&&p(i)}catch(e){t&&(p(o),k(!0),y(!1),null==b||b())}})(),()=>{t=!1,f&&f.startsWith("blob:")&&URL.revokeObjectURL(f)}},[S,o,U,h,b,W]);const C={backgroundColor:"#e5e7eb",backgroundImage:w?`url(${w})`:v?"linear-gradient(90deg, #e5e7eb 0%, #f3f4f6 50%, #e5e7eb 100%)":void 0,backgroundSize:w?"cover":v?"200% 100%":void 0,backgroundPosition:"center",filter:w&&v?"blur(10px)":void 0,animation:!w&&v?"shimmer 1.5s infinite":void 0,transition:"filter 0.3s ease-out"},E=((t,e)=>{if(!t||t.startsWith("data:")||t.startsWith("blob:"))return"";try{return("low"===e?[400,600]:[400,800,1200]).map(r=>`${s(t,e,r)} ${r}w`).join(", ")}catch{return""}})(o,U),O=!(!E||f&&(f.startsWith("blob:")||f===o)||j);return t.jsxs(t.Fragment,{children:[t.jsx("style",{children:"\n          @keyframes shimmer {\n            0% { background-position: -200% 0; }\n            100% { background-position: 200% 0; }\n          }\n        "}),t.jsx("img",{ref:P,src:f||w||void 0,srcSet:O?E:void 0,sizes:O?"(max-width: 640px) 400px, (max-width: 1024px) 800px, 1200px":void 0,alt:i,className:c,width:u,height:d,loading:l?"eager":"lazy",fetchpriority:l?"high":"low",crossOrigin:"anonymous",style:!f||v?C:{transition:"opacity 0.3s ease-in"},onClick:g,onLoad:()=>{y(!1)},onError:t=>{f!==o&&o?(p(o),k(!0)):(k(!0),y(!1),null==b||b())}})]})};export{o as O};
