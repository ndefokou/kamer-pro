import{j as e}from"./vendor-ui-DcvuiMJW.js";import{r as t}from"./vendor-react-CPc5zwff.js";import{u as o,M as n,L as s,P as r,a as i,T as a}from"./vendor-maps-DGfzlnCx.js";import{i as l,a as c}from"./marker-shadow-D5DIcCoR.js";import{O as p}from"./OptimizedImage-Dw--M-ma.js";import{u}from"./useTranslation-BTMhbqKL.js";import{n as d,o as m}from"./index-Dd0d9_cy.js";import"./vendor-charts-CNjKuHaK.js";import"./vendor-utils-tyqSID0v.js";const h=()=>{const{t:i}=u(),a=o(),[l,c]=t.useState([]),p=t.useRef(null),d=t.useRef(""),m=t.useMemo(()=>({restaurant:"ðŸ½ï¸",cafe:"â˜•",fast_food:"ðŸ”",bar:"ðŸº",pub:"ðŸ»",pharmacy:"ðŸ’Š",hospital:"ðŸ¥",bank:"ðŸ¦",atm:"ðŸ§",fuel:"â›½",school:"ðŸ«",university:"ðŸŽ“",library:"ðŸ“š",supermarket:"ðŸ›’",mall:"ðŸ¬",department_store:"ðŸ¬",convenience:"ðŸ›ï¸",bakery:"ðŸ¥–",fitness_centre:"ðŸ‹ï¸",sports_centre:"ðŸŸï¸",park:"ðŸŒ³",hotel:"ðŸ¨",guest_house:"ðŸ ",attraction:"ðŸŽ¯",station:"ðŸš‰",bus_stop:"ðŸš"}),[]);return t.useEffect(()=>{const e=()=>{const e=a.getZoom();if(e<12)return void c([]);const t=a.getBounds(),o=t.getSouth(),n=t.getWest(),s=t.getNorth(),r=t.getEast(),i=`${o.toFixed(4)},${n.toFixed(4)},${s.toFixed(4)},${r.toFixed(4)}:${e}`;if(i===d.current)return;d.current=i;const l=`${o},${n},${s},${r}`;fetch("https://overpass-api.de/api/interpreter",{method:"POST",body:`\n[out:json][timeout:25];\n(\n  node["amenity"~"restaurant|cafe|fast_food|bar|pub|pharmacy|hospital|bank|atm|fuel|school|university|library"](${l});\n  node["shop"~"supermarket|mall|department_store|convenience|bakery"](${l});\n  node["leisure"~"fitness_centre|sports_centre|park"](${l});\n  node["tourism"~"hotel|guest_house|attraction"](${l});\n  node["public_transport"="station"](${l});\n  node["highway"="bus_stop"](${l});\n);\nout center 200;`,headers:{"Content-Type":"text/plain;charset=UTF-8"}}).then(e=>e.json()).then(e=>{const t=Array.isArray(null==e?void 0:e.elements)?e.elements:[],o=[];for(const n of t){if("node"!==n.type)continue;const e=n.tags||{},t=e.name||"",s=e.amenity||e.shop||e.leisure||e.tourism||("bus_stop"===e.highway?"bus_stop":"station"===e.public_transport?"station":"");if(!s)continue;if("number"!=typeof n.lat||"number"!=typeof n.lon)continue;const r=s.toString(),i=r in m?r:r.split(";")[0],a=m[i]||"ðŸ“";if(o.push({id:String(n.id),lat:n.lat,lon:n.lon,name:t,emoji:a,type:r}),o.length>=200)break}c(o)}).catch(()=>{})},t=()=>{p.current&&window.clearTimeout(p.current),p.current=window.setTimeout(e,600)};return e(),a.on("moveend",t),()=>{a.off("moveend",t),p.current&&window.clearTimeout(p.current)}},[a,m]),e.jsx(e.Fragment,{children:l.map(t=>{return e.jsx(n,{position:[t.lat,t.lon],icon:(o=t.emoji,s.divIcon({html:`<div style="background:white;border:1px solid #d1d5db;border-radius:12px;padding:2px 3px;font-size:14px;line-height:14px">${o}</div>`,className:"poi-div-icon",iconSize:[24,24],iconAnchor:[12,12]})),children:e.jsx(r,{children:e.jsxs("div",{className:"space-y-1",children:[e.jsx("div",{className:"font-semibold text-sm",children:t.name||i(`poi.${t.type}`,{defaultValue:t.type})}),e.jsx("div",{className:"text-xs text-gray-600",children:i(`poi.${t.type}`,{defaultValue:t.type})})]})})},t.id);var o})})},f=s.icon({iconUrl:c,shadowUrl:l,iconSize:[25,41],iconAnchor:[12,41]});s.Marker.prototype.options.icon=f;const x=({mapPoints:e,singlePoint:n,fallbackCenter:r})=>{const i=o();return t.useEffect(()=>{if(n)i.setView(n,12);else if(e.length>0){const t=e.map(e=>[e.lat,e.lon]),o=s.latLngBounds(t);i.fitBounds(o,{padding:[24,24],maxZoom:12})}else r&&i.setView(r,13)},[i,e,n,r]),null},g=({mapPoints:t,singlePoint:o,fallbackCenter:s})=>e.jsxs(i,{center:s||[3.848,11.5021],zoom:13,scrollWheelZoom:!0,className:"h-full w-full",children:[e.jsx(a,{attribution:'Â© <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png"}),e.jsx(x,{mapPoints:t,singlePoint:o,fallbackCenter:s}),e.jsx(h,{}),t.map(({id:t,lat:o,lon:s,product:i})=>{var a;return e.jsx(n,{position:[o,s],children:e.jsx(r,{children:e.jsxs("div",{className:"w-48",children:[e.jsx(p,{src:d(null==(a=i.photos[0])?void 0:a.url)||"https://images.unsplash.com/photo-1568605114967-8130f3a36994?w=400&h=400&fit=crop",alt:i.listing.title,className:"w-full h-32 object-cover rounded-lg mb-2"}),e.jsx("h3",{className:"font-semibold text-sm truncate",children:i.listing.title}),e.jsx("p",{className:"text-sm font-bold",children:m(i.listing.price_per_night||0)})]})})},t)})]});export{g as default};
