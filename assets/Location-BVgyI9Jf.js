const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/HostLocationMap-CDeaHr6J.js","assets/vendor-ui-CAOOb9ur.js","assets/vendor-react-C_40T_Qy.js","assets/vendor-maps-B_ay1OW3.js","assets/marker-shadow-D5DIcCoR.js","assets/marker-shadow-Dgihpmma.css"])))=>i.map(i=>d[i]);
import{a6 as t,n as e,B as o,I as a,_ as s}from"./index-CHW3rl59.js";import{j as i,ao as l,X as n,G as r}from"./vendor-ui-CAOOb9ur.js";import{f as d,r as c}from"./vendor-react-C_40T_Qy.js";import{I as u}from"./input-DjJBUjUv.js";import{u as m}from"./useTranslation-DgYtz7Wb.js";import"./vendor-charts-knjLkUkQ.js";import"./vendor-utils-tyqSID0v.js";const h=c.lazy(()=>s(()=>import("./HostLocationMap-CDeaHr6J.js"),__vite__mapDeps([0,1,2,3,4,5]))),p=[7.3697,12.3547],x=1,g=2,v=3;function f(t){const e=t.display_name.split(",");return e.slice(0,Math.min(3,e.length)).join(",")}const y=()=>{const s=d(),{draft:y,updateDraft:j,nextStep:b,previousStep:w}=t(),{toast:N}=e(),{t:S}=m(),k=new URLSearchParams(window.location.search).get("listing"),_=!!k,[F,T]=c.useState(null),[C,$]=c.useState(!1),P=_&&(null==F?void 0:F.latitude)&&(null==F?void 0:F.longitude)?{lat:F.latitude,lng:F.longitude}:y.latitude&&y.longitude?{lat:y.latitude,lng:y.longitude}:{lat:p[0],lng:p[1]},[z,D]=c.useState(P),[L,U]=c.useState(P),[A,E]=c.useState(_&&(null==F?void 0:F.latitude)&&(null==F?void 0:F.longitude)||y.latitude&&y.longitude?13:6),[I,B]=c.useState(_?(null==F?void 0:F.address)||"":y.address||""),[R,W]=c.useState([]),[M,q]=c.useState(!1),[G,H]=c.useState(_?(null==F?void 0:F.address)||"":y.address||""),[O,Z]=c.useState(!1),[V,Y]=c.useState(!1),[J,K]=c.useState(y.city||""),[Q,X]=c.useState(y.country||"");c.useEffect(()=>{if(_&&k){(async()=>{try{const t=(await a.get(`/listings/${k}`)).data.listing;if(T(t),t.city&&K(t.city),t.country&&X(t.country),t.latitude&&t.longitude){const e={lat:t.latitude,lng:t.longitude};D(e),U(e),E(13)}t.address&&(B(t.address),H(t.address))}catch(t){}})()}},[_,k]),c.useEffect(()=>{if(I.length<3)return W([]),void Z(!1);const t=setTimeout(async()=>{q(!0),Z(!0);try{const t=await fetch(`https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(I)}&limit=5&addressdetails=1`),e=await t.json();W(e)}catch(t){W([])}finally{q(!1)}},500);return()=>clearTimeout(t)},[I]);const tt=async(t,e)=>{var o,a,s,i;try{const l=await fetch(`https://nominatim.openstreetmap.org/reverse?format=json&lat=${t}&lon=${e}&zoom=14&addressdetails=1`),n=await l.json();if(n&&n.display_name){const l=f({lat:String(t),lon:String(e),display_name:n.display_name});B(l),H(n.display_name);const r=(null==(o=n.address)?void 0:o.city)||(null==(a=n.address)?void 0:a.town)||(null==(s=n.address)?void 0:s.village)||"",d=(null==(i=n.address)?void 0:i.country)||"";K(r),X(d),Z(!1),W([])}}catch(l){}};return i.jsxs("div",{className:"min-h-screen bg-background flex flex-col",children:[i.jsx("div",{className:"p-4 md:p-8 pb-4",children:i.jsxs("div",{className:"max-w-4xl mx-auto",children:[i.jsx("h1",{className:"text-3xl md:text-4xl font-bold mb-2",children:S("host.location.title","Where's your place located?")}),i.jsx("p",{className:"text-muted-foreground",children:S("host.location.subtitle","Your address is only shared with guests after they've made a reservation.")})]})}),i.jsx("div",{className:"px-4 md:px-8 pb-4",children:i.jsxs("div",{className:"max-w-4xl mx-auto relative",children:[i.jsxs("div",{className:"relative",children:[i.jsx(l,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-5 w-5 text-muted-foreground"}),i.jsx(u,{type:"text",placeholder:S("host.location.searchPlaceholder","Enter a location..."),value:I,onChange:t=>{B(t.target.value),Z(!0)},onFocus:()=>{R.length>0&&Z(!0)},className:"pl-10 pr-10 py-6 text-lg"}),I&&i.jsx("button",{onClick:()=>{B(""),H(""),Z(!1),W([])},className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-muted-foreground hover:text-foreground",children:i.jsx(n,{className:"h-5 w-5"})})]}),i.jsx("div",{className:"mt-3",children:i.jsx(o,{variant:"outline",size:"sm",onClick:()=>{navigator.geolocation?(Y(!0),navigator.geolocation.getCurrentPosition(async t=>{const{latitude:e,longitude:o}=t.coords,a={lat:e,lng:o};D(a),U(a),E(15),await tt(e,o),Y(!1)},t=>{let e=S("host.location.geolocationError","Unable to retrieve your location.");t.code===x?e=S("host.location.permissionDenied","Permission to access location was denied."):t.code===g?e=S("host.location.positionUnavailable","Location information is unavailable."):t.code===v&&(e=S("host.location.timeout","The request to get your location timed out.")),N({title:S("host.location.locationFailedTitle","Location failed"),description:e+" "+S("host.location.tryApprox","Trying approximate location..."),variant:"destructive"}),Y(!1),(async()=>{try{const t=await fetch("https://ipapi.co/json/"),e=await t.json();if("number"==typeof e.latitude&&"number"==typeof e.longitude){const t={lat:e.latitude,lng:e.longitude};D(t),U(t),E(12);const o=[e.city,e.region,e.country_name].filter(Boolean).join(", ");o?(B(o),H(o),e.city&&K(e.city),e.country_name&&X(e.country_name),Z(!1),W([])):await tt(e.latitude,e.longitude),N({title:S("host.location.approxTitle","Using approximate location"),description:S("host.location.approxDesc","We estimated your location using your IP address.")})}else N({title:S("host.location.fallbackFailedTitle","Approximate location failed"),description:S("host.location.fallbackFailedDesc","We could not determine your location."),variant:"destructive"})}catch(t){N({title:S("host.location.fallbackFailedTitle","Approximate location failed"),description:S("host.location.fallbackFailedDesc","We could not determine your location."),variant:"destructive"})}})()},{enableHighAccuracy:!0,timeout:1e4,maximumAge:0})):N({title:S("host.location.geolocationUnsupportedTitle","Location unavailable"),description:S("host.location.geolocationUnsupportedDesc","Geolocation is not supported by your browser."),variant:"destructive"})},disabled:V,children:V?S("host.location.locating","Locating..."):S("host.location.useMyLocation","Use my location")})}),O&&R.length>0&&i.jsx("div",{className:"absolute z-[1000] w-full mt-2 bg-background border rounded-lg shadow-lg max-h-80 overflow-y-auto",children:R.map((t,e)=>{const o=t.display_name.split(","),a=o[0],s=o.slice(1).join(",");return i.jsxs("button",{onClick:()=>(t=>{var e,o,a,s;const i={lat:parseFloat(t.lat),lng:parseFloat(t.lon)};D(i),U(i),E(13);const l=f(t);B(l),H(t.display_name);const n=(null==(e=t.address)?void 0:e.city)||(null==(o=t.address)?void 0:o.town)||(null==(a=t.address)?void 0:a.village)||"",r=(null==(s=t.address)?void 0:s.country)||"";K(n),X(r),Z(!1),W([])})(t),className:"w-full px-4 py-3 text-left hover:bg-accent transition-colors border-b last:border-b-0 flex items-start gap-3",children:[i.jsx(l,{className:"h-5 w-5 text-muted-foreground mt-0.5 flex-shrink-0"}),i.jsxs("div",{className:"flex-1 min-w-0",children:[i.jsx("div",{className:"font-medium text-foreground truncate",children:a}),i.jsx("div",{className:"text-sm text-muted-foreground truncate",children:s})]})]},e)})}),M&&O&&i.jsx("div",{className:"absolute z-[1000] w-full mt-2 bg-background border rounded-lg shadow-lg p-4 text-center text-muted-foreground",children:S("common.searching","Searching...")}),O&&!M&&0===R.length&&I.length>=3&&i.jsx("div",{className:"absolute z-[1000] w-full mt-2 bg-background border rounded-lg shadow-lg p-4 text-center text-muted-foreground",children:S("common.noResults","No results found")})]})}),i.jsx("div",{className:"flex-1 px-4 md:px-8 pb-4",children:i.jsx("div",{className:"max-w-4xl mx-auto h-[400px] md:h-[500px] rounded-lg overflow-hidden border-2 border-border shadow-lg",children:i.jsx(c.Suspense,{fallback:i.jsx("div",{className:"h-full w-full bg-slate-100 flex items-center justify-center",children:i.jsx(r,{className:"h-8 w-8 text-slate-300 animate-pulse"})}),children:i.jsx(h,{initialPosition:P,mapCenter:L,mapZoom:A,position:z,setPosition:D})})})}),i.jsx("div",{className:"px-4 md:px-8 pb-8",children:i.jsxs("div",{className:"max-w-4xl mx-auto",children:[i.jsxs("div",{className:"flex justify-between items-center pt-6 border-t",children:[i.jsx(o,{variant:"outline",onClick:()=>{_&&k?s(`/host/editor/${k}`):(j({latitude:z.lat,longitude:z.lng,address:G||I||`${z.lat.toFixed(6)}, ${z.lng.toFixed(6)}`,city:J,country:Q}),w(),s("/host/amenities"))},size:"lg",children:_?S("common.cancel","Cancel"):S("common.back","Back")}),i.jsx(o,{onClick:async()=>{const t={latitude:z.lat,longitude:z.lng,address:G||I||`${z.lat.toFixed(6)}, ${z.lng.toFixed(6)}`};if(J&&(t.city=J),Q&&(t.country=Q),_&&k){$(!0);try{await a.put(`/listings/${k}`,t),s(`/host/editor/${k}`)}catch(e){N({title:S("host.location.saveFailedTitle","Save failed"),description:S("host.location.saveFailedDesc","Failed to save location. Please try again."),variant:"destructive"})}finally{$(!1)}}else j(t),b(),s("/host/photos")},size:"lg",disabled:C,children:C?S("common.saving","Saving..."):_?S("common.save","Save"):S("common.continue","Continue")})]}),!_&&i.jsx("div",{className:"mt-4 text-center text-sm text-muted-foreground",children:S("common.stepOf","Step {{current}} of {{total}}",{current:3,total:10})})]})})]})};export{y as default};
