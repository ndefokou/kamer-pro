global:
  domain: mboko-api.camer.digital
  version: latest

backend:
  defaultPodOptions:
    securityContext:
      runAsUser: 1000
      runAsGroup: 1000
      fsGroup: 1000

  controllers:
    main:
      type: deployment
      replicas: 1
      pod:
        labels: {}
      labels: {}
      containers:
        main:
          image:
            repository: ghcr.io/ndefokou/kamer-pro/backend
            tag: "{{ .Values.global.version }}"
            pullPolicy: Always

          resources:
            requests:
              cpu: 100m
              memory: 256Mi
            limits:
              cpu: 500m
              memory: 512Mi

          envFrom:
            - secretRef:
                name: le-mboko
          env:
            # Database
            DATABASE_MAX_CONNECTIONS: "20"
            DATABASE_ACQUIRE_TIMEOUT_MS: "5000"
            MIGRATE_ON_START: "true"
            FAST_START: "false"
            SKIP_DB_WAIT: "false"
            RUN_MIGRATIONS: "true"
            SERVER_WORKERS: "2"
            # S3 Storage
            SUPABASE_BUCKET: "images"
            S3_REGION: "eu-west-2"

          probes:
            # Using standard ports for now, will need verification
            liveness:
              enabled: true
              custom: true
              spec:
                httpGet:
                  path: /api/health
                  port: 8082
                initialDelaySeconds: 5
                periodSeconds: 10

  service:
    main:
      enabled: true
      type: ClusterIP
      controller: main
      ports:
        http:
          enabled: true
          port: 8082
          targetPort: 8082

  persistence:
    # Adding persistence placeholder if needed in future
    config:
      enabled: false
      type: emptyDir

  ingress:
    main:
      enabled: true
      className: traefik
      hosts:
        - host: "{{ .Values.global.domain }}"
          paths:
            - path: /
              pathType: Prefix
              service:
                identifier: main
                port: http

  secrets:
    main:
      enabled: true
      stringData:
        DATABASE_URL: "postgresql://postgres.bfxkhdjgdohrziavdorf:tnarthur%40022005@aws-0-us-west-2.pooler.supabase.com:5432/postgres"
        SUPABASE_PUBLIC_URL: "https://bfxkhdjgdohrziavdorf.supabase.co"
        S3_ENDPOINT: "https://bfxkhdjgdohrziavdorf.supabase.co/storage/v1/s3"
        S3_ACCESS_KEY: "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImJmeGtoZGpnZG9ocnppYXZkb3JmIiwicm9sZSI6InNlcnZpY2Vfcm9sZSIsImlhdCI6MTc2OTc1MDk3NiwiZXhwIjoyMDg1MzI2OTc2fQ.zieW7auPyMdfgZ1e71ehGBVEO_8pmkgPKWLkUHGq9vM"
        S3_SECRET_KEY: "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImJmeGtoZGpnZG9ocnppYXZkb3JmIiwicm9sZSI6InNlcnZpY2Vfcm9sZSIsImlhdCI6MTc2OTc1MDk3NiwiZXhwIjoyMDg1MzI2OTc2fQ.zieW7auPyMdfgZ1e71ehGBVEO_8pmkgPKWLkUHGq9vM"
        JWT_SECRET: "gB0GBlpiHi6bTMHgUc60Mlc8Goo0r6tawe1s+O56bt9d5IYSILRnLbkDMlzvuhO11BT/1f9Gi76wF7Ld/dPvbg=="
